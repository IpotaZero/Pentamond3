{"version":3,"file":"Run.js","sources":["../src/EventManager.ts","../src/PageManager.ts","../src/Utils.ts","../src/TimeManager.ts","../src/LoopManager.ts","../src/Interaction/AutoKeyboardManager.ts","../src/Interaction/GamepadInput.ts","../src/Interaction/GamepadManager.ts","../src/Interaction/KeyboardManager.ts","../src/Interaction/Input.ts","../src/Interaction/InputManager.ts","../src/Settings.ts","../src/Game/GameMode.ts","../src/Vector.ts","../src/PlayBackground.ts","../src/GraphicSetting.ts","../src/BGM.ts","../src/FlagManager.ts","../src/Sound.ts","../src/SoundProcessing.ts","../src/BeforePlay.ts","../src/Game/Modes/Mode1.ts","../src/Game/Modes/Mode2.ts","../src/Replay/ReplayDom.ts","../node_modules/lz-string/libs/lz-string.js","../src/Replay/DataCompression.ts","../src/Replay/ReplayDataHandler.ts","../src/Replay/ReplayEventSetter.ts","../src/Replay/Replay.ts","../src/BlockOperate/Block.ts","../src/BlockOperate/MondInfo.ts","../src/Trick.ts","../src/BlockOperate/BlockManager.ts","../src/BlockOperate/NextManager.ts","../src/BlockOperate/Monoiamond.ts","../src/BlockOperate/Pentiamond.ts","../src/BlockOperate/MondOperator.ts","../src/Game/NuisanceMondManager.ts","../src/CanvasManager.ts","../src/Game/InformationLabelManager.ts","../src/Game/GamePlayer.ts","../src/GameProcessing/DisposableGame.ts","../src/GameProcessing/ResultPageHandler.ts","../src/GameProcessing/countDown.ts","../src/GameProcessing/GameProcessing.ts","../src/ScreenInteraction.ts","../src/DeleteDataHandler.ts","../src/GameProcessing/GameStarter.ts","../src/Run.ts"],"sourcesContent":["/**\r\n * MyEventに用いられる一意のid\r\n */\r\nexport type EventId = number | string;\r\n\r\n/**\r\n * イベント情報\r\n */\r\nexport type MyEvent = {\r\n    id: EventId;\r\n    handler: Function;\r\n    classNames: string[];\r\n};\r\n\r\n/**\r\n * MyEventListenerが実装されたクラスが呼び出すイベントを管理する\r\n */\r\nexport class EventManager {\r\n    /**\r\n     * 登録されているイベント\r\n     */\r\n    private static eventList: MyEvent[] = [];\r\n\r\n    /**\r\n     * 登録されているイベントのid\r\n     */\r\n    static get ids() {\r\n        return this.eventList.map(({ id }) => id);\r\n    }\r\n\r\n    /**\r\n     * @param id イベントのid　すでに存在すると失敗する　指定しない場合は自動で割り振る\r\n     * @param handler イベントの処理　必須\r\n     * @param classNames イベントのクラス\r\n     * @returns 追加された/しようとしたイベントのid\r\n     */\r\n    //指定されたhandlerやその他の情報を持つeventを追加する\r\n    //idは指定しなかった場合、被らないように自動的に設定される\r\n    static addEvent({ id, handler, classNames = [] }: { id?: EventId; handler: Function; classNames?: string[] }): EventId {\r\n        if (id) {\r\n            if (!this.ids.includes(id)) {\r\n                this.eventList.push({ id, handler, classNames });\r\n            } else {\r\n                console.error(\"idが重複しているため、このEventは登録に失敗しました\");\r\n            }\r\n            return id;\r\n        } else {\r\n            id = Date.now();\r\n            const ids = this.ids;\r\n            while (ids.includes(id)) {\r\n                id++;\r\n            }\r\n            this.eventList.push({ id, handler, classNames });\r\n            return id;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * イベントの登録解除\r\n     * @param eventId 登録を解除したいイベントのid\r\n     */\r\n    static removeEvent(eventId: EventId): void {\r\n        this.eventList = this.eventList.filter(({ id }) => id != eventId);\r\n    }\r\n\r\n    /**\r\n     * イベントの登録解除\r\n     * @param eventIds 登録を解除したいイベントのidの配列\r\n     */\r\n    static removeEvents(eventIds: EventId[]): void {\r\n        this.eventList = this.eventList.filter(({ id }) => !eventIds.includes(id));\r\n    }\r\n\r\n    /**\r\n     * イベントの一括登録解除\r\n     * @param className 登録を解除したいイベントのclassName\r\n     */\r\n    static removeEventsByClassName(className: string): void {\r\n        this.eventList = this.eventList.filter(({ classNames }) => !classNames.includes(className));\r\n    }\r\n\r\n    /**\r\n     * @param eventId イベントのid\r\n     * @returns idが登録されているか\r\n     */\r\n    static hasAlreadyAdded(eventId: EventId): boolean {\r\n        if (!this.ids.includes(eventId)) {\r\n            console.error(\"指定されたidのEventは登録されていません\");\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * イベントの実行\r\n     * @param eventId 実行したいイベントのid\r\n     */\r\n    static executeEvent(eventId: EventId): void {\r\n        if (this.hasAlreadyAdded(eventId)) {\r\n            return;\r\n        }\r\n        this.eventList.filter(({ id }) => id == eventId)[0].handler();\r\n    }\r\n\r\n    /**\r\n     * イベントの一括実行\r\n     * @param className 実行したいイベントのclassName\r\n     */\r\n    static executeEventsByClassName(className: string) {\r\n        this.eventList\r\n            .filter(({ classNames }) => classNames.includes(className))\r\n            .forEach(({ handler }) => {\r\n                handler();\r\n            });\r\n    }\r\n\r\n    //MyEventListenerを実装しているクラスで呼ばれることを想定している\r\n    /**\r\n     * イベントの一括実行\r\n     * @param className 実行したいイベントのclassName\r\n     * @param eventIds 実行したいイベントのidが入った配列\r\n     */\r\n    static executeListeningEvents(className: string, eventIds: EventId[]) {\r\n        this.eventList\r\n            .filter(({ id, classNames }) => eventIds.includes(id) && classNames.includes(className))\r\n            .forEach(({ handler }) => {\r\n                handler();\r\n            });\r\n    }\r\n\r\n    static consoleEventClasses() {\r\n        console.log(this.eventList.map(({ classNames }) => classNames));\r\n    }\r\n}\r\n\r\n/**\r\n * イベントを呼ぶことがあるクラス用のインターフェース\r\n */\r\nexport type MyEventListener = {\r\n    eventClassNames: string[];\r\n    eventIds?: EventId[];\r\n    addEvent: (classNames: string[], handler: Function) => EventId;\r\n};\r\n","import { EventId, EventManager, MyEventListener } from \"./EventManager.js\";\r\n\r\nexport type PageManagerOption = {\r\n    eventIgnore?: boolean;\r\n};\r\n\r\nexport class PageManager implements MyEventListener {\r\n    private initialized: boolean = false;\r\n    private currentPage: HTMLElement | null = null;\r\n    private displayingPages: HTMLElement[] = [];\r\n    private pageMemory: string[][] = [];\r\n    private static instance: PageManager;\r\n    /**\r\n     * @param pageIsReady initが終了したとき\r\n     * @param pageOpened -ページ名　ページが進んだとき　または　同一レイヤーのページに戻るとき\r\n     * @param pageChanged -ページ名　ページが変更されたとき\r\n     * @param setPage -ページ名　ページを進んだ時\r\n     * @param backPages ページを戻った時\r\n     * @param pageBecomeValid ページが有効になったとき\r\n     * @param pageBecomeInvalid ページが無効になったとき\r\n     */\r\n    readonly eventClassNames: string[] = [\"pageIsReady\", \"pageOpened\", \"pageChanged\", \"setPage\", \"backPages\", \"pageBecomeValid\", \"pageBecomeInvalid\", \"setSubPage\"];\r\n    //setPage-ページ名、pageChanged-ページ名\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        return EventManager.addEvent({ classNames, handler });\r\n    }\r\n\r\n    //シングルトン\r\n    constructor() {\r\n        if (PageManager.instance) {\r\n            return PageManager.instance;\r\n        }\r\n        PageManager.instance = this;\r\n    }\r\n\r\n    /**\r\n     * 初期化されているか\r\n     */\r\n    get g$initialized(): boolean {\r\n        return this.initialized;\r\n    }\r\n\r\n    /**\r\n     * 現在のページの要素\r\n     */\r\n    get g$currentPage(): HTMLElement | null {\r\n        return this.currentPage;\r\n    }\r\n\r\n    /**\r\n     * 現在のページのid\r\n     */\r\n    get g$currentPageId(): string | null {\r\n        return this.currentPage ? this.currentPage.id : null;\r\n    }\r\n\r\n    /**\r\n     * 表示されているページの配列\r\n     */\r\n    get g$displayingPages(): HTMLElement[] {\r\n        return [...this.displayingPages];\r\n    }\r\n\r\n    /**\r\n     * ページの遷移記録\r\n     */\r\n    get g$pageMemory(): string[][] {\r\n        return structuredClone(this.pageMemory);\r\n    }\r\n\r\n    /**\r\n     * 現在のページのレイヤー\r\n     */\r\n    get g$currentLayer(): number | null {\r\n        return parseInt(this.currentPage!.dataset.layer || \"0\");\r\n    }\r\n\r\n    //DOMが読み込まれてから読み込んでね\r\n    init() {\r\n        if (this.initialized) {\r\n            return;\r\n        }\r\n        //最初に開くページ\r\n        const initialPageId = document.body.dataset.initialPage || \"title\";\r\n        this.setPage(initialPageId);\r\n\r\n        //pageを戻る処理\r\n        document.querySelectorAll(\".back, [data-back]\").forEach((element) => {\r\n            element.addEventListener(\"click\", () => {\r\n                const back = parseInt((element as HTMLElement).dataset.back || \"1\");\r\n                this.backPages(back);\r\n            });\r\n        });\r\n\r\n        //page遷移処理\r\n        document.querySelectorAll(\"[data-page]\").forEach((element) => {\r\n            element.addEventListener(\"click\", () => {\r\n                const pageId = (element as HTMLElement).dataset.page;\r\n                if (pageId) {\r\n                    this.setPage(pageId);\r\n                }\r\n            });\r\n        });\r\n\r\n        //layerの反映\r\n        document.querySelectorAll(\".page[data-layer]\").forEach((element) => {\r\n            const layer = (element as HTMLElement).dataset.layer;\r\n            (element as HTMLElement).style.zIndex = layer || \"0\";\r\n        });\r\n\r\n        //subPageの挙動\r\n        document.querySelectorAll<HTMLElement>(\".page:has(.subPageNext)\").forEach((element) => {\r\n            const prevElements = Array.from(element.querySelectorAll<HTMLElement>(\".subPagePrev\"));\r\n            const nextElements = Array.from(element.querySelectorAll<HTMLElement>(\".subPageNext\"));\r\n            prevElements.forEach((prev) => {\r\n                prev.addEventListener(\"click\", () => {\r\n                    const length = Array.from(element.querySelectorAll<HTMLElement>(\".subPage\")).length;\r\n                    const prevIndex = (length + this.getSubPageIndex(element)! - 1) % length;\r\n                    this.setSubPage(prevIndex);\r\n                });\r\n            });\r\n            nextElements.forEach((next) => {\r\n                next.addEventListener(\"click\", () => {\r\n                    const length = Array.from(element.querySelectorAll<HTMLElement>(\".subPage\")).length;\r\n                    const nextIndex = (this.getSubPageIndex(element)! + 1) % length;\r\n                    this.setSubPage(nextIndex);\r\n                });\r\n            });\r\n        });\r\n\r\n        this.initialized = true;\r\n        EventManager.executeEventsByClassName(\"pageIsReady\");\r\n    }\r\n\r\n    //すべてのページの表示状態を設定する\r\n    private setPages(pageIds: string[], options?: PageManagerOption) {\r\n        // 新しいページを取得\r\n        const nextPages = pageIds.map((pageId) => document.getElementById(pageId) || null);\r\n        if (nextPages.includes(null)) {\r\n            console.error(\"指定されたpageIdsに存在しないページが含まれていました\");\r\n            return;\r\n        }\r\n\r\n        this.displayingPages.forEach((page) => {\r\n            page.style.display = \"none\";\r\n        });\r\n\r\n        nextPages.forEach((page) => {\r\n            page!.style.display = \"flex\";\r\n        });\r\n\r\n        let preliminaryCurrentPage: HTMLElement | null = null;\r\n        nextPages.forEach((page) => {\r\n            const layer = parseInt(page!.dataset.layer || \"0\");\r\n            let preliminaryMaxLayer = preliminaryCurrentPage ? parseInt(preliminaryCurrentPage.dataset.layer || \"0\") : 0;\r\n            if (preliminaryMaxLayer < layer || preliminaryCurrentPage == null) {\r\n                preliminaryCurrentPage = page;\r\n                preliminaryMaxLayer = layer;\r\n            } else if (preliminaryMaxLayer == layer && preliminaryCurrentPage != null) {\r\n                console.error(\"最大layerが一意になっていません\");\r\n            }\r\n        });\r\n\r\n        this.currentPage = preliminaryCurrentPage as HTMLElement | null;\r\n        this.displayingPages = nextPages as HTMLElement[];\r\n        this.pageMemory.push(pageIds);\r\n        this.setSubPage(0, { eventIgnore: true });\r\n        if (!(options && options.eventIgnore)) {\r\n            EventManager.executeEventsByClassName(\"pageChanged\");\r\n            EventManager.executeEventsByClassName(\"pageChanged-\" + (this.currentPage ? this.currentPage.id : \"\"));\r\n        }\r\n    }\r\n\r\n    //指定したpageIdのページを開く\r\n    //現在のページと同じlayerを開く場合は現在のページは閉じ、上のlayerを開く場合は開いたままにする\r\n    setPage(pageId: string, options?: PageManagerOption) {\r\n        // 新しいページを取得\r\n        const nextPage = document.getElementById(pageId);\r\n        if (!nextPage) {\r\n            console.error(\"指定されたpageIdのページは存在しません:\" + pageId);\r\n            return;\r\n        }\r\n\r\n        let nextDisplayingPages = [...this.displayingPages];\r\n\r\n        // 現在のページを非表示にする\r\n        if (this.currentPage) {\r\n            const currentLayer = parseInt(this.currentPage.dataset.layer || \"0\");\r\n            const nextLayer = parseInt(nextPage.dataset.layer || \"0\");\r\n            //同じlayerなら元のページは非表示\r\n            if (nextLayer == currentLayer) {\r\n                nextDisplayingPages = nextDisplayingPages.filter((page) => page.id != this.currentPage!.id);\r\n            } else if (nextLayer < currentLayer) {\r\n                throw new Error(\"現在のlayerを下回るlayerのページには遷移できません\");\r\n            }\r\n        }\r\n        nextDisplayingPages.push(nextPage);\r\n        this.setPages(\r\n            nextDisplayingPages.map((page) => page.id),\r\n            options\r\n        );\r\n        if (!(options && options.eventIgnore)) {\r\n            EventManager.executeEventsByClassName(\"setPage\");\r\n            EventManager.executeEventsByClassName(\"setPage-\" + pageId);\r\n            EventManager.executeEventsByClassName(\"pageOpened\");\r\n            EventManager.executeEventsByClassName(\"pageOpened-\" + pageId);\r\n        }\r\n    }\r\n\r\n    //numberの数だけ前のページの状態に戻る\r\n    backPages(number: number, options?: PageManagerOption) {\r\n        if (number == -1) {\r\n            number = this.pageMemory.length - 1;\r\n        }\r\n        if (this.pageMemory.length < number + 1 || number < -1) {\r\n            console.log(\"ページ遷移の記録がないため戻ることはできません\");\r\n            return;\r\n        }\r\n        const currentLayer = this.g$currentLayer!;\r\n        this.setPages(this.pageMemory[this.pageMemory.length - number - 1], options);\r\n        this.pageMemory = this.pageMemory.slice(0, -number - 1);\r\n        if (!(options && options.eventIgnore)) {\r\n            if (currentLayer == this.g$currentLayer) {\r\n                EventManager.executeEventsByClassName(\"pageOpened\");\r\n                EventManager.executeEventsByClassName(\"pageOpened-\" + this.currentPage!.id);\r\n            }\r\n            EventManager.executeEventsByClassName(\"backPages\");\r\n        }\r\n    }\r\n\r\n    //すべてのページを非表示にする\r\n    //invalidPanelが存在する場合は表示する\r\n    set s$valid(valid: boolean) {\r\n        this.displayingPages.forEach((page) => {\r\n            page.style.display = valid ? \"flex\" : \"none\";\r\n        });\r\n        const invalidPanel = document.getElementById(\"invalidPanel\");\r\n        if (invalidPanel) {\r\n            invalidPanel.style.display = valid ? \"none\" : \"flex\";\r\n        }\r\n        EventManager.executeEventsByClassName(valid ? \"pageBecomeValid\" : \"pageBecomeInvalid\");\r\n    }\r\n\r\n    /**\r\n     * @param pageId 指定するpageId\r\n     * @returns 最後に指定したpageを開いている状態は何回前か 存在しなければ-1\r\n     */\r\n    getLatestBackIndex(pageId: string): number {\r\n        const index =\r\n            this.pageMemory.length -\r\n            1 -\r\n            this.pageMemory.findLastIndex((memory) => {\r\n                return memory.includes(pageId);\r\n            });\r\n        return index == this.pageMemory.length ? -1 : index;\r\n    }\r\n\r\n    /**\r\n     * 最後に指定したpageを開いている状態まで戻す　存在しなければ何もしない\r\n     * @param pageId 指定するpageId\r\n     */\r\n    backLatestPage(pageId: string, options?: PageManagerOption) {\r\n        const index = this.getLatestBackIndex(pageId);\r\n        if (index == -1) {\r\n            return;\r\n        }\r\n        this.backPages(index, options);\r\n    }\r\n\r\n    setSubPage(index: number, options?: PageManagerOption) {\r\n        if (!this.currentPage || !this.currentPage.querySelector(`.subPage`)) {\r\n            return;\r\n        }\r\n        const subPages = Array.from(this.currentPage.querySelectorAll<HTMLElement>(\".subPage\"));\r\n        const subPageLabel = this.currentPage.querySelector(\".subPageLabel\");\r\n        subPages.forEach((subPage, i) => {\r\n            if (i == index) {\r\n                subPage.style.display = \"\";\r\n                if (subPageLabel) {\r\n                    subPageLabel.innerHTML = `${index + 1} / ${subPages.length}`;\r\n                }\r\n            } else {\r\n                subPage.style.display = \"none\";\r\n            }\r\n        });\r\n        if (!(options && options.eventIgnore)) {\r\n            EventManager.executeEventsByClassName(\"setSubPage\");\r\n        }\r\n    }\r\n\r\n    getSubPageIndex(page: HTMLElement): number | null {\r\n        if (!page || !page.querySelector(`.subPage`)) {\r\n            return null;\r\n        }\r\n        const subPages = Array.from(page.querySelectorAll<HTMLElement>(\".subPage\"));\r\n        return subPages.findIndex((subPage) => subPage.style.display != \"none\");\r\n    }\r\n}\r\n\r\nexport const pageManager: PageManager = new PageManager();\r\n","import { EventManager } from \"./EventManager\";\r\n// import { gameManager } from \"./Run\";\r\n\r\n// function sleepGame(ms: number): Promise<void> {\r\n//     if (!gameManager) {\r\n//         return sleep(ms);\r\n//     }\r\n//     return new Promise((resolve) => {\r\n//         const sleepStartTime = gameManager.g$elapsedTime;\r\n//         const eventId = gameManager.addEvent([\"gameLoop\"], () => {\r\n//             if (sleepStartTime + ms <= gameManager.g$elapsedTime) {\r\n//                 resolve();\r\n//                 EventManager.removeEvent(eventId);\r\n//             }\r\n//         });\r\n//     });\r\n// }\r\n\r\n/**\r\n * 簡易的スリープ\r\n * @param ms 処理を止めるミリ秒数\r\n */\r\nfunction sleep(ms: number): Promise<void> {\r\n    return new Promise((resolve) => {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\r\n\r\nfunction printDotToVertices(left: number, top: number, color?: string) {\r\n    const printDots = document.getElementsByClassName(\"printDot\");\r\n    if (printDots.length >= 100) {\r\n        [...printDots].forEach((element) => {\r\n            element.remove();\r\n        });\r\n    }\r\n    const dot = document.createElement(\"div\");\r\n    dot.className = \"printDot\";\r\n    dot.style.width = \"8px\";\r\n    dot.style.height = \"8px\";\r\n    dot.style.position = \"absolute\";\r\n    dot.style.top = top - 1 + \"px\";\r\n    dot.style.left = left - 1 + \"px\";\r\n    dot.style.backgroundColor = color || \"#ff0000\";\r\n    let dotZIndex = 100;\r\n    dot.style.zIndex = dotZIndex + \"\";\r\n    document.querySelector(\"#play\")!.appendChild(dot);\r\n}\r\n\r\n/**\r\n * 画面上の指定した座標に点を表示する(デバッグ用)\r\n * @param left 画面左端からの距離(px)\r\n * @param top 画面上端からの距離(px)\r\n * @param color 点の色\r\n */\r\nfunction printDot(left: number, top: number, color?: string) {\r\n    const printDots = document.getElementsByClassName(\"printDot\");\r\n    if (printDots.length >= 100) {\r\n        [...printDots].forEach((element) => {\r\n            element.remove();\r\n        });\r\n    }\r\n    const dot = document.createElement(\"div\");\r\n    dot.className = \"printDot\";\r\n    dot.style.width = \"5px\";\r\n    dot.style.height = \"5px\";\r\n    dot.style.position = \"absolute\";\r\n    dot.style.top = top - 1 + \"px\";\r\n    dot.style.left = left - 1 + \"px\";\r\n    dot.style.backgroundColor = color || \"#ff0000\";\r\n    let dotZIndex = 100;\r\n    dot.style.zIndex = dotZIndex + \"\";\r\n    document.body.appendChild(dot);\r\n}\r\n\r\n/**\r\n * 配列の中身を混ぜる\r\n * @param array 混ぜる配列\r\n */\r\nfunction mixArray(array: any[]) {\r\n    const mixCount = (array.length * Math.log(array.length)) / 2;\r\n    let a, b;\r\n    let i, j;\r\n    for (let k = 0; k < mixCount; k++) {\r\n        i = Math.floor(Math.random() * array.length);\r\n        j = Math.floor(Math.random() * array.length);\r\n        a = array[i];\r\n        b = array[j];\r\n        array[i] = b;\r\n        array[j] = a;\r\n    }\r\n}\r\n\r\n/**\r\n * document.querySelectorAllのHTMLElement限定の略記\r\n * @param selector セレクタ\r\n * @returns 指定したHTMLElementの配列\r\n */\r\nfunction qsAll(selector: string): HTMLElement[] {\r\n    return Array.from(document.querySelectorAll(selector)) as HTMLElement[];\r\n}\r\n\r\n/**\r\n * document.querySelectorのHTMLElement限定の略記\r\n * @param selector セレクタ\r\n * @returns 指定したHTMLElement\r\n */\r\nfunction qs(selector: string): HTMLElement {\r\n    return document.querySelector(selector) as HTMLElement;\r\n}\r\n\r\n/**\r\n * HTMLElementにイベントを追加する\r\n * @param selector セレクタ\r\n * @param eventName イベントの名前\r\n * @param handler クリック時に行う処理\r\n */\r\nfunction qsAddEvent(selector: string, eventName: string, handler: (element: HTMLElement) => any) {\r\n    qsAll(selector).forEach((element) => {\r\n        element.addEventListener(eventName, () => {\r\n            handler(element);\r\n        });\r\n    });\r\n}\r\n\r\nfunction debounce(fn: Function, delay: number) {\r\n    let timeout: number | undefined;\r\n    return () => {\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(fn, delay);\r\n    };\r\n}\r\n\r\nfunction arrayPlus(a: number[], b: number[]): number[] {\r\n    if (a.length <= b.length) {\r\n        return a.map((n, i) => n + b[i]);\r\n    } else {\r\n        return b.map((n, i) => n + a[i]);\r\n    }\r\n}\r\n\r\nfunction getMinElement(array: { element: any; value: number }[]) {\r\n    if (array.length == 0) {\r\n        return null;\r\n    }\r\n    let minValue = Infinity;\r\n    let result: any = null;\r\n    array.forEach(({ element, value }) => {\r\n        if (value < minValue) {\r\n            minValue = value;\r\n            result = element;\r\n        }\r\n    });\r\n    return result;\r\n}\r\n\r\nfunction removeMousePointerTemporary() {\r\n    if (document.body.style.cursor != \"none\") {\r\n        document.body.style.cursor = \"none\";\r\n        window.addEventListener(\r\n            \"mousemove\",\r\n            () => {\r\n                document.body.style.cursor = \"\";\r\n            },\r\n            { once: true }\r\n        );\r\n    }\r\n}\r\n\r\nexport { sleep, printDotToVertices as printDot, mixArray, qsAll, qs, qsAddEvent, debounce, arrayPlus, getMinElement, removeMousePointerTemporary };\r\n","/**\r\n * 実際の時間に即したタイマー\r\n */\r\nexport class TimeManager {\r\n    //時間はすべてmsで管理される\r\n\r\n    private startTime: number | null = null;\r\n    private lastPauseTime: number | null = null;\r\n    private pauseSpan: number = 0;\r\n    private hasStarted: boolean = false;\r\n    private isPausing: boolean = false;\r\n\r\n    /**\r\n     * @param startImmediately インスタンス生成後すぐに開始するかどうか\r\n     */\r\n    constructor(startImmediately: boolean = false) {\r\n        if (startImmediately) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 開始時間\r\n     * まだ開始していない場合はnull\r\n     */\r\n    get g$startTime(): number | null {\r\n        return this.startTime;\r\n    }\r\n\r\n    /**\r\n     * 最後に中断した時間\r\n     * まだ中断したことがない場合はnull\r\n     */\r\n    get g$lastPauseTime(): number | null {\r\n        return this.lastPauseTime;\r\n    }\r\n\r\n    /**\r\n     * 開始されているかどうか\r\n     */\r\n    get g$hasStarted(): boolean {\r\n        return this.hasStarted;\r\n    }\r\n\r\n    /**\r\n     * 中断中かどうか\r\n     */\r\n    get g$isPausing(): boolean {\r\n        return this.isPausing;\r\n    }\r\n\r\n    /**\r\n     * 中断時間の合計\r\n     */\r\n    get g$pauseSpan(): number {\r\n        return this.pauseSpan;\r\n    }\r\n\r\n    /**\r\n     * 時間の計測を開始する\r\n     */\r\n    start(): void {\r\n        if (this.hasStarted) {\r\n            return;\r\n        }\r\n        this.startTime = Date.now();\r\n        this.hasStarted = true;\r\n        this.isPausing = false;\r\n    }\r\n\r\n    /**\r\n     * 時間の計測を中断する\r\n     */\r\n    pause(): void {\r\n        if (!this.hasStarted || this.isPausing) {\r\n            return;\r\n        }\r\n        this.lastPauseTime = Date.now();\r\n        this.isPausing = true;\r\n    }\r\n\r\n    /**\r\n     * 時間の計測を再開する\r\n     */\r\n    resume(): void {\r\n        if (!this.hasStarted || !this.isPausing) {\r\n            return;\r\n        }\r\n        this.pauseSpan += Date.now() - this.lastPauseTime!;\r\n        this.isPausing = false;\r\n    }\r\n\r\n    /**\r\n     * 時間の計測をリセットする\r\n     * @param startImmediately リセット後すぐに開始するかどうか\r\n     */\r\n    reset(startImmediately: boolean = false): void {\r\n        this.startTime = null;\r\n        this.lastPauseTime = null;\r\n        this.pauseSpan = 0;\r\n        this.hasStarted = false;\r\n        this.isPausing = false;\r\n        if (startImmediately) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 経過時間\r\n     * 開始していなければnullを返す\r\n     * @returns 経過時間\r\n     */\r\n    get g$elapsedTime(): number | null {\r\n        if (!this.hasStarted) {\r\n            return null;\r\n        }\r\n        if (this.isPausing) {\r\n            return this.lastPauseTime! - this.pauseSpan - this.startTime!;\r\n        }\r\n        return Date.now() - this.pauseSpan - this.startTime!;\r\n    }\r\n\r\n    /**\r\n     * @param goal 目標経過時間\r\n     * @returns 目標経過時間の達成回数\r\n     */\r\n    getGoalCount(goal: number): number {\r\n        if (!this.hasStarted) {\r\n            return 0;\r\n        }\r\n        return Math.floor(this.g$elapsedTime! / goal);\r\n    }\r\n}\r\n","import { MyEventListener, EventId, EventManager } from \"./EventManager.js\";\r\nimport { TimeManager } from \"./TimeManager.js\";\r\n\r\nexport class LoopManager implements MyEventListener {\r\n    /**\r\n     * 目標ループ頻度(ms)\r\n     * requestAnimationFrameの頻度が最速\r\n     * 0なら自動的に最速\r\n     */\r\n    private loopFrequency: number = 0;\r\n    private loopTimer: TimeManager | null = null;\r\n    private lastLoopCount = 0;\r\n    private loopId: number | null = null;\r\n    private isLooping: boolean = false;\r\n    /**\r\n     * @param loop ループをしたとき\r\n     */\r\n    readonly eventClassNames: string[] = [\"loop\"];\r\n    eventIds: EventId[] = [];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        const eventId = EventManager.addEvent({ classNames: classNames.filter((className) => this.eventClassNames.includes(className)), handler });\r\n        this.eventIds.push(eventId);\r\n        return eventId;\r\n    }\r\n\r\n    /**\r\n     * @param startImmediately インスタンス生成後すぐに開始するかどうか\r\n     */\r\n    constructor(startImmediately: boolean = false) {\r\n        if (startImmediately) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ループ中かどうか\r\n     */\r\n    get g$isLooping() {\r\n        return this.isLooping;\r\n    }\r\n\r\n    /**\r\n     * ループ頻度\r\n     */\r\n    get g$loopFrequency(): number {\r\n        return this.loopFrequency;\r\n    }\r\n\r\n    /**\r\n     * @param frequency 設定したいループ頻度\r\n     */\r\n    set s$loopFrequency(frequency: number) {\r\n        if (!Number.isSafeInteger(frequency) || frequency <= 0) {\r\n            throw new Error(\"不正な値が入力されました: \" + frequency);\r\n        }\r\n        this.loopFrequency = frequency;\r\n    }\r\n\r\n    /**\r\n     * ループを開始する\r\n     */\r\n    start(): void {\r\n        if (this.isLooping) {\r\n            return;\r\n        }\r\n        this.loopId = requestAnimationFrame(this.loop.bind(this));\r\n        if (this.loopTimer) {\r\n            this.loopTimer.resume();\r\n        } else {\r\n            this.loopTimer = new TimeManager(true);\r\n        }\r\n        this.isLooping = true;\r\n    }\r\n\r\n    /**\r\n     * ループを停止する\r\n     */\r\n    stop(): void {\r\n        if (this.loopTimer) {\r\n            this.loopTimer.pause();\r\n        }\r\n        if (this.loopId) {\r\n            cancelAnimationFrame(this.loopId);\r\n        }\r\n        this.isLooping = false;\r\n    }\r\n\r\n    /**\r\n     * ループをリセットする\r\n     */\r\n    reset(): void {\r\n        this.stop();\r\n        if (this.loopTimer) {\r\n            this.loopTimer.reset();\r\n            this.loopTimer = null;\r\n        }\r\n        this.lastLoopCount = 0;\r\n    }\r\n\r\n    /**\r\n     * ループの中身\r\n     */\r\n    private loop() {\r\n        if (!this.loopTimer) {\r\n            return;\r\n        }\r\n        if (!this.isLooping) {\r\n            this.stop();\r\n            return;\r\n        }\r\n        const loopCount = this.loopTimer!.getGoalCount(this.loopFrequency);\r\n        if (this.lastLoopCount != loopCount || loopCount == Infinity) {\r\n            this.lastLoopCount = loopCount;\r\n            EventManager.executeListeningEvents(\"loop\", this.eventIds);\r\n        }\r\n        this.loopId = requestAnimationFrame(this.loop.bind(this));\r\n    }\r\n\r\n    /**\r\n     * @returns ループの合計駆動時間\r\n     */\r\n    get g$elapsedTime(): number {\r\n        if (!this.loopTimer) {\r\n            return 0;\r\n        }\r\n        return this.loopTimer.g$elapsedTime!;\r\n    }\r\n\r\n    /**\r\n     * @param goal 目標経過時間\r\n     * @returns 目標経過時間の達成回数\r\n     */\r\n    getGoalCount(goal: number): number {\r\n        if (!this.loopTimer) {\r\n            return 0;\r\n        }\r\n        return Math.floor(this.g$elapsedTime / goal);\r\n    }\r\n}\r\n","import { MyEventListener, EventId, EventManager } from \"../EventManager\";\r\nimport { LoopManager } from \"../LoopManager\";\r\n\r\nexport type AutoKeyboardInputData = {\r\n    time: number;\r\n    keyCode: string;\r\n    type: \"keydown\" | \"keyup\" | \"downup\";\r\n};\r\n\r\nexport class AutoKeyboardManager implements MyEventListener {\r\n    private loop: LoopManager = new LoopManager();\r\n    private inputData: AutoKeyboardInputData[] = [];\r\n    private inputDataTask: AutoKeyboardInputData[] = [];\r\n    private pressingKeys: string[] = [];\r\n    private pressTimes: number[] = [];\r\n    private valid: boolean = false;\r\n    readonly eventClassNames: string[] = [\"onKeydown\", \"onKeyup\"];\r\n    eventIds: EventId[] = [];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        const eventId = EventManager.addEvent({ classNames: classNames.filter((className) => this.eventClassNames.includes(className)), handler });\r\n        this.eventIds.push(eventId);\r\n        return eventId;\r\n    }\r\n\r\n    constructor() {}\r\n\r\n    //有効かどうか\r\n    get g$isValid(): boolean {\r\n        return this.valid;\r\n    }\r\n\r\n    //押された最新のキー\r\n    get g$latestPressingKey(): string {\r\n        return this.pressingKeys.length != 0 ? this.pressingKeys[this.pressingKeys.length - 1] : \"\";\r\n    }\r\n\r\n    //押された最古のキー\r\n    get g$oldestPressingKey(): string {\r\n        return this.pressingKeys.length != 0 ? this.pressingKeys[0] : \"\";\r\n    }\r\n\r\n    //まだ押されているキーのうちの押された最古の時間\r\n    get g$latestPressTime(): number {\r\n        return this.pressTimes.length != 0 ? this.pressTimes[this.pressTimes.length - 1] : -1;\r\n    }\r\n\r\n    //まだ押されているキーのうちの押された最新の時間\r\n    get g$oldestPressTime(): number {\r\n        return this.pressTimes.length != 0 ? this.pressTimes[0] : -1;\r\n    }\r\n\r\n    get g$inputData() {\r\n        return this.inputData;\r\n    }\r\n\r\n    set s$inputData(inputData: AutoKeyboardInputData[]) {\r\n        if (this.loop.g$isLooping) {\r\n            return;\r\n        }\r\n        this.inputData = inputData;\r\n        this.inputDataTask = window.structuredClone(inputData);\r\n\r\n        const keydownEvent = (keyCode: string) => {\r\n            if (!this.pressingKeys.includes(keyCode)) {\r\n                this.pressingKeys.push(keyCode);\r\n                this.pressTimes.push(Date.now());\r\n                EventManager.executeListeningEvents(\"onKeydown\", this.eventIds);\r\n                // console.log(\"Pressed:\" + keyCode);\r\n            }\r\n        };\r\n        const keyupEvent = (keyCode: string) => {\r\n            this.pressingKeys = this.pressingKeys.filter((keys, i) => {\r\n                if (keys == keyCode) {\r\n                    this.pressTimes[i] = -1;\r\n                }\r\n                return keys != keyCode;\r\n                //console.log(\"Unpressed:\" + keyCode);\r\n            });\r\n            this.pressTimes = this.pressTimes.filter((time) => time != -1);\r\n            EventManager.executeListeningEvents(\"onKeyup\", this.eventIds);\r\n        };\r\n\r\n        EventManager.removeEvents(this.loop.eventIds);\r\n        this.loop.addEvent([\"loop\"], () => {\r\n            while (true) {\r\n                if (this.inputDataTask.length) {\r\n                    if (this.inputDataTask[0].time <= this.loop.g$elapsedTime) {\r\n                        if ([\"keydown\", \"downup\"].includes(this.inputDataTask[0].type)) {\r\n                            keydownEvent(this.inputDataTask[0].keyCode);\r\n                        }\r\n                        if ([\"keyup\", \"downup\"].includes(this.inputDataTask[0].type)) {\r\n                            keyupEvent(this.inputDataTask[0].keyCode);\r\n                        }\r\n                        this.inputDataTask.shift();\r\n                    } else {\r\n                        break;\r\n                    }\r\n                } else {\r\n                    this.loop.stop();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    //入力を受け取るのを開始する\r\n    start() {\r\n        // console.log(this.loop.g$elapsedTime, this.inputDataTask.length);\r\n        if (this.loop.g$elapsedTime && this.inputDataTask.length) {\r\n            this.loop.start();\r\n        }\r\n        this.valid = true;\r\n    }\r\n\r\n    //入力を受け取るのを停止する\r\n    stop() {\r\n        this.valid = false;\r\n        this.loop.stop();\r\n        this.pressingKeys = [];\r\n        this.pressTimes = [];\r\n    }\r\n\r\n    playStart() {\r\n        if (!this.inputDataTask.length) {\r\n            return;\r\n        }\r\n        this.loop.start();\r\n    }\r\n\r\n    playReset() {\r\n        this.loop.reset();\r\n        this.s$inputData = this.inputData;\r\n    }\r\n\r\n    //指定したキーが押されているか\r\n    isPressing(keyCode: string): boolean {\r\n        return this.pressingKeys.includes(keyCode);\r\n    }\r\n\r\n    //指定した複数のキーがすべて押されているか\r\n    arePressing(keyCodes: string[]): boolean {\r\n        let arePressing = true;\r\n        keyCodes.forEach((keyCode) => {\r\n            arePressing = arePressing && this.isPressing(keyCode);\r\n        });\r\n        return arePressing;\r\n    }\r\n\r\n    //指定した複数のキーのどれかが押されているか\r\n    existsPressingKey(keyCodes: string[]) {\r\n        let existsPressingKey = false;\r\n        keyCodes.forEach((keyCode) => {\r\n            existsPressingKey = existsPressingKey || this.isPressing(keyCode);\r\n        });\r\n        return existsPressingKey;\r\n    }\r\n\r\n    //指定したキーが押された時間を返す\r\n    //選択されていない場合は-1を返す\r\n    getPressTime(keyCode: string): number {\r\n        if (this.pressingKeys.indexOf(keyCode) == -1) {\r\n            return -1;\r\n        }\r\n        return this.pressTimes[this.pressingKeys.indexOf(keyCode)];\r\n    }\r\n\r\n    //指定した複数のキーの中で最も遅くに押されたものを返す\r\n    //どれも押されていない場合は空文字を返す\r\n    getLatestPressingKey(keyCodes: string[]): string {\r\n        let index = -1;\r\n        keyCodes.forEach((keyCode) => {\r\n            const i = this.pressingKeys.indexOf(keyCode);\r\n            if (index < i) {\r\n                index = i;\r\n            }\r\n        });\r\n        return index == -1 ? \"\" : this.pressingKeys[index];\r\n    }\r\n\r\n    //指定した複数のキーの中で最も早くに押されたものを返す\r\n    //どれも押されていない場合は空文字を返す\r\n    getOldestPressingKey(keyCodes: string[]): string {\r\n        let index = Infinity;\r\n        keyCodes.forEach((keyCode) => {\r\n            const i = this.pressingKeys.indexOf(keyCode);\r\n            if (i < index && i != -1) {\r\n                index = i;\r\n            }\r\n        });\r\n        return index == -1 ? \"\" : this.pressingKeys[index];\r\n    }\r\n\r\n    //指定した複数のキーの中で押されているものをすべて返す\r\n    getAllPressingKeys(keyCodes: string[]): string[] {\r\n        return this.pressingKeys.filter((keyCode) => keyCodes.includes(keyCode));\r\n    }\r\n}\r\n","import { LoopManager } from \"../LoopManager\";\r\n\r\nexport interface GamepadButtonEvent {\r\n    /**\r\n     * gamepadのindex\r\n     */\r\n    gamepadIndex: number;\r\n    /**\r\n     * buttonのindex\r\n     */\r\n    buttonIndex: number;\r\n    /**\r\n     * 押されているかどうか\r\n     */\r\n    pressed: boolean;\r\n}\r\n\r\nexport interface GamepadAxisEvent {\r\n    /**\r\n     * gamepadのindex\r\n     */\r\n    gamepadIndex: number;\r\n    /**\r\n     * axisのindex\r\n     */\r\n    axisIndex: number;\r\n    /**\r\n     * axisの傾き具合(-1~1)\r\n     */\r\n    value: number;\r\n    /**\r\n     * 閾値を超えて有効と判定されているか\r\n     */\r\n    active: boolean;\r\n}\r\n\r\nexport class GamepadInput {\r\n    private index: number;\r\n    private axisThreshold: number;\r\n    private loop = new LoopManager();\r\n    private lastButtons: boolean[] = [];\r\n    private lastAxesInfo: GamepadAxisEvent[] = [];\r\n\r\n    // コールバック\r\n    onButtonDown: ((ev: GamepadButtonEvent) => void) | null = null;\r\n    onButtonUp: ((ev: GamepadButtonEvent) => void) | null = null;\r\n    onAxisActive: ((ev: GamepadAxisEvent) => void) | null = null;\r\n    onAxisInactive: ((ev: GamepadAxisEvent) => void) | null = null;\r\n\r\n    constructor(index: number, axisThreshold: number = 0.4) {\r\n        this.index = index;\r\n        this.axisThreshold = axisThreshold;\r\n\r\n        const loop = () => {\r\n            const gamepad = navigator.getGamepads()[this.index];\r\n            if (!gamepad) {\r\n                // 切断状態\r\n                return;\r\n            }\r\n\r\n            this.processGamepad(gamepad);\r\n        };\r\n\r\n        this.loop.addEvent([\"loop\"], loop.bind(this));\r\n    }\r\n\r\n    get g$connecting(): boolean {\r\n        return navigator.getGamepads()[this.index] != null;\r\n    }\r\n\r\n    /**\r\n     * ループ開始\r\n     */\r\n    start() {\r\n        this.loop.start();\r\n    }\r\n\r\n    /**\r\n     * ボタン/スティックの状態変化を処理\r\n     */\r\n    private processGamepad(gp: Gamepad) {\r\n        // ボタン\r\n        gp.buttons.forEach((btn, i) => {\r\n            const isPressed = btn.pressed;\r\n            const wasPressed = this.lastButtons[i] ?? false;\r\n\r\n            if (isPressed !== wasPressed) {\r\n                if (isPressed) {\r\n                    this.onButtonDown?.({\r\n                        gamepadIndex: this.index,\r\n                        buttonIndex: i,\r\n                        pressed: true,\r\n                    });\r\n                } else {\r\n                    this.onButtonUp?.({\r\n                        gamepadIndex: this.index,\r\n                        buttonIndex: i,\r\n                        pressed: false,\r\n                    });\r\n                }\r\n            }\r\n\r\n            this.lastButtons[i] = isPressed;\r\n        });\r\n\r\n        // スティック\r\n        gp.axes.forEach((value, i) => {\r\n            const isActive = Math.abs(value) >= this.axisThreshold;\r\n            const wasActive = this.lastAxesInfo[i] ? this.lastAxesInfo[i].active : false;\r\n\r\n            if (isActive !== wasActive) {\r\n                if (isActive) {\r\n                    this.onAxisActive?.({\r\n                        gamepadIndex: this.index,\r\n                        axisIndex: i,\r\n                        value,\r\n                        active: true,\r\n                    });\r\n                } else {\r\n                    this.onAxisInactive?.({\r\n                        gamepadIndex: this.index,\r\n                        axisIndex: i,\r\n                        value: this.lastAxesInfo[i].value ?? 0,\r\n                        active: false,\r\n                    });\r\n                }\r\n            } else if ((this.lastAxesInfo[i] ? this.lastAxesInfo[i].value : 0) * value < 0) {\r\n                if (wasActive) {\r\n                    this.onAxisInactive?.({\r\n                        gamepadIndex: this.index,\r\n                        axisIndex: i,\r\n                        value: this.lastAxesInfo[i].value ?? 0,\r\n                        active: false,\r\n                    });\r\n                }\r\n                if (isActive) {\r\n                    this.onAxisActive?.({\r\n                        gamepadIndex: this.index,\r\n                        axisIndex: i,\r\n                        value,\r\n                        active: true,\r\n                    });\r\n                }\r\n            }\r\n\r\n            this.lastAxesInfo[i] = {\r\n                gamepadIndex: this.index,\r\n                axisIndex: i,\r\n                value,\r\n                active: isActive,\r\n            };\r\n        });\r\n    }\r\n\r\n    /**\r\n     * ループ停止\r\n     */\r\n    stop() {\r\n        this.loop.stop();\r\n    }\r\n}\r\n","import { MyEventListener, EventId, EventManager } from \"../EventManager\";\r\nimport { GamepadInput } from \"./GamepadInput\";\r\n\r\nexport class GamepadManager implements MyEventListener {\r\n    private input: GamepadInput;\r\n    private pressingKeys: string[] = [];\r\n    private pressTimes: number[] = [];\r\n    private valid: boolean = false;\r\n    //keyCodeはbutton:*buttonIndex*、stick:+*axisIndex*、stick:-*axisIndex*の形\r\n\r\n    readonly eventClassNames: string[] = [\"onButtondown\", \"onButtonup\", \"onStickActive\", \"onStickInactive\"];\r\n    eventIds: EventId[] = [];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        const eventId = EventManager.addEvent({ classNames: classNames.filter((className) => this.eventClassNames.includes(className)), handler });\r\n        this.eventIds.push(eventId);\r\n        return eventId;\r\n    }\r\n\r\n    constructor(index: number) {\r\n        this.input = new GamepadInput(index);\r\n        this.input.onButtonDown = (e) => {\r\n            if (!this.pressingKeys.includes(\"button:\" + e.buttonIndex)) {\r\n                this.pressingKeys.push(\"button:\" + e.buttonIndex);\r\n                this.pressTimes.push(Date.now());\r\n                EventManager.executeListeningEvents(\"onButtondown\", this.eventIds);\r\n                // console.log(\"Pressed:\" + e.buttonIndex);\r\n            }\r\n        };\r\n        this.input.onButtonUp = (e) => {\r\n            this.pressingKeys = this.pressingKeys.filter((keys, i) => {\r\n                if (keys == \"button:\" + e.buttonIndex) {\r\n                    this.pressTimes[i] = -1;\r\n                }\r\n                return keys != \"button:\" + e.buttonIndex;\r\n            });\r\n            this.pressTimes = this.pressTimes.filter((time) => time != -1);\r\n            EventManager.executeListeningEvents(\"onButtonup\", this.eventIds);\r\n            // console.log(\"Unpressed:\" + e.buttonIndex);\r\n        };\r\n        this.input.onAxisActive = (e) => {\r\n            if (e.value > 0) {\r\n                if (!this.pressingKeys.includes(\"stick:+\" + e.axisIndex)) {\r\n                    this.pressingKeys.push(\"stick:+\" + e.axisIndex);\r\n                    this.pressTimes.push(Date.now());\r\n                    EventManager.executeListeningEvents(\"onStickActive\", this.eventIds);\r\n                    // console.log(\"Activated:+\" + e.axisIndex);\r\n                }\r\n            } else {\r\n                if (!this.pressingKeys.includes(\"stick:-\" + e.axisIndex)) {\r\n                    this.pressingKeys.push(\"stick:-\" + e.axisIndex);\r\n                    this.pressTimes.push(Date.now());\r\n                    EventManager.executeListeningEvents(\"onStickActive\", this.eventIds);\r\n                    // console.log(\"Activated:-\" + e.axisIndex);\r\n                }\r\n            }\r\n        };\r\n        this.input.onAxisInactive = (e) => {\r\n            if (e.value > 0) {\r\n                this.pressingKeys = this.pressingKeys.filter((keys, i) => {\r\n                    if (keys == \"stick:+\" + e.axisIndex) {\r\n                        this.pressTimes[i] = -1;\r\n                    }\r\n                    return keys != \"stick:+\" + e.axisIndex;\r\n                });\r\n                this.pressTimes = this.pressTimes.filter((time) => time != -1);\r\n                EventManager.executeListeningEvents(\"onStickInactive\", this.eventIds);\r\n                // console.log(\"Inactivated:+\" + e.axisIndex);\r\n            } else {\r\n                this.pressingKeys = this.pressingKeys.filter((keys, i) => {\r\n                    if (keys == \"stick:-\" + e.axisIndex) {\r\n                        this.pressTimes[i] = -1;\r\n                    }\r\n                    return keys != \"stick:-\" + e.axisIndex;\r\n                });\r\n                this.pressTimes = this.pressTimes.filter((time) => time != -1);\r\n                EventManager.executeListeningEvents(\"onStickInactive\", this.eventIds);\r\n                // console.log(\"Inactivated:-\" + e.axisIndex);\r\n            }\r\n        };\r\n    }\r\n\r\n    //有効かどうか\r\n    get g$isValid(): boolean {\r\n        return this.valid;\r\n    }\r\n\r\n    //押された最新のキー\r\n    get g$latestPressingKey(): string {\r\n        return this.pressingKeys.length != 0 ? this.pressingKeys[this.pressingKeys.length - 1] : \"\";\r\n    }\r\n\r\n    //押された最古のキー\r\n    get g$oldestPressingKey(): string {\r\n        return this.pressingKeys.length != 0 ? this.pressingKeys[0] : \"\";\r\n    }\r\n\r\n    //まだ押されているキーのうちの押された最古の時間\r\n    get g$latestPressTime(): number {\r\n        return this.pressTimes.length != 0 ? this.pressTimes[this.pressTimes.length - 1] : -1;\r\n    }\r\n\r\n    //まだ押されているキーのうちの押された最新の時間\r\n    get g$oldestPressTime(): number {\r\n        return this.pressTimes.length != 0 ? this.pressTimes[0] : -1;\r\n    }\r\n\r\n    //入力を受け取るのを開始する\r\n    start() {\r\n        if (this.valid) {\r\n            return;\r\n        }\r\n        this.input.start();\r\n        this.valid = true;\r\n    }\r\n\r\n    //入力を受け取るのを停止する\r\n    stop() {\r\n        if (!this.valid) {\r\n            return;\r\n        }\r\n        this.valid = false;\r\n        this.input.stop();\r\n        this.pressingKeys = [];\r\n        this.pressTimes = [];\r\n    }\r\n\r\n    //指定したキーが押されているか\r\n    isPressing(keyCode: string): boolean {\r\n        return this.pressingKeys.includes(keyCode);\r\n    }\r\n\r\n    //指定した複数のキーがすべて押されているか\r\n    arePressing(keyCodes: string[]): boolean {\r\n        let arePressing = true;\r\n        keyCodes.forEach((keyCode) => {\r\n            arePressing = arePressing && this.isPressing(keyCode);\r\n        });\r\n        return arePressing;\r\n    }\r\n\r\n    //指定した複数のキーのどれかが押されているか\r\n    existsPressingKey(keyCodes: string[]) {\r\n        let existsPressingKey = false;\r\n        keyCodes.forEach((keyCode) => {\r\n            existsPressingKey = existsPressingKey || this.isPressing(keyCode);\r\n        });\r\n        return existsPressingKey;\r\n    }\r\n\r\n    //指定したキーが押された時間を返す\r\n    //選択されていない場合は-1を返す\r\n    getPressTime(keyCode: string): number {\r\n        if (this.pressingKeys.indexOf(keyCode) == -1) {\r\n            return -1;\r\n        }\r\n        return this.pressTimes[this.pressingKeys.indexOf(keyCode)];\r\n    }\r\n\r\n    //指定した複数のキーの中で最も遅くに押されたものを返す\r\n    //どれも押されていない場合は空文字を返す\r\n    getLatestPressingKey(keyCodes: string[]): string {\r\n        let index = -1;\r\n        keyCodes.forEach((keyCode) => {\r\n            const i = this.pressingKeys.indexOf(keyCode);\r\n            if (index < i) {\r\n                index = i;\r\n            }\r\n        });\r\n        return index == -1 ? \"\" : this.pressingKeys[index];\r\n    }\r\n\r\n    //指定した複数のキーの中で最も早くに押されたものを返す\r\n    //どれも押されていない場合は空文字を返す\r\n    getOldestPressingKey(keyCodes: string[]): string {\r\n        let index = Infinity;\r\n        keyCodes.forEach((keyCode) => {\r\n            const i = this.pressingKeys.indexOf(keyCode);\r\n            if (i < index && i != -1) {\r\n                index = i;\r\n            }\r\n        });\r\n        return index == -1 ? \"\" : this.pressingKeys[index];\r\n    }\r\n\r\n    //指定した複数のキーの中で押されているものをすべて返す\r\n    getAllPressingKeys(keyCodes: string[]): string[] {\r\n        return this.pressingKeys.filter((keyCode) => keyCodes.includes(keyCode));\r\n    }\r\n}\r\n","import { MyEventListener, EventId, EventManager } from \"../EventManager\";\r\n\r\nexport class KeyboardManager implements MyEventListener {\r\n    private pressingKeys: string[] = [];\r\n    private pressTimes: number[] = [];\r\n    private valid: boolean = false;\r\n    private keydownEvent: (e: KeyboardEvent) => any;\r\n    private keyupEvent: (e: KeyboardEvent) => any;\r\n    readonly eventClassNames: string[] = [\"onKeydown\", \"onKeyup\"];\r\n    eventIds: EventId[] = [];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        const eventId = EventManager.addEvent({ classNames: classNames.filter((className) => this.eventClassNames.includes(className)), handler });\r\n        this.eventIds.push(eventId);\r\n        return eventId;\r\n    }\r\n\r\n    constructor() {\r\n        this.keydownEvent = (e: KeyboardEvent) => {\r\n            if (!this.pressingKeys.includes(e.code)) {\r\n                this.pressingKeys.push(e.code);\r\n                this.pressTimes.push(Date.now());\r\n                EventManager.executeListeningEvents(\"onKeydown\", this.eventIds);\r\n                //console.log(\"Pressed:\" + e.code);\r\n            }\r\n        };\r\n        this.keyupEvent = (e: KeyboardEvent) => {\r\n            this.pressingKeys = this.pressingKeys.filter((keys, i) => {\r\n                if (keys == e.code) {\r\n                    this.pressTimes[i] = -1;\r\n                }\r\n                return keys != e.code;\r\n                //console.log(\"Unpressed:\" + e.code);\r\n            });\r\n            this.pressTimes = this.pressTimes.filter((time) => time != -1);\r\n            EventManager.executeListeningEvents(\"onKeyup\", this.eventIds);\r\n        };\r\n    }\r\n\r\n    //有効かどうか\r\n    get g$isValid(): boolean {\r\n        return this.valid;\r\n    }\r\n\r\n    //押された最新のキー\r\n    get g$latestPressingKey(): string {\r\n        return this.pressingKeys.length != 0 ? this.pressingKeys[this.pressingKeys.length - 1] : \"\";\r\n    }\r\n\r\n    //押された最古のキー\r\n    get g$oldestPressingKey(): string {\r\n        return this.pressingKeys.length != 0 ? this.pressingKeys[0] : \"\";\r\n    }\r\n\r\n    //まだ押されているキーのうちの押された最古の時間\r\n    get g$latestPressTime(): number {\r\n        return this.pressTimes.length != 0 ? this.pressTimes[this.pressTimes.length - 1] : -1;\r\n    }\r\n\r\n    //まだ押されているキーのうちの押された最新の時間\r\n    get g$oldestPressTime(): number {\r\n        return this.pressTimes.length != 0 ? this.pressTimes[0] : -1;\r\n    }\r\n\r\n    //入力を受け取るのを開始する\r\n    start() {\r\n        if (this.valid) {\r\n            return;\r\n        }\r\n        document.addEventListener(\"keydown\", this.keydownEvent);\r\n        document.addEventListener(\"keyup\", this.keyupEvent);\r\n        this.valid = true;\r\n    }\r\n\r\n    //入力を受け取るのを停止する\r\n    stop() {\r\n        if (!this.valid) {\r\n            return;\r\n        }\r\n        this.valid = false;\r\n        document.removeEventListener(\"keydown\", this.keydownEvent);\r\n        document.removeEventListener(\"keyup\", this.keyupEvent);\r\n        this.pressingKeys = [];\r\n        this.pressTimes = [];\r\n    }\r\n\r\n    //指定したキーが押されているか\r\n    isPressing(keyCode: string): boolean {\r\n        return this.pressingKeys.includes(keyCode);\r\n    }\r\n\r\n    //指定した複数のキーがすべて押されているか\r\n    arePressing(keyCodes: string[]): boolean {\r\n        let arePressing = true;\r\n        keyCodes.forEach((keyCode) => {\r\n            arePressing = arePressing && this.isPressing(keyCode);\r\n        });\r\n        return arePressing;\r\n    }\r\n\r\n    //指定した複数のキーのどれかが押されているか\r\n    existsPressingKey(keyCodes: string[]) {\r\n        let existsPressingKey = false;\r\n        keyCodes.forEach((keyCode) => {\r\n            existsPressingKey = existsPressingKey || this.isPressing(keyCode);\r\n        });\r\n        return existsPressingKey;\r\n    }\r\n\r\n    //指定したキーが押された時間を返す\r\n    //選択されていない場合は-1を返す\r\n    getPressTime(keyCode: string): number {\r\n        if (this.pressingKeys.indexOf(keyCode) == -1) {\r\n            return -1;\r\n        }\r\n        return this.pressTimes[this.pressingKeys.indexOf(keyCode)];\r\n    }\r\n\r\n    //指定した複数のキーの中で最も遅くに押されたものを返す\r\n    //どれも押されていない場合は空文字を返す\r\n    getLatestPressingKey(keyCodes: string[]): string {\r\n        let index = -1;\r\n        keyCodes.forEach((keyCode) => {\r\n            const i = this.pressingKeys.indexOf(keyCode);\r\n            if (index < i) {\r\n                index = i;\r\n            }\r\n        });\r\n        return index == -1 ? \"\" : this.pressingKeys[index];\r\n    }\r\n\r\n    //指定した複数のキーの中で最も早くに押されたものを返す\r\n    //どれも押されていない場合は空文字を返す\r\n    getOldestPressingKey(keyCodes: string[]): string {\r\n        let index = Infinity;\r\n        keyCodes.forEach((keyCode) => {\r\n            const i = this.pressingKeys.indexOf(keyCode);\r\n            if (i < index && i != -1) {\r\n                index = i;\r\n            }\r\n        });\r\n        return index == -1 ? \"\" : this.pressingKeys[index];\r\n    }\r\n\r\n    //指定した複数のキーの中で押されているものをすべて返す\r\n    getAllPressingKeys(keyCodes: string[]): string[] {\r\n        return this.pressingKeys.filter((keyCode) => keyCodes.includes(keyCode));\r\n    }\r\n}\r\n","import { AutoKeyboardManager } from \"./AutoKeyboardManager\";\r\nimport { GamepadManager } from \"./GamepadManager\";\r\nimport { KeyboardManager } from \"./KeyboardManager\";\r\n\r\ntype InputType = \"keyboard\" | \"gamepad\" | \"autoKeyboard\";\r\n\r\nexport class Input {\r\n    manager: KeyboardManager | GamepadManager | AutoKeyboardManager;\r\n    type: InputType;\r\n    index: number;\r\n    constructor(type: InputType = \"keyboard\", index = 0) {\r\n        this.type = type;\r\n        this.index = index;\r\n        if (type == \"keyboard\") {\r\n            this.manager = new KeyboardManager();\r\n        } else if (type == \"gamepad\") {\r\n            this.manager = new GamepadManager(index);\r\n        } else if (type == \"autoKeyboard\") {\r\n            this.manager = new AutoKeyboardManager();\r\n        } else {\r\n            const never: never = type;\r\n\r\n            console.log(\"不明なinput形式を指定されました\");\r\n            this.type = \"keyboard\";\r\n            this.manager = new KeyboardManager();\r\n        }\r\n    }\r\n\r\n    get g$manager() {\r\n        return this.manager;\r\n    }\r\n\r\n    get g$type() {\r\n        return this.type;\r\n    }\r\n\r\n    isAuto(): this is Input & { g$manager: AutoKeyboardManager } {\r\n        return this.manager instanceof AutoKeyboardManager;\r\n    }\r\n}\r\n","import { EventId, EventManager } from \"../EventManager\";\r\nimport { Input } from \"./Input\";\r\n\r\nclass InputManager {\r\n    private static instance: InputManager;\r\n    private registering = false;\r\n    private inputTypes: string[] = [\"keyboard\"];\r\n    private inputs: Input[] = [new Input(\"keyboard\")];\r\n    private maxInputNumber: number = 4;\r\n    private registerEventIds: EventId[] = [];\r\n    private registeredInputs: Input[] = [];\r\n\r\n    readonly eventClassNames: string[] = [\"inputRegistered\", \"finishRegister\", \"inputAdded\"];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        return EventManager.addEvent({ classNames, handler });\r\n    }\r\n\r\n    constructor() {\r\n        if (InputManager.instance) {\r\n            return InputManager.instance;\r\n        }\r\n        InputManager.instance = this;\r\n\r\n        window.addEventListener(\"gamepadconnected\", (e) => {\r\n            if (!this.inputTypes.includes(`gamepad:${e.gamepad.index}`)) {\r\n                this.inputTypes.push(`gamepad:${e.gamepad.index}`);\r\n                const input = new Input(\"gamepad\", e.gamepad.index);\r\n                this.inputs.push(input);\r\n                input.g$manager.start();\r\n                if (this.registering) {\r\n                    this.addRegisterEvent(input);\r\n                }\r\n                EventManager.executeEventsByClassName(\"inputAdded\");\r\n            }\r\n        });\r\n        this.inputs[0].g$manager.start();\r\n    }\r\n\r\n    get g$registeredInputs() {\r\n        return this.registeredInputs;\r\n    }\r\n\r\n    get g$maxInputNumber() {\r\n        return this.maxInputNumber;\r\n    }\r\n\r\n    get g$registering() {\r\n        return this.registering;\r\n    }\r\n\r\n    get g$registeredInputNumber() {\r\n        return this.registeredInputs.length;\r\n    }\r\n\r\n    get g$inputs() {\r\n        return this.inputs;\r\n    }\r\n\r\n    set s$maxInputNumber(maxInputNumber: number) {\r\n        this.maxInputNumber = maxInputNumber;\r\n    }\r\n\r\n    startRegister() {\r\n        this.registering = true;\r\n        this.registeredInputs = [];\r\n        this.registerEventIds = [];\r\n        this.inputs.forEach((input) => {\r\n            this.addRegisterEvent(input);\r\n        });\r\n        this.start();\r\n    }\r\n\r\n    finishRegister() {\r\n        if (!this.registering) {\r\n            return;\r\n        }\r\n        EventManager.removeEvents(this.registerEventIds);\r\n        this.registering = false;\r\n        EventManager.executeEventsByClassName(\"finishRegister\");\r\n    }\r\n\r\n    private addRegisterEvent(input: Input) {\r\n        this.registerEventIds.push(\r\n            input.g$manager.addEvent([\"onKeydown\", \"onButtondown\", \"onStickActive\"], () => {\r\n                if (!this.registeredInputs.includes(input)) {\r\n                    this.registeredInputs.push(input);\r\n                    EventManager.executeEventsByClassName(\"inputRegistered\");\r\n                }\r\n                if (this.registeredInputs.length >= this.maxInputNumber) {\r\n                    this.finishRegister();\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    resetRegister() {\r\n        this.registering = false;\r\n        this.registeredInputs = [];\r\n        EventManager.removeEvents(this.registerEventIds);\r\n        this.inputs.forEach((input) => {\r\n            EventManager.removeEvents(input.g$manager.eventIds);\r\n        });\r\n    }\r\n\r\n    start() {\r\n        this.inputs.forEach((input) => {\r\n            input.g$manager.start();\r\n        });\r\n    }\r\n\r\n    stop() {\r\n        this.inputs.forEach((input) => {\r\n            input.g$manager.stop();\r\n        });\r\n    }\r\n\r\n    addInput(input: Input) {\r\n        if (!this.inputs.includes(input)) {\r\n            this.inputs.push(input);\r\n            this.inputTypes.push(input.g$type);\r\n        }\r\n    }\r\n\r\n    removeVirtualInputs() {\r\n        this.inputTypes = this.inputTypes.filter((type) => type == \"keyboard\" || type.includes(\"gamepad\"));\r\n        this.inputs\r\n            .filter((input) => ![\"keyboard\", \"gamepad\"].includes(input.g$type))\r\n            .forEach((input) => {\r\n                input.g$manager.stop();\r\n            });\r\n        this.inputs = this.inputs.filter((input) => [\"keyboard\", \"gamepad\"].includes(input.g$type));\r\n        this.registeredInputs = this.registeredInputs.filter((input) => [\"keyboard\", \"gamepad\"].includes(input.g$type));\r\n    }\r\n\r\n    register(input: Input) {\r\n        if (this.registeredInputs.length >= this.maxInputNumber) {\r\n            return;\r\n        }\r\n        this.addInput(input);\r\n        if (!this.registeredInputs.includes(input)) {\r\n            this.registeredInputs.push(input);\r\n            EventManager.executeEventsByClassName(\"inputRegistered\");\r\n        }\r\n    }\r\n}\r\n\r\nexport const inputManager = new InputManager();\r\n","//盤面のサイズ\r\nexport const width = 9;\r\nexport const height = 20;\r\n//画面上部に隠れる盤面の拡張サイズ heightとは別\r\nexport const hiddenHeight = 18;\r\n//monoiamondにおける座標のサイズ\r\nexport const playWidth = width * 2 - 1;\r\nexport const playHeight = height + hiddenHeight;\r\n//hiddenHeightをどれだけ表示するか\r\nexport const displayMargin = 0.5;\r\n//blockの大きさ\r\nexport const blockHeight = 100;\r\nexport const blockWidth = (blockHeight * 2) / Math.sqrt(3);\r\n//pentiamondの初期出現位置\r\nexport const initialX = 8;\r\nexport const initialY = 19;\r\n//盤面の背景色\r\nexport const backgroundColor = \"#222233\";\r\n//kindに応じたblockの色\r\nexport const blockColor = {\r\n    normal: {\r\n        L: \"#FF0000\",\r\n        J: \"#FA7800\",\r\n        p: \"#FFFF00\",\r\n        q: \"#00FF00\",\r\n        U: \"#0000FF\",\r\n        I: \"#990099\",\r\n        g: \"#AAAAAA\",\r\n    },\r\n    ghost: {\r\n        L: \"#55000099\",\r\n        J: \"#4D2D0099\",\r\n        p: \"#55550099\",\r\n        q: \"#00550099\",\r\n        U: \"#00005599\",\r\n        I: \"#44004499\",\r\n        g: \"#44444499\",\r\n    },\r\n};\r\n//盤面の補助グリッド\r\nexport const canvasGrid = {\r\n    width: 8,\r\n    color: \"#494960\",\r\n};\r\n//monoiamondの枠線\r\nexport const mondGrid = {\r\n    normal: {\r\n        width: 4,\r\n        color: \"#79798899\",\r\n    },\r\n    ghost: {\r\n        width: 4,\r\n        color: \"#45455099\",\r\n    },\r\n};\r\n//十五列揃え用のガイド線\r\nexport const guideBorderColor = \"#88ddee66\";\r\n//next表示関係\r\nexport const next = {\r\n    width: 3,\r\n    height: 3,\r\n    gap: 160,\r\n    scale: {\r\n        hold: 1.4,\r\n        normal: 1,\r\n    },\r\n    length: 4,\r\n    splitColor: \"#00008888\",\r\n};\r\n//一度のdamage処理にかかる時間の目安(ミリ秒)\r\nexport const damageTime = 2000;\r\nexport const damageWaitingTime = 4000;\r\n//nuisanceMondが生成される間隔\r\nexport const damageGrace = 3;\r\nexport const input = {\r\n    repeatTime: 35,\r\n    delayTime: 165,\r\n};\r\n//カウントが1減る時間(ms)\r\nexport const gameTimeRate = 500;\r\n//残り時間わずかの警告を出すgameTime\r\nexport const warningGameTime = 30;\r\n//ペナルティ\r\nexport const penalty = {\r\n    removeLine: 3,\r\n    unput: 3,\r\n};\r\n\r\nexport type GamepadConfig = {\r\n    moveLeft: string[];\r\n    moveRight: string[];\r\n    moveDown: string[];\r\n    put: string[];\r\n    spinLeft: string[];\r\n    spinRight: string[];\r\n    unput: string[];\r\n    hold: string[];\r\n    removeLine: string[];\r\n    pause: string[];\r\n};\r\n\r\nexport const gamepadConfigPresets: GamepadConfig[] = [\r\n    {\r\n        moveLeft: [\"button:14\", \"stick:-0\"],\r\n        moveRight: [\"button:15\", \"stick:+0\"],\r\n        moveDown: [\"button:13\", \"stick:+1\"],\r\n        put: [\"button:4\", \"button:6\"],\r\n        spinLeft: [\"button:0\"],\r\n        spinRight: [\"button:1\"],\r\n        unput: [\"button:2\"],\r\n        hold: [\"button:5\", \"button:7\"],\r\n        removeLine: [\"button:3\"],\r\n        pause: [\"button:8\", \"button:9\"],\r\n    },\r\n];\r\n\r\nexport const debounceOperateTime = 120;\r\nexport const maximumTemporaryReplaySavable = 10;\r\n","import { EventId, EventManager, MyEventListener } from \"../EventManager\";\r\nimport { GamePlayer } from \"./GamePlayer\";\r\n\r\nexport const gameEvents: EventId[] = [];\r\nexport type OperateName = \"put\" | \"move-left\" | \"move-right\" | \"move-down\" | \"spin-left\" | \"spin-right\" | \"unput\" | \"hold\" | \"removeLine\";\r\nexport type OperateData = {\r\n    time: number;\r\n    operateName: OperateName;\r\n};\r\n\r\nexport abstract class GameMode implements MyEventListener {\r\n    protected players: GamePlayer[] = [];\r\n    protected state = {\r\n        hasFinished: false,\r\n    };\r\n    protected winners: GamePlayer[] = [];\r\n    operateMemories: OperateData[][];\r\n    eventClassNames: string[] = [\"gameFinish\"];\r\n    eventIds: EventId[] = [];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        const eventId = EventManager.addEvent({ classNames: classNames.filter((className) => this.eventClassNames.includes(className)), handler });\r\n        this.eventIds.push(eventId);\r\n        gameEvents.push(eventId);\r\n        return eventId;\r\n    }\r\n    constructor(players: GamePlayer[]) {\r\n        this.players = players;\r\n        this.operateMemories = new Array(players.length).fill(undefined).map(() => []);\r\n        const operateNames = [\"put\", \"move-left\", \"move-right\", \"move-down\", \"spin-left\", \"spin-right\", \"unput\", \"hold\", \"removeLine\"];\r\n        players.forEach((p, i) => {\r\n            operateNames.forEach((operateName) => {\r\n                gameEvents.push(\r\n                    p.operator.addEvent([operateName], () => {\r\n                        this.operateMemories[i].push({\r\n                            time: p.loop.g$elapsedTime,\r\n                            operateName: operateName as OperateName,\r\n                        });\r\n                    })\r\n                );\r\n            });\r\n        });\r\n    }\r\n\r\n    abstract start(): void;\r\n    abstract stop(): void;\r\n    protected abstract proceedPlayerFinish(): void;\r\n    protected abstract addPlayerBehavior(index: number): void;\r\n\r\n    remove() {\r\n        EventManager.removeEvents(gameEvents);\r\n        this.players.forEach((player) => {\r\n            player.g$element.remove();\r\n        });\r\n    }\r\n}\r\n","export class Vector {\r\n    private values: number[];\r\n    constructor(...values: number[] | number[][]) {\r\n        if (values.length == 0) {\r\n            throw new Error(\"0次元のベクトルは扱えません\");\r\n        }\r\n        const validValues = Array.isArray(values[0]) ? values[0] : (values as number[]);\r\n        if (validValues.filter((x) => Number.isNaN(x)).length != 0) {\r\n            throw new Error(\"ベクトルにNaNが含まれています\");\r\n        }\r\n        this.values = validValues;\r\n    }\r\n\r\n    /**\r\n     * Vectorを表す配列\r\n     */\r\n    get array(): number[] {\r\n        return this.values;\r\n    }\r\n\r\n    /**\r\n     * ベクトルの次元\r\n     */\r\n    get length(): number {\r\n        return this.values.length;\r\n    }\r\n\r\n    /**\r\n     * ベクトルの大きさ\r\n     */\r\n    get size(): number {\r\n        return Math.hypot(...this.values);\r\n    }\r\n\r\n    /**\r\n     * 単位ベクトル\r\n     */\r\n    get unit(): Vector {\r\n        if (this.isZero) {\r\n            throw new Error(\"零ベクトルを単位ベクトルにすることはできません\");\r\n        }\r\n        return this.multiple(1 / this.size);\r\n    }\r\n\r\n    /**\r\n     * 零ベクトルか\r\n     */\r\n    get isZero(): boolean {\r\n        return this.values.filter((x) => x != 0).length == 0;\r\n    }\r\n\r\n    /**\r\n     * このベクトルのコピー\r\n     */\r\n    get copy(): Vector {\r\n        return new Vector(this.values);\r\n    }\r\n\r\n    /**\r\n     * 法線ベクトル(2次元の時のみ)\r\n     */\r\n    get normal(): Vector {\r\n        if (this.length != 2) {\r\n            throw new Error(\"2次元のときのみ法線ベクトルを取得できます\");\r\n        }\r\n        const values = [this.values[1], -this.values[0]];\r\n        return new Vector(values);\r\n    }\r\n\r\n    /**\r\n     * 偏角(2次元の時のみ)\r\n     */\r\n    get argument(): number {\r\n        if (this.length != 2) {\r\n            throw new Error(\"2次元のときのみ偏角を取得できます\");\r\n        }\r\n        return (Math.atan2(this.values[1], this.values[0]) + Math.PI * 2) % (Math.PI * 2);\r\n    }\r\n\r\n    /**\r\n     * @param index 取得したい成分のindex\r\n     * @returns index番目の成分\r\n     */\r\n    get(index: number): number {\r\n        return this.values[index];\r\n    }\r\n\r\n    /**\r\n     * 加法\r\n     * @param v 足すベクトル\r\n     * @returns 和\r\n     */\r\n    add(v: Vector): Vector {\r\n        if (this.length != v.length) {\r\n            throw new Error(\"次元が異なるベクトルです\");\r\n        }\r\n        const values = this.values.map((x, i) => x + v.array[i]);\r\n        return new Vector(values);\r\n    }\r\n\r\n    /**\r\n     * 減法\r\n     * @param v 引くベクトル\r\n     * @returns 差\r\n     */\r\n    sub(v: Vector): Vector {\r\n        if (this.length != v.length) {\r\n            throw new Error(\"次元が異なるベクトルです\");\r\n        }\r\n        const values = this.values.map((x, i) => x - v.array[i]);\r\n        return new Vector(values);\r\n    }\r\n\r\n    /**\r\n     * @param v 内積をとるベクトル\r\n     * @returns 内積\r\n     */\r\n    dot(v: Vector): Vector {\r\n        if (this.length != v.length) {\r\n            throw new Error(\"次元が異なるベクトルです\");\r\n        }\r\n        const values = this.values.map((x, i) => x * v.array[i]);\r\n        return new Vector(values);\r\n    }\r\n\r\n    /**\r\n     * @param c スカラー\r\n     * @returns スカラー倍\r\n     */\r\n    multiple(c: number): Vector {\r\n        if (Number.isNaN(c)) {\r\n            console.error(\"NaNによるスカラー倍が実行されています\");\r\n            c = 1;\r\n        }\r\n        const values = this.values.map((x) => x * c);\r\n        return new Vector(values);\r\n    }\r\n\r\n    /**\r\n     * このベクトルが零ベクトルなら失敗する\r\n     * @param size 変えたいサイズ\r\n     * @returns 同じ方向で指定したサイズのベクトル\r\n     */\r\n    setSize(size: number) {\r\n        return this.unit.multiple(size);\r\n    }\r\n\r\n    /**\r\n     * @param v 外積をとるベクトル\r\n     * @returns 外積\r\n     */\r\n    cross(v: Vector): Vector {\r\n        if (this.length != v.length) {\r\n            throw new Error(\"次元が異なるベクトルです\");\r\n        }\r\n        if (this.length != 3) {\r\n            throw new Error(\"外積は3次元のときのみ実装されています\");\r\n        }\r\n        const values = [\r\n            this.values[1] * v.array[2] - this.values[2] * v.array[1],\r\n            this.values[2] * v.array[0] - this.values[0] * v.array[2],\r\n            this.values[0] * v.array[1] - this.values[1] * v.array[0],\r\n        ];\r\n        return new Vector(values);\r\n    }\r\n\r\n    /**\r\n     * 原点を中心に回転させる\r\n     * @param radian 回転する角度(rad)\r\n     * @returns 回転後のベクトル\r\n     */\r\n    rot(radian: number): Vector {\r\n        if (this.length != 2) {\r\n            throw new Error(\"回転は2次元のときのみ実装されています\");\r\n        }\r\n        return new Vector(this.values[0] * Math.cos(radian) - this.values[1] * Math.sin(radian), this.values[0] * Math.sin(radian) + this.values[1] * Math.cos(radian));\r\n    }\r\n\r\n    /**\r\n     * @param v 比較したいベクトル\r\n     * @returns このベクトルと等しいか\r\n     */\r\n    equals(v: Vector): boolean {\r\n        if (this.length != v.length) {\r\n            return false;\r\n        }\r\n        let equal = true;\r\n        this.values.forEach((x, i) => {\r\n            if (x - v.get(i) != 0) {\r\n                equal = false;\r\n            }\r\n        });\r\n        return equal;\r\n    }\r\n\r\n    /**\r\n     * 距離関数\r\n     * @param v 比較したいベクトル\r\n     * @returns このベクトルとの距離\r\n     */\r\n    getDistanceFrom(v: Vector) {\r\n        if (this.length != v.length) {\r\n            throw new Error(\"次元が異なるベクトルです\");\r\n        }\r\n        return this.sub(v).size;\r\n    }\r\n\r\n    /**\r\n     * このベクトルと最も近いベクトルを返す　複数ある場合はindexが最も若いものを返す\r\n     * @param vectors 比較したいベクトルの配列\r\n     * @returns 最も近いベクトル\r\n     */\r\n    getNearestVector(...vectors: Vector[] | Vector[][]) {\r\n        if (vectors.length == 0) {\r\n            throw new Error(\"長さ0の配列を渡されました\");\r\n        }\r\n        const validVectors = Array.isArray(vectors[0]) ? vectors[0] : (vectors as Vector[]);\r\n        let minDistance = Infinity;\r\n        let index = 0;\r\n        validVectors.forEach((v, i) => {\r\n            const distance = v.getDistanceFrom(this);\r\n            if (distance < minDistance) {\r\n                minDistance = distance;\r\n                index = i;\r\n            }\r\n        });\r\n        return validVectors[index];\r\n    }\r\n\r\n    /**\r\n     * このベクトルと最も遠いベクトルを返す　複数ある場合はindexが最も若いものを返す\r\n     * @param vectors 比較したいベクトルの配列\r\n     * @returns 最も遠いベクトル\r\n     */\r\n    getFarthestVector(...vectors: Vector[] | Vector[][]) {\r\n        if (vectors.length == 0) {\r\n            throw new Error(\"長さ0の配列を渡されました\");\r\n        }\r\n        const validVectors = Array.isArray(vectors[0]) ? vectors[0] : (vectors as Vector[]);\r\n        let maxDistance = 0;\r\n        let index = 0;\r\n        validVectors.forEach((v, i) => {\r\n            const distance = v.getDistanceFrom(this);\r\n            if (maxDistance < distance) {\r\n                maxDistance = distance;\r\n                index = i;\r\n            }\r\n        });\r\n        return validVectors[index];\r\n    }\r\n}\r\n","import { LoopManager } from \"./LoopManager\";\r\nimport { qs } from \"./Utils\";\r\nimport { Vector } from \"./Vector\";\r\n\r\nconst element = qs(\"#playBackground\");\r\nconst canvas = document.createElement(\"canvas\");\r\nconst ctx = canvas.getContext(\"2d\")!;\r\n\r\nelement.appendChild(canvas);\r\ncanvas.width = 14 * 40;\r\ncanvas.height = 9 * 40;\r\n\r\nclass Triangle {\r\n    x: number = 0;\r\n    y: number = 0;\r\n    size: number = 0;\r\n    speed: number = 0;\r\n    opacity: number = 0;\r\n    angle: number = 0;\r\n    rotationSpeed: number = 0;\r\n    constructor() {\r\n        this.reset();\r\n    }\r\n\r\n    reset() {\r\n        this.x = Math.random() * canvas.width;\r\n        this.y = canvas.height + 20;\r\n        this.size = 20 + Math.random() ** 1.2 * 40;\r\n        this.speed = 0.6 + Math.random() * 1.5;\r\n        this.opacity = 0.2 + Math.random() * 0.5;\r\n        this.angle = Math.random() * Math.PI * 2;\r\n        this.rotationSpeed = (Math.random() - 0.5) * 0.04;\r\n    }\r\n\r\n    update() {\r\n        this.y -= this.speed;\r\n        this.angle += this.rotationSpeed;\r\n        if (this.y < -this.size) {\r\n            this.reset();\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D) {\r\n        const point = new Vector(this.x, this.y);\r\n        const vertex = new Vector(0, (-this.size / 2) * (Math.sqrt(3) / 2)).rot(this.angle);\r\n        ctx.beginPath();\r\n        ctx.moveTo(...(vertex.rot(0).add(point).array as [number, number]));\r\n        ctx.lineTo(...(vertex.rot((2 * Math.PI) / 3).add(point).array as [number, number]));\r\n        ctx.lineTo(...(vertex.rot((4 * Math.PI) / 3).add(point).array as [number, number]));\r\n        ctx.closePath();\r\n\r\n        ctx.fillStyle = `rgba(255,255,255,${this.opacity})`;\r\n        ctx.fill();\r\n    }\r\n}\r\n\r\nconst colorAnimation = element.animate(\r\n    [\r\n        {\r\n            backgroundColor: \"#88aaee\",\r\n        },\r\n        {\r\n            backgroundColor: \"#aa88ee\",\r\n        },\r\n        {\r\n            backgroundColor: \"#aaeeaa\",\r\n        },\r\n        {\r\n            backgroundColor: \"#eeeeaa\",\r\n        },\r\n        {\r\n            backgroundColor: \"#88aaee\",\r\n        },\r\n    ],\r\n    {\r\n        duration: 25000,\r\n        direction: \"normal\",\r\n        iterations: Infinity,\r\n    }\r\n);\r\n\r\nconst triangles = Array.from({ length: 40 }, () => new Triangle());\r\nconst playBackgroundLoop = new LoopManager();\r\nplayBackgroundLoop.addEvent([\"loop\"], () => {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    triangles.forEach((tri) => {\r\n        tri.update();\r\n        tri.draw(ctx);\r\n    });\r\n});\r\n\r\nexport const playBackground = {\r\n    reset: () => {\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        triangles.forEach((tri) => {\r\n            tri.reset();\r\n        });\r\n        playBackgroundLoop.reset();\r\n        colorAnimation.cancel();\r\n    },\r\n    start: () => {\r\n        playBackgroundLoop.start();\r\n        if (colorAnimation.playState != \"running\") {\r\n            colorAnimation.play();\r\n        }\r\n    },\r\n    stop: () => {\r\n        playBackgroundLoop.stop();\r\n        colorAnimation.pause();\r\n    },\r\n};\r\n","import { qs, qsAddEvent } from \"./Utils\";\r\n\r\nexport class GraphicSetting {\r\n    static putShake = true;\r\n    static removeShake = true;\r\n    static playBackground = true;\r\n\r\n    static init() {\r\n        this.loadData();\r\n        this.setupEvents();\r\n    }\r\n\r\n    static saveGraphicSetting() {\r\n        const data = this.getEncodedSetting();\r\n\r\n        try {\r\n            localStorage.setItem(\"Pentamond3-graphicSetting\", data);\r\n        } catch (error) {\r\n            console.error(\"何らかの理由により設定の保存に失敗しました\");\r\n        }\r\n\r\n        this.updateButtonStyle();\r\n    }\r\n\r\n    private static updateButtonStyle() {\r\n        qs(\"#putShakeOn\").style.color = this.putShake ? \"#ee8888\" : \"\";\r\n        qs(\"#putShakeOff\").style.color = this.putShake ? \"\" : \"#ee8888\";\r\n        qs(\"#removeShakeOn\").style.color = this.removeShake ? \"#ee8888\" : \"\";\r\n        qs(\"#removeShakeOff\").style.color = this.removeShake ? \"\" : \"#ee8888\";\r\n        qs(\"#playBackgroundOn\").style.color = this.playBackground ? \"#ee8888\" : \"\";\r\n        qs(\"#playBackgroundOff\").style.color = this.playBackground ? \"\" : \"#ee8888\";\r\n    }\r\n\r\n    private static loadData() {\r\n        const json = localStorage.getItem(\"Pentamond3-graphicSetting\");\r\n\r\n        if (!json) {\r\n            this.saveGraphicSetting();\r\n            return;\r\n        }\r\n\r\n        const data = this.decode(json);\r\n\r\n        this.putShake = data[0];\r\n        this.removeShake = data[1];\r\n        this.playBackground = data[2];\r\n\r\n        this.updateButtonStyle();\r\n    }\r\n\r\n    private static setupEvents() {\r\n        qsAddEvent(\"#putShakeOn\", \"click\", () => {\r\n            if (this.putShake) {\r\n                return;\r\n            }\r\n            this.putShake = true;\r\n        });\r\n        qsAddEvent(\"#putShakeOff\", \"click\", () => {\r\n            if (!this.putShake) {\r\n                return;\r\n            }\r\n            this.putShake = false;\r\n        });\r\n        qsAddEvent(\"#removeShakeOn\", \"click\", () => {\r\n            if (this.removeShake) {\r\n                return;\r\n            }\r\n            this.removeShake = true;\r\n        });\r\n        qsAddEvent(\"#removeShakeOff\", \"click\", () => {\r\n            if (!this.removeShake) {\r\n                return;\r\n            }\r\n            this.removeShake = false;\r\n        });\r\n        qsAddEvent(\"#playBackgroundOn\", \"click\", () => {\r\n            if (this.playBackground) {\r\n                return;\r\n            }\r\n            this.playBackground = true;\r\n        });\r\n        qsAddEvent(\"#playBackgroundOff\", \"click\", () => {\r\n            if (!this.playBackground) {\r\n                return;\r\n            }\r\n            this.playBackground = false;\r\n        });\r\n\r\n        qsAddEvent(\"#graphicSetting button\", \"click\", () => {\r\n            this.saveGraphicSetting();\r\n        });\r\n    }\r\n\r\n    private static getEncodedSetting() {\r\n        return Number.parseInt([this.putShake ? \"1\" : \"0\", this.removeShake ? \"1\" : \"0\", this.playBackground ? \"1\" : \"0\"].join(\"\"), 2) + \"\";\r\n    }\r\n\r\n    private static decode(json: string) {\r\n        const data = Number.parseInt(json, 10)\r\n            .toString(2)\r\n            .split(\"\")\r\n            .map((word) => (word == \"0\" ? false : true));\r\n\r\n        for (let i = 0; 3 - data.length; i++) {\r\n            data.unshift(false);\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n","export class BGM {\r\n    private static context: AudioContext;\r\n    private static gain: GainNode;\r\n    private static audio: AudioBufferSourceNode;\r\n    private static audioBuffer: AudioBuffer;\r\n    private static reversedBuffer: AudioBuffer;\r\n\r\n    /**\r\n     * BGM自体のボリューム\r\n     */\r\n    private static volume = 1;\r\n    /**\r\n     * 音声ファイルそれぞれのボリューム\r\n     */\r\n    private static sourceVolume = 1;\r\n\r\n    static onEnded = {\r\n        promise: Promise.resolve(),\r\n        cancel: () => {},\r\n    };\r\n\r\n    // 現在の論理的な再生位置を追跡\r\n    private static logicalTime: typeof BGM.Time;\r\n\r\n    private static initialized = false;\r\n    static init(): void {\r\n        if (this.initialized) throw new Error(\"BGM is already initialized! Ensure that you are not calling BGM.init() multiple times.\");\r\n        this.initialized = true;\r\n\r\n        this.context = new AudioContext();\r\n        this.context.suspend();\r\n        this.gain = this.context.createGain();\r\n        this.gain.connect(this.context.destination);\r\n\r\n        this.logicalTime = BGM.Time;\r\n    }\r\n\r\n    // 音源を読み込む\r\n    static async fetch({ src, loopStart, loopEnd, sourceVolume = 1 }: { src: string; loopStart?: number; loopEnd?: number; sourceVolume?: number }): Promise<void> {\r\n        this.checkInit();\r\n\r\n        this.context.suspend();\r\n\r\n        this.sourceVolume = sourceVolume;\r\n        this.setVolume(this.volume);\r\n\r\n        const audioData = await (await fetch(src)).arrayBuffer();\r\n        this.audioBuffer = await this.context.decodeAudioData(audioData);\r\n        this.reversedBuffer = this.reverseBuffer(this.audioBuffer);\r\n\r\n        // 時間管理をリセット\r\n        this.logicalTime.isReversed = false;\r\n\r\n        this.logicalTime.currentTime = 0;\r\n        this.logicalTime.lastUpdateTime = 0;\r\n        this.logicalTime.lastUpdateContextTime = this.context.currentTime;\r\n\r\n        this.logicalTime.loopStart = loopStart ?? 0;\r\n        this.logicalTime.loopEnd = loopEnd ?? this.audioBuffer.duration;\r\n        this.logicalTime.duration = this.audioBuffer.duration;\r\n\r\n        this.reconnect();\r\n    }\r\n\r\n    static play(): Promise<void> {\r\n        this.checkInit();\r\n\r\n        return this.context.resume();\r\n    }\r\n\r\n    static pause(): Promise<void> {\r\n        this.checkInit();\r\n        return this.context.suspend();\r\n    }\r\n\r\n    /**\r\n     * second秒かけてフェードアウトした後、止める\r\n     * @param second 秒\r\n     * @returns\r\n     */\r\n    static async fadeOut(second: number): Promise<void> {\r\n        this.checkInit();\r\n\r\n        await this.fade(0.001, second);\r\n        await this.pause();\r\n    }\r\n\r\n    /**\r\n     * play開始した後、second秒かけてフェードインする\r\n     * @param second 秒\r\n     * @returns\r\n     */\r\n    static async fadeIn(second: number): Promise<void> {\r\n        this.checkInit();\r\n\r\n        const volume = this.volume;\r\n        this.setVolume(0.001);\r\n        await this.play();\r\n        await this.fade(volume, second);\r\n    }\r\n\r\n    /**\r\n     * second秒かけてフェードする\r\n     * @param volume 目標ボリューム\r\n     * @param second 秒\r\n     * @returns\r\n     */\r\n    static fade(volume: number, second: number): Promise<void> {\r\n        this.checkInit();\r\n\r\n        this.gain.gain.cancelScheduledValues(0);\r\n        this.gain.gain.linearRampToValueAtTime(volume * this.sourceVolume, this.context.currentTime + second);\r\n\r\n        return new Promise<void>((resolve) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, second * 1000);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 再生方向を切り替える\r\n     */\r\n    static reverse(): void {\r\n        this.checkInit();\r\n\r\n        this.logicalTime.isReversed = !this.logicalTime.isReversed;\r\n        this.reconnect();\r\n    }\r\n\r\n    static setCurrentTime(second: number) {\r\n        this.checkInit();\r\n\r\n        this.logicalTime.setCurrentTime(this.context.currentTime, second);\r\n        this.reconnect();\r\n    }\r\n\r\n    static getCurrentTime(): number {\r\n        this.checkInit();\r\n\r\n        this.logicalTime.updateCurrentTime(this.context.currentTime);\r\n        return this.logicalTime.currentTime;\r\n    }\r\n\r\n    static isPlaying(): boolean {\r\n        this.checkInit();\r\n        return this.context.state === \"running\";\r\n    }\r\n\r\n    static setVolume(volume: number): void {\r\n        this.checkInit();\r\n\r\n        this.gain.gain.cancelScheduledValues(0);\r\n\r\n        this.volume = volume;\r\n        this.gain.gain.value = this.volume * this.sourceVolume;\r\n    }\r\n\r\n    // AudioBufferを反転させる（逆再生用）\r\n    private static reverseBuffer(buffer: AudioBuffer) {\r\n        const reversedBuffer = this.context.createBuffer(buffer.numberOfChannels, buffer.length, buffer.sampleRate);\r\n\r\n        for (let channel = 0; channel < buffer.numberOfChannels; channel++) {\r\n            const originalData = buffer.getChannelData(channel);\r\n            const reversedData = reversedBuffer.getChannelData(channel);\r\n            for (let i = 0; i < originalData.length; i++) {\r\n                reversedData[i] = originalData[originalData.length - i - 1];\r\n            }\r\n        }\r\n\r\n        return reversedBuffer;\r\n    }\r\n\r\n    private static reconnect() {\r\n        this.checkInit();\r\n\r\n        if (this.audio) {\r\n            this.audio.stop();\r\n            this.audio.disconnect();\r\n            this.onEnded.cancel();\r\n        }\r\n\r\n        this.audio = this.context.createBufferSource();\r\n        this.audio.loop = true;\r\n        this.audio.buffer = this.logicalTime.isReversed ? this.reversedBuffer : this.audioBuffer;\r\n        [this.audio.loopStart, this.audio.loopEnd] = this.logicalTime.getActualLoopTime();\r\n        this.audio.connect(this.gain);\r\n\r\n        this.onEnded.promise = new Promise((resolve) => {\r\n            this.onEnded.cancel = resolve;\r\n            this.audio.onended = () => {\r\n                resolve();\r\n            };\r\n        });\r\n\r\n        // 現在の論理時間を更新\r\n        this.logicalTime.updateCurrentTime(this.context.currentTime);\r\n        this.audio.start(0, this.logicalTime.getActualOffset());\r\n    }\r\n\r\n    private static checkInit() {\r\n        if (!this.context) {\r\n            throw new Error(\"BGM is not initialized. Call BGM.init() before using BGM.\");\r\n        }\r\n    }\r\n}\r\n\r\nexport namespace BGM {\r\n    export class Time {\r\n        static currentTime = 0;\r\n        static lastUpdateTime = 0;\r\n        static lastUpdateContextTime = 0;\r\n\r\n        static loopStart = 0;\r\n        static loopEnd = 0;\r\n        static duration = 0;\r\n\r\n        static isReversed = false;\r\n\r\n        static setCurrentTime(contextTime: number, currentTime: number) {\r\n            currentTime = this.bound(currentTime);\r\n\r\n            this.currentTime = currentTime;\r\n            this.lastUpdateTime = currentTime;\r\n            this.lastUpdateContextTime = contextTime;\r\n        }\r\n\r\n        static getActualOffset() {\r\n            if (this.isReversed) {\r\n                // 逆再生の場合、論理時間を反転させる\r\n                return this.duration - this.currentTime;\r\n            } else {\r\n                // 通常再生の場合\r\n                return this.currentTime;\r\n            }\r\n        }\r\n\r\n        static getActualLoopTime(): [number, number] {\r\n            if (this.isReversed) {\r\n                return [this.duration - this.loopEnd, this.duration - this.loopStart];\r\n            } else {\r\n                return [this.loopStart, this.loopEnd];\r\n            }\r\n        }\r\n\r\n        static updateCurrentTime(contextTime: number) {\r\n            // 必ず0以上\r\n            const elapsedContextTime = contextTime - this.lastUpdateContextTime;\r\n\r\n            if (this.isReversed) {\r\n                // 逆再生の場合、時間が逆向きに進む\r\n                this.currentTime = this.lastUpdateTime - elapsedContextTime;\r\n            } else {\r\n                // 通常再生の場合\r\n                this.currentTime = this.lastUpdateTime + elapsedContextTime;\r\n            }\r\n\r\n            this.currentTime = this.bound(this.currentTime);\r\n\r\n            this.lastUpdateTime = this.currentTime;\r\n            this.lastUpdateContextTime = contextTime;\r\n        }\r\n\r\n        // ループ範囲内に収める\r\n        private static bound(currentTime: number) {\r\n            const loopDuration = this.loopEnd - this.loopStart;\r\n\r\n            // ループ範囲外へ向かおうとするときだけ修正する\r\n            // ループ範囲外から範囲内へ向かっているときは修正しない\r\n            if (this.isReversed && currentTime < this.loopStart) {\r\n                return this.loopEnd - ((this.loopStart - currentTime) % loopDuration);\r\n            }\r\n\r\n            if (!this.isReversed && currentTime > this.loopEnd) {\r\n                return this.loopStart + ((currentTime - this.loopStart) % loopDuration);\r\n            }\r\n\r\n            return currentTime;\r\n        }\r\n    }\r\n}\r\n","import { EventId, EventManager, MyEventListener } from \"./EventManager\";\r\n\r\n/**\r\n * フラグを管理する\r\n * フラグの変更時にイベント検知できる\r\n */\r\nexport class FlagManager implements MyEventListener {\r\n    private static instance: FlagManager;\r\n    private flags: Set<string> = new Set<string>();\r\n\r\n    /**\r\n     * @param flagAdd -フラグ名　フラグが追加されたとき\r\n     * @param flagRemove -フラグ名　フラグが削除されたとき\r\n     * @param flagChanged フラグが変更されたとき\r\n     */\r\n    readonly eventClassNames: string[] = [\"flagAdd\", \"flagRemove\", \"flagChanged\"];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        return EventManager.addEvent({ classNames: classNames, handler });\r\n    }\r\n\r\n    constructor() {\r\n        if (FlagManager.instance) {\r\n            return FlagManager.instance;\r\n        }\r\n        FlagManager.instance = this;\r\n    }\r\n\r\n    get g$size(): number {\r\n        return this.flags.size;\r\n    }\r\n\r\n    get g$flagNames(): Set<string> {\r\n        return structuredClone(this.flags);\r\n    }\r\n\r\n    add(flag: string): boolean {\r\n        if (this.flags.has(flag)) {\r\n            return false;\r\n        }\r\n        this.flags.add(flag);\r\n        EventManager.executeEventsByClassName(\"flagAdd\");\r\n        EventManager.executeEventsByClassName(\"flagAdd-\" + flag);\r\n        EventManager.executeEventsByClassName(\"flagChanged\");\r\n        return true;\r\n    }\r\n\r\n    remove(flag: string): boolean {\r\n        if (this.flags.delete(flag)) {\r\n            EventManager.executeEventsByClassName(\"flagRemove\");\r\n            EventManager.executeEventsByClassName(\"flagRemove-\" + flag);\r\n            EventManager.executeEventsByClassName(\"flagChanged\");\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    has(flag: string): boolean {\r\n        return this.flags.has(flag);\r\n    }\r\n\r\n    hasAll(...flags: string[]): boolean {\r\n        return new Set(flags).isSubsetOf(this.flags);\r\n    }\r\n\r\n    hasAny(...flags: string[]): boolean {\r\n        let result = false;\r\n        flags.forEach((flag) => {\r\n            if (this.flags.has(flag)) {\r\n                result = true;\r\n                return;\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n}\r\n\r\nexport const flagManager = new FlagManager();\r\n","export class Sound {\r\n    private static context: AudioContext;\r\n    /**\r\n     * SE全体のボリューム\r\n     */\r\n    private static gain: GainNode;\r\n    /**\r\n     * それぞれのSEのボリューム\r\n     */\r\n    private gain: GainNode;\r\n\r\n    private audioBuffer!: AudioBuffer;\r\n    private reversedBuffer!: AudioBuffer;\r\n\r\n    private isReversed = false;\r\n\r\n    private lastPlayTime = Date.now();\r\n\r\n    readonly isReady;\r\n\r\n    private static initialized = false;\r\n    static init() {\r\n        if (this.initialized) {\r\n            throw new Error(\"Sound is already initialized! Ensure that you are not calling Sound.init() multiple times.\");\r\n        }\r\n        this.initialized = true;\r\n\r\n        this.context = new AudioContext();\r\n        this.gain = this.context.createGain();\r\n        this.gain.connect(this.context.destination);\r\n    }\r\n\r\n    /**\r\n     * SE全体のボリュームを設定\r\n     * @param volume\r\n     */\r\n    static setWholeVolume(volume: number) {\r\n        Sound.checkInit();\r\n        this.gain.gain.value = volume;\r\n    }\r\n\r\n    constructor({ src, volume = 0.4 }: { src: string; volume?: number }) {\r\n        Sound.checkInit();\r\n\r\n        this.gain = Sound.context.createGain();\r\n        this.gain.connect(Sound.gain);\r\n        this.gain.gain.value = volume;\r\n\r\n        this.isReady = this.fetch(src);\r\n    }\r\n\r\n    play() {\r\n        // 連打はNG\r\n        if (Date.now() - this.lastPlayTime < 32) {\r\n            return;\r\n        }\r\n        this.lastPlayTime = Date.now();\r\n\r\n        this.reconnect();\r\n    }\r\n\r\n    // 再生方向を切り替える\r\n    reverse() {\r\n        this.isReversed = !this.isReversed;\r\n    }\r\n\r\n    clearReversal() {\r\n        this.isReversed = false;\r\n    }\r\n\r\n    // 音源を読み込む\r\n    private async fetch(src: string) {\r\n        Sound.checkInit();\r\n\r\n        const arrayBuffer = await (await fetch(src)).arrayBuffer();\r\n        const audioBuffer = await Sound.context.decodeAudioData(arrayBuffer);\r\n\r\n        this.audioBuffer = audioBuffer;\r\n        const reversedBuffer = this.reverseBuffer(this.audioBuffer);\r\n        this.reversedBuffer = reversedBuffer;\r\n    }\r\n\r\n    // AudioBufferを反転させる（逆再生用）\r\n    private reverseBuffer(buffer: AudioBuffer) {\r\n        Sound.checkInit();\r\n\r\n        const reversedBuffer = Sound.context.createBuffer(buffer.numberOfChannels, buffer.length, buffer.sampleRate);\r\n\r\n        for (let channel = 0; channel < buffer.numberOfChannels; channel++) {\r\n            const originalData = buffer.getChannelData(channel);\r\n            const reversedData = reversedBuffer.getChannelData(channel);\r\n            for (let i = 0; i < originalData.length; i++) {\r\n                reversedData[i] = originalData[originalData.length - i - 1];\r\n            }\r\n        }\r\n\r\n        return reversedBuffer;\r\n    }\r\n\r\n    // play前の処理\r\n    private reconnect() {\r\n        Sound.checkInit();\r\n\r\n        const audio = Sound.context.createBufferSource();\r\n        audio.buffer = this.isReversed ? this.reversedBuffer : this.audioBuffer;\r\n        audio.connect(this.gain);\r\n        audio.start();\r\n    }\r\n\r\n    private static checkInit() {\r\n        if (!this.context) {\r\n            throw new Error(\"Sound is not initialized. Call Sound.init() before using Sound.\");\r\n        }\r\n    }\r\n}\r\n","import { BGM } from \"./BGM\";\r\nimport { flagManager } from \"./FlagManager\";\r\nimport { pageManager } from \"./PageManager\";\r\nimport { ScreenInteractionSetting } from \"./ScreenInteraction\";\r\nimport { Sound } from \"./Sound\";\r\nimport { qsAddEvent } from \"./Utils\";\r\n\r\nexport let se: Sound[];\r\nlet bgm = -1;\r\n\r\nexport function soundsInit() {\r\n    BGM.init();\r\n    Sound.init();\r\n    se = [\r\n        new Sound({ src: \"assets/sounds/Pentamond3-ボタン.mp3\" }),\r\n        new Sound({ src: \"assets/sounds/Pentamond3-フォーカス.mp3\", volume: 0.15 }),\r\n        new Sound({ src: \"assets/sounds/モンド設置音.m4a\" }),\r\n    ];\r\n}\r\n\r\nqsAddEvent(\"button\", \"click\", () => {\r\n    se[0].play();\r\n});\r\n\r\nqsAddEvent(\"button\", \"focus\", () => {\r\n    se[1].play();\r\n});\r\n\r\npageManager.addEvent([\"pageChanged-pageStart\"], async () => {\r\n    if (bgm != -1) {\r\n        pageManager.s$valid = false;\r\n        ScreenInteractionSetting.operable = false;\r\n        if (BGM.isPlaying()) {\r\n            await BGM.pause();\r\n        }\r\n        bgm = -1;\r\n        pageManager.s$valid = true;\r\n        ScreenInteractionSetting.operable = true;\r\n    }\r\n});\r\n\r\npageManager.addEvent([\"pageChanged-title\"], async () => {\r\n    if (bgm != 0) {\r\n        pageManager.s$valid = false;\r\n        ScreenInteractionSetting.operable = false;\r\n        await BGM.pause();\r\n        await BGM.fetch({ src: \"assets/musics/つみきのおしろ.m4a\" });\r\n        await BGM.play();\r\n        bgm = 0;\r\n        pageManager.s$valid = true;\r\n        ScreenInteractionSetting.operable = true;\r\n    }\r\n});\r\n\r\npageManager.addEvent([\"pageChanged-startEffect\"], async () => {\r\n    if (bgm != 1) {\r\n        pageManager.s$valid = false;\r\n        ScreenInteractionSetting.operable = false;\r\n        await BGM.pause();\r\n        await BGM.fetch({ src: \"assets/musics/ならべてトライアングル.m4a\" });\r\n        await BGM.play();\r\n        bgm = 1;\r\n        pageManager.s$valid = true;\r\n        ScreenInteractionSetting.operable = true;\r\n    }\r\n});\r\n\r\n//ローディング画面\r\npageManager.addEvent([\"pageBecomeValid\"], () => {\r\n    flagManager.remove(\"invalid\");\r\n    // if (pageManager.g$currentPageId == \"talk\") {\r\n    //     talkPanel.start();\r\n    // }\r\n});\r\n\r\npageManager.addEvent([\"pageBecomeInvalid\"], () => {\r\n    flagManager.add(\"invalid\");\r\n});\r\n\r\n//設定関連\r\nqsAddEvent(\"#bgmVolume\", \"input\", (element) => {\r\n    const value: number = parseInt((element as HTMLInputElement).value);\r\n    BGM.setVolume(value / 10);\r\n});\r\n\r\nqsAddEvent(\"#seVolume\", \"input\", (element) => {\r\n    console.log(\"se\");\r\n    const value: number = parseInt((element as HTMLInputElement).value);\r\n    Sound.setWholeVolume(value / 10);\r\n});\r\n\r\nqsAddEvent('input[type=\"range\"]', \"input\", () => {\r\n    se[0].play();\r\n});\r\n","import { inputManager } from \"./Interaction/InputManager\";\r\nimport { pageManager } from \"./PageManager\";\r\nimport { qs, qsAddEvent, qsAll, sleep } from \"./Utils\";\r\n\r\nimport * as Setting from \"./Settings\";\r\nimport { debug } from \"./Run\";\r\n\r\nexport type PlaySetting = {\r\n    playerNumber: number;\r\n    mode: number;\r\n    maxGameTime: number;\r\n    handy: number[];\r\n};\r\n\r\n/**\r\n * ゲームが始まる直前の人数とかルールとか決めたり、コントローラーの登録をしたりする\r\n *  */\r\nexport class BeforePlay {\r\n    static gamepadConfigs: Setting.GamepadConfig[] = [];\r\n\r\n    static playSetting: PlaySetting = {\r\n        playerNumber: 1,\r\n        mode: 1,\r\n        maxGameTime: 150,\r\n        handy: [1],\r\n    };\r\n\r\n    static setEvents() {\r\n        // モードを決める\r\n        qsAddEvent(\"button[data-mode]\", \"click\", (element) => {\r\n            // 一人プレイの時は聞かれないので1にしておく\r\n            this.playSetting.playerNumber = 1;\r\n            this.playSetting.mode = Number(element.dataset.mode);\r\n        });\r\n\r\n        // 人数を決める\r\n        qsAddEvent(\"button[data-player]\", \"click\", (element) => {\r\n            this.playSetting.playerNumber = Number(element.dataset.player);\r\n        });\r\n\r\n        // コントローラーの登録の準備\r\n        pageManager.addEvent([\"setPage-playerRegister\"], () => {\r\n            this.startControllerRegistration();\r\n        });\r\n\r\n        // キャンセル時\r\n        qsAddEvent(\"#playerRegister .back\", \"click\", () => {\r\n            inputManager.resetRegister();\r\n        });\r\n\r\n        // キャンセル時\r\n        qsAddEvent(\"#playPrepare .back\", \"click\", () => {\r\n            inputManager.resetRegister();\r\n        });\r\n\r\n        // 登録されたとき\r\n        inputManager.addEvent([\"inputRegistered\"], () => {\r\n            // アイコンをだす\r\n            this.onInputRegistered();\r\n        });\r\n\r\n        inputManager.addEvent([\"finishRegister\"], () => {\r\n            qs(\"#registerText\").innerHTML = '<div style=\"color:#d66\">完了！</div>';\r\n        });\r\n\r\n        qsAddEvent(\"#registerButton\", \"click\", () => {\r\n            this.onClickOk();\r\n        });\r\n    }\r\n\r\n    private static async onClickOk() {\r\n        // まだ全員登録し終わっていないならリターン\r\n        if (inputManager.g$registering) {\r\n            if (debug) {\r\n                inputManager.finishRegister();\r\n            } else {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // ここまで来たらタイトルには戻れない\r\n\r\n        inputManager.stop();\r\n\r\n        this.enablePlayerRegisterButtons(false);\r\n\r\n        // 何のため?\r\n        await sleep(500);\r\n\r\n        const backDepth = this.playSetting.playerNumber == 1 ? 1 : 2;\r\n        pageManager.backPages(backDepth, { eventIgnore: true });\r\n        pageManager.setPage(\"playPrepare\");\r\n\r\n        this.enablePlayerRegisterButtons(true);\r\n\r\n        inputManager.start();\r\n    }\r\n\r\n    private static enablePlayerRegisterButtons(available: boolean) {\r\n        qsAll(\"#playerRegister button\").forEach((element) => {\r\n            (element as HTMLButtonElement).disabled = !available;\r\n        });\r\n    }\r\n\r\n    // normalを準備\r\n    private static startControllerRegistration() {\r\n        // 既に登録されているものを外す\r\n        if (inputManager.g$registeredInputNumber > 0) {\r\n            inputManager.removeVirtualInputs();\r\n            inputManager.resetRegister();\r\n        }\r\n\r\n        // 前の表示を消す\r\n        Array.from(qs(\"#connectionLabel\").children).forEach((element) => {\r\n            element.remove();\r\n        });\r\n\r\n        qs(\"#registerText\").innerText = `\r\n            登録したい入力機器のボタンを押してください：\r\n            あと${this.playSetting.playerNumber - inputManager.g$registeredInputNumber}人\r\n        `;\r\n\r\n        this.gamepadConfigs = [];\r\n\r\n        inputManager.s$maxInputNumber = this.playSetting.playerNumber;\r\n        inputManager.startRegister();\r\n    }\r\n\r\n    // コントローラーが登録されたときアイコンを出す\r\n    private static onInputRegistered() {\r\n        const registerInputs = inputManager.g$registeredInputs;\r\n\r\n        const typeIcon = document.createElement(\"div\");\r\n        typeIcon.dataset.inputType = registerInputs[registerInputs.length - 1].g$type;\r\n        typeIcon.classList.add(\"inputTypeIcon\");\r\n        // typeIcon.innerHTML = registerInputs[registerInputs.length - 1].g$type;\r\n        qs(\"#connectionLabel\").appendChild(typeIcon);\r\n\r\n        qs(\"#registerText\").innerText = `\r\n            登録したい入力機器のボタンを押してください：\r\n            あと${this.playSetting.playerNumber - inputManager.g$registeredInputNumber}人\r\n        `;\r\n\r\n        this.gamepadConfigs.push(Setting.gamepadConfigPresets[0]);\r\n    }\r\n}\r\n","import { EventManager } from \"../../EventManager\";\r\nimport { gameEvents, GameMode } from \"../GameMode\";\r\nimport { GamePlayer } from \"../GamePlayer\";\r\nimport { pageManager } from \"../../PageManager\";\r\nimport * as Setting from \"../../Settings\";\r\nimport { qsAll, removeMousePointerTemporary } from \"../../Utils\";\r\nimport { playBackground } from \"../../PlayBackground\";\r\nimport { GraphicSetting } from \"../../GraphicSetting\";\r\nimport { se } from \"../../SoundProcessing\";\r\nimport { BeforePlay } from \"../../BeforePlay\";\r\n\r\nexport class Mode1 extends GameMode {\r\n    constructor(players: GamePlayer[]) {\r\n        super(players);\r\n        players.forEach((_, i) => {\r\n            this.addPlayerBehavior(i);\r\n        });\r\n    }\r\n\r\n    start(): void {\r\n        this.players.forEach((player) => {\r\n            player.start();\r\n        });\r\n        if (GraphicSetting.playBackground) {\r\n            playBackground.start();\r\n        }\r\n    }\r\n    stop(): void {\r\n        this.players.forEach((player) => {\r\n            player.stop();\r\n        });\r\n        if (GraphicSetting.playBackground) {\r\n            playBackground.stop();\r\n        }\r\n    }\r\n    proceedPlayerFinish(): void {\r\n        if (this.state.hasFinished) {\r\n            return;\r\n        }\r\n\r\n        //プレイヤーの生死状態を更新する\r\n        this.players.forEach((p) => {\r\n            p.updateGameTime();\r\n            if (p.playInfo.gameTime == 0) {\r\n                if (p.state.hasFinished) {\r\n                    return;\r\n                }\r\n                p.finish();\r\n                p.label.updateContents({\r\n                    gameTime: p.playInfo.gameTime + \"\",\r\n                    playTime: \"\",\r\n                    line: \"\",\r\n                    lastTrick: p.playInfo.lastTrick ? p.playInfo.lastTrick.name : \"　\",\r\n                    chain: p.playInfo.chain + \"\",\r\n                    score: p.playInfo.score + \"\",\r\n                });\r\n                if (this.players.length != 1) {\r\n                    p.animations.finish.play();\r\n                }\r\n            }\r\n        });\r\n\r\n        const playingPlayers = this.players.filter((player) => !player.state.hasFinished);\r\n        //一人プレイでなく、プレイしている人が一人なら勝利\r\n        if (playingPlayers.length == 1 && this.players.length >= 1) {\r\n            this.winners = [playingPlayers[0]];\r\n            playingPlayers[0].updateGameTime();\r\n            //プレイしている人がいない場合、最も時間を残している人が全員勝利\r\n        } else if (playingPlayers.length == 0) {\r\n            const max = Math.max(\r\n                ...this.players.map((player) => {\r\n                    player.updateGameTime();\r\n                    return player.playInfo.gameTime;\r\n                })\r\n            );\r\n            this.winners = this.players.filter((player) => player.playInfo.gameTime == max);\r\n        }\r\n        //勝敗が決しているなら終了\r\n        if (this.winners.length > 0) {\r\n            this.state.hasFinished = true;\r\n            this.stop();\r\n            this.players.forEach((p) => {\r\n                p.label.updateContents({\r\n                    gameTime: p.playInfo.gameTime + \"\",\r\n                    playTime: \"\",\r\n                    line: \"\",\r\n                    lastTrick: p.playInfo.lastTrick ? p.playInfo.lastTrick.name : \"　\",\r\n                    chain: p.playInfo.chain + \"\",\r\n                    score: p.playInfo.score + \"\",\r\n                });\r\n                p.playInfo.playTime = p.loop.g$elapsedTime;\r\n            });\r\n            qsAll(\".resultLabel\").forEach((resultLabel) => {\r\n                if (this.winners.length < this.players.length) {\r\n                    resultLabel.innerHTML = `Player ${this.winners.map((player) => this.players.indexOf(player) + 1).toString()} won!`;\r\n                } else if (1 < this.players.length) {\r\n                    resultLabel.innerHTML = `Draw`;\r\n                } else {\r\n                    resultLabel.innerHTML = `Score : ${this.winners[0].playInfo.score}`;\r\n                }\r\n            });\r\n\r\n            EventManager.executeListeningEvents(\"gameFinish\", this.eventIds);\r\n        }\r\n    }\r\n\r\n    addPlayerBehavior(index: number): void {\r\n        const p = this.players[index];\r\n        const input = p.input.g$manager;\r\n        const operate = (keyCode: string) => {\r\n            if ([\"ArrowLeft\", ...BeforePlay.gamepadConfigs[index].moveLeft].includes(keyCode)) {\r\n                p.operator.move(\"left\");\r\n            } else if ([\"ArrowRight\", ...BeforePlay.gamepadConfigs[index].moveRight].includes(keyCode)) {\r\n                p.operator.move(\"right\");\r\n            } else if ([\"ArrowDown\", ...BeforePlay.gamepadConfigs[index].moveDown].includes(keyCode)) {\r\n                p.operator.move(\"down\");\r\n            } else if ([\"ArrowUp\", ...BeforePlay.gamepadConfigs[index].put].includes(keyCode)) {\r\n                p.operator.put();\r\n            } else if ([\"KeyC\", ...BeforePlay.gamepadConfigs[index].spinLeft].includes(keyCode)) {\r\n                p.operator.spin(\"left\");\r\n            } else if ([\"KeyV\", ...BeforePlay.gamepadConfigs[index].spinRight].includes(keyCode)) {\r\n                p.operator.spin(\"right\");\r\n            } else if ([\"KeyB\", ...BeforePlay.gamepadConfigs[index].unput].includes(keyCode)) {\r\n                p.operator.unput();\r\n            } else if ([\"Space\", ...BeforePlay.gamepadConfigs[index].hold].includes(keyCode)) {\r\n                p.operator.hold();\r\n            } else if ([\"Enter\", ...BeforePlay.gamepadConfigs[index].removeLine].includes(keyCode)) {\r\n                p.operator.removeLine();\r\n            } else if ([\"KeyP\", ...BeforePlay.gamepadConfigs[index].pause].includes(keyCode)) {\r\n                if (!p.loop.g$isLooping || this.state.hasFinished) {\r\n                    return;\r\n                }\r\n                this.stop();\r\n                pageManager.setPage(\"pause\");\r\n            } else {\r\n                return;\r\n            }\r\n            removeMousePointerTemporary();\r\n            p.updateCanvas();\r\n        };\r\n\r\n        p.label.s$visible = { gameTime: true, playTime: false, line: false, lastTrick: true, chain: true, score: true };\r\n        const updateLabel = () => {\r\n            p.label.updateContents({\r\n                gameTime: p.playInfo.gameTime + \"\",\r\n                playTime: \"\",\r\n                line: \"\",\r\n                lastTrick: p.playInfo.lastTrick ? p.playInfo.lastTrick.name : \"　\",\r\n                chain: p.playInfo.chain + \"\",\r\n                score: p.playInfo.score + \"\",\r\n            });\r\n        };\r\n\r\n        let lastOperateTime = 0;\r\n\r\n        gameEvents.push(\r\n            input.addEvent([\"onKeydown\", \"onButtondown\", \"onStickActive\"], () => {\r\n                if (!p.loop.g$isLooping) {\r\n                    return;\r\n                }\r\n                operate(input.g$latestPressingKey);\r\n            }),\r\n\r\n            p.loop.addEvent([\"loop\"], () => {\r\n                const moveKeys = [\r\n                    \"ArrowLeft\",\r\n                    \"ArrowRight\",\r\n                    \"ArrowDown\",\r\n                    ...BeforePlay.gamepadConfigs[index].moveLeft,\r\n                    ...BeforePlay.gamepadConfigs[index].moveRight,\r\n                    ...BeforePlay.gamepadConfigs[index].moveDown,\r\n                ];\r\n                const latestKey = input.getLatestPressingKey(moveKeys);\r\n                const pressTime = Date.now() - input.getPressTime(latestKey);\r\n                if (pressTime >= Setting.input.delayTime && latestKey != \"\") {\r\n                    if (pressTime - lastOperateTime >= Setting.input.repeatTime) {\r\n                        operate(latestKey);\r\n                        lastOperateTime = pressTime;\r\n                    }\r\n                } else {\r\n                    lastOperateTime = 0;\r\n                }\r\n\r\n                p.playInfo.playTime = p.loop.g$elapsedTime;\r\n                updateLabel();\r\n                p.updateGameTime();\r\n\r\n                if (p.playInfo.gameTime <= Setting.warningGameTime) {\r\n                    if (p.animations.timeWarning.playState != \"running\") {\r\n                        p.animations.timeWarning.play();\r\n                    }\r\n                } else if (p.animations.timeWarning.playState == \"running\") {\r\n                    p.animations.timeWarning.cancel();\r\n                }\r\n                if (p.playInfo.gameTime == 0) {\r\n                    this.proceedPlayerFinish();\r\n                }\r\n\r\n                if (p.damageInfo.damageTask && p.loop.g$elapsedTime - p.damageInfo.lastDamageTime >= Setting.damageWaitingTime) {\r\n                    if (p.animations.warning.playState != \"running\") {\r\n                        p.animations.caution.cancel();\r\n                        p.animations.warning.play();\r\n                    }\r\n                }\r\n            }),\r\n\r\n            p.operator.addEvent([\"put\"], () => {\r\n                p.playInfo.put += 1;\r\n                p.playInfo.lastTrick = null;\r\n                p.playInfo.chain = 0;\r\n                p.playInfo.score += 10;\r\n\r\n                p.playInfo.penaltyTask = Math.max(p.playInfo.penaltyTask - 1, 0);\r\n                if (p.damageInfo.damageTask) {\r\n                    if (p.damageInfo.damageTask > p.damageInfo.attackTask) {\r\n                        console.log(`Player ${index + 1} damage has offset : ${p.damageInfo.attackTask}`);\r\n                        p.damageInfo.damageTask -= p.damageInfo.attackTask;\r\n                        console.log(`Rest damage is ${p.damageInfo.damageTask}`);\r\n                        p.damageInfo.attackTask = 0;\r\n                    } else {\r\n                        console.log(`Player ${index + 1} attack has offset : ${p.damageInfo.damageTask}`);\r\n                        p.damageInfo.attackTask -= p.damageInfo.damageTask;\r\n                        if (p.damageInfo.damageTask) {\r\n                            console.log(`Rest attack is ${p.damageInfo.attackTask}`);\r\n                        } else {\r\n                            console.log(`Damage and attack have just offset`);\r\n                        }\r\n                        p.damageInfo.damageTask = 0;\r\n                        p.animations.caution.cancel();\r\n                        p.animations.warning.cancel();\r\n                    }\r\n                }\r\n                if (p.damageInfo.damageTask && p.loop.g$elapsedTime - p.damageInfo.lastDamageTime >= Setting.damageWaitingTime) {\r\n                    console.log(`Player ${index + 1} has damaged: ${p.damageInfo.damageTask}`);\r\n                    p.damage();\r\n                    p.damageInfo.totalDamage += p.damageInfo.damageTask;\r\n                }\r\n                if (p.damageInfo.attackTask) {\r\n                    console.log(`Player ${index + 1} has attacked: ${p.damageInfo.attackTask}`);\r\n                    this.players.forEach((player, i) => {\r\n                        if (i != index) {\r\n                            player.addDamageTask(p.damageInfo.attackTask);\r\n                        }\r\n                    });\r\n                    p.damageInfo.totalAttack += p.damageInfo.attackTask;\r\n                    p.damageInfo.attackTask = 0;\r\n                }\r\n                se[2].play();\r\n            }),\r\n\r\n            p.operator.addEvent([\"unput\"], () => {\r\n                p.playInfo.put -= 1;\r\n                p.playInfo.score -= 10;\r\n                p.playInfo.penalty += Setting.penalty.unput;\r\n                p.playInfo.unput += 1;\r\n            }),\r\n\r\n            p.operator.addEvent([\"hold\"], () => {\r\n                p.playInfo.hold += 1;\r\n            }),\r\n\r\n            p.operator.addEvent([\"removeLine\"], () => {\r\n                const lastTrick = p.operator.g$lastTrick;\r\n                if (lastTrick) {\r\n                    p.playInfo.penaltyTask = 0;\r\n                    if ([\"一列揃え(上)\", \"一列揃え(下)\"].includes(lastTrick.name)) {\r\n                        p.playInfo.line += 1;\r\n                    }\r\n                    p.playInfo.score += p.playInfo.chain * 100;\r\n                    p.playInfo.score += (lastTrick.time + lastTrick.attack) * 50;\r\n                    p.damageInfo.attackTask += lastTrick.attack + Math.ceil(p.playInfo.chain / 5);\r\n                    p.playInfo.maxChain = Math.max(p.playInfo.maxChain, p.playInfo.chain);\r\n                    p.playInfo.recovery += lastTrick.time;\r\n                    p.playInfo.chain += 1;\r\n                    p.playInfo.trickCount += 1;\r\n                    if (GraphicSetting.removeShake) {\r\n                        p.animations.removeLineWithTrick.play();\r\n                    }\r\n                } else {\r\n                    p.playInfo.penalty += p.playInfo.penaltyTask;\r\n                    p.playInfo.penaltyTask = Setting.penalty.removeLine;\r\n                    p.playInfo.chain = 0;\r\n                    if (GraphicSetting.removeShake) {\r\n                        p.animations.removeLineWithoutTrick.play();\r\n                    }\r\n                }\r\n                p.playInfo.lastTrick = p.operator.g$lastTrick;\r\n                p.playInfo.remove += 1;\r\n            })\r\n        );\r\n    }\r\n}\r\n","import { EventManager } from \"../../EventManager\";\r\nimport { gameEvents, GameMode } from \"../GameMode\";\r\nimport { GamePlayer } from \"../GamePlayer\";\r\nimport { pageManager } from \"../../PageManager\";\r\nimport * as Setting from \"../../Settings\";\r\nimport { qsAll, removeMousePointerTemporary } from \"../../Utils\";\r\nimport { playBackground } from \"../../PlayBackground\";\r\nimport { GraphicSetting } from \"../../GraphicSetting\";\r\nimport { BeforePlay } from \"../../BeforePlay\";\r\n\r\nexport class Mode2 extends GameMode {\r\n    constructor(players: GamePlayer[]) {\r\n        super(players);\r\n        players.forEach((_, i) => {\r\n            this.addPlayerBehavior(i);\r\n        });\r\n    }\r\n\r\n    start(): void {\r\n        this.players.forEach((player) => {\r\n            player.start();\r\n        });\r\n        if (GraphicSetting.playBackground) {\r\n            playBackground.start();\r\n        }\r\n    }\r\n    stop(): void {\r\n        this.players.forEach((player) => {\r\n            player.stop();\r\n        });\r\n        if (GraphicSetting.playBackground) {\r\n            playBackground.stop();\r\n        }\r\n    }\r\n    proceedPlayerFinish(): void {\r\n        if (this.state.hasFinished) {\r\n            return;\r\n        }\r\n        this.winners = this.players.filter((player) => player.state.hasFinished);\r\n        this.state.hasFinished = true;\r\n        this.stop();\r\n        if (this.players.length != 1) {\r\n            this.players\r\n                .filter((p) => !p.state.hasFinished)\r\n                .forEach((p) => {\r\n                    p.animations.finish.play();\r\n                });\r\n        }\r\n\r\n        this.players.forEach((p) => {\r\n            p.label.updateContents({\r\n                gameTime: \"\",\r\n                playTime: p.g$playTimeString,\r\n                line: p.playInfo.line + \"\",\r\n                lastTrick: \"\",\r\n                chain: p.playInfo.chain + \"\",\r\n                score: p.playInfo.score + \"\",\r\n            });\r\n            p.playInfo.playTime = p.loop.g$elapsedTime;\r\n        });\r\n        qsAll(\".resultLabel\").forEach((resultLabel) => {\r\n            if (this.winners.length < this.players.length) {\r\n                resultLabel.innerHTML = `Player ${this.winners.map((player) => this.players.indexOf(player) + 1).toString()} won! : ${this.winners[0].g$playTimeString}`;\r\n            } else if (1 < this.players.length) {\r\n                resultLabel.innerHTML = `Draw : ${this.winners[0].g$playTimeString}`;\r\n            } else {\r\n                resultLabel.innerHTML = `Time : ${this.winners[0].g$playTimeString}`;\r\n            }\r\n        });\r\n        EventManager.executeListeningEvents(\"gameFinish\", this.eventIds);\r\n    }\r\n\r\n    addPlayerBehavior(index: number): void {\r\n        const p = this.players[index];\r\n        const input = p.input.g$manager;\r\n        const operate = (keyCode: string) => {\r\n            if ([\"ArrowLeft\", ...BeforePlay.gamepadConfigs[index].moveLeft].includes(keyCode)) {\r\n                p.operator.move(\"left\");\r\n            } else if ([\"ArrowRight\", ...BeforePlay.gamepadConfigs[index].moveRight].includes(keyCode)) {\r\n                p.operator.move(\"right\");\r\n            } else if ([\"ArrowDown\", ...BeforePlay.gamepadConfigs[index].moveDown].includes(keyCode)) {\r\n                p.operator.move(\"down\");\r\n            } else if ([\"ArrowUp\", ...BeforePlay.gamepadConfigs[index].put].includes(keyCode)) {\r\n                p.operator.put();\r\n            } else if ([\"KeyC\", ...BeforePlay.gamepadConfigs[index].spinLeft].includes(keyCode)) {\r\n                p.operator.spin(\"left\");\r\n            } else if ([\"KeyV\", ...BeforePlay.gamepadConfigs[index].spinRight].includes(keyCode)) {\r\n                p.operator.spin(\"right\");\r\n            } else if ([\"KeyB\", ...BeforePlay.gamepadConfigs[index].unput].includes(keyCode)) {\r\n                p.operator.unput();\r\n            } else if ([\"Space\", ...BeforePlay.gamepadConfigs[index].hold].includes(keyCode)) {\r\n                p.operator.hold();\r\n            } else if ([\"Enter\", ...BeforePlay.gamepadConfigs[index].removeLine].includes(keyCode)) {\r\n                p.operator.removeLine();\r\n            } else if ([\"KeyP\", ...BeforePlay.gamepadConfigs[index].pause].includes(keyCode)) {\r\n                if (!p.loop.g$isLooping || this.state.hasFinished) {\r\n                    return;\r\n                }\r\n                this.stop();\r\n                pageManager.setPage(\"pause\");\r\n            } else {\r\n                return;\r\n            }\r\n            removeMousePointerTemporary();\r\n            p.updateCanvas();\r\n        };\r\n\r\n        p.label.s$visible = { gameTime: false, playTime: true, line: true, lastTrick: false, chain: true, score: true };\r\n        const updateLabel = () => {\r\n            p.label.updateContents({\r\n                gameTime: \"\",\r\n                playTime: p.g$playTimeString,\r\n                line: p.playInfo.line + \"\",\r\n                lastTrick: \"\",\r\n                chain: p.playInfo.chain + \"\",\r\n                score: p.playInfo.score + \"\",\r\n            });\r\n        };\r\n        let lastOperateTime = 0;\r\n        p.canvas.guideBorder = true;\r\n        gameEvents.push(\r\n            input.addEvent([\"onKeydown\", \"onButtondown\", \"onStickActive\"], () => {\r\n                if (!p.loop.g$isLooping) {\r\n                    return;\r\n                }\r\n                operate(input.g$latestPressingKey);\r\n            }),\r\n\r\n            p.loop.addEvent([\"loop\"], () => {\r\n                const moveKeys = [\r\n                    \"ArrowLeft\",\r\n                    \"ArrowRight\",\r\n                    \"ArrowDown\",\r\n                    ...BeforePlay.gamepadConfigs[index].moveLeft,\r\n                    ...BeforePlay.gamepadConfigs[index].moveRight,\r\n                    ...BeforePlay.gamepadConfigs[index].moveDown,\r\n                ];\r\n                const latestKey = input.getLatestPressingKey(moveKeys);\r\n                const pressTime = Date.now() - input.getPressTime(latestKey);\r\n                if (pressTime >= Setting.input.delayTime && latestKey != \"\") {\r\n                    if (pressTime - lastOperateTime >= Setting.input.repeatTime) {\r\n                        operate(latestKey);\r\n                        lastOperateTime = pressTime;\r\n                    }\r\n                } else {\r\n                    lastOperateTime = 0;\r\n                }\r\n                p.playInfo.playTime = p.loop.g$elapsedTime;\r\n                updateLabel();\r\n            }),\r\n\r\n            p.operator.addEvent([\"put\"], () => {\r\n                p.playInfo.put += 1;\r\n                p.playInfo.lastTrick = null;\r\n                p.playInfo.chain = 0;\r\n                p.playInfo.score += 10;\r\n            }),\r\n\r\n            p.operator.addEvent([\"unput\"], () => {\r\n                p.playInfo.put -= 1;\r\n                p.playInfo.score -= 10;\r\n                p.playInfo.unput += 1;\r\n            }),\r\n\r\n            p.operator.addEvent([\"hold\"], () => {\r\n                p.playInfo.hold += 1;\r\n            }),\r\n\r\n            p.operator.addEvent([\"removeLine\"], () => {\r\n                const lastTrick = p.operator.g$lastTrick;\r\n                if (lastTrick) {\r\n                    if ([\"一列揃え(上)\", \"一列揃え(下)\"].includes(lastTrick.name)) {\r\n                        p.playInfo.line += 1;\r\n                        p.playInfo.score += p.playInfo.chain * 100;\r\n                        p.playInfo.score += (lastTrick.time + lastTrick.attack) * 50;\r\n                        p.playInfo.chain += 1;\r\n                        p.playInfo.maxChain = Math.max(p.playInfo.maxChain, p.playInfo.chain);\r\n                        p.canvas.guideBorderHeight = 15 - p.playInfo.line;\r\n                        p.canvas.paintPlayCanvas();\r\n                        if (GraphicSetting.removeShake) {\r\n                            p.animations.removeLineWithTrick.play();\r\n                        }\r\n                    } else {\r\n                        p.playInfo.chain = 0;\r\n                        if (GraphicSetting.removeShake) {\r\n                            p.animations.removeLineWithoutTrick.play();\r\n                        }\r\n                    }\r\n                } else {\r\n                    p.playInfo.chain = 0;\r\n                    if (GraphicSetting.removeShake) {\r\n                        p.animations.removeLineWithoutTrick.play();\r\n                    }\r\n                }\r\n                p.playInfo.lastTrick = p.operator.g$lastTrick;\r\n                p.playInfo.remove += 1;\r\n\r\n                if (p.playInfo.line >= 15) {\r\n                    p.finish();\r\n                    this.proceedPlayerFinish();\r\n                }\r\n            })\r\n        );\r\n    }\r\n}\r\n","import { setHoverHighlight } from \"../ScreenInteraction\";\r\nimport { qs, qsAll } from \"../Utils\";\r\nimport { ReplayData } from \"./Replay\";\r\n\r\nexport class ReplayDom {\r\n    static setupSavedReplayPage(replayDataList: ReplayData[]) {\r\n        const container = qs(\"#savedReplay .options\");\r\n        container.querySelectorAll(\".replayButtonContainer\").forEach((element) => {\r\n            element.remove();\r\n        });\r\n\r\n        const replayButtons: HTMLButtonElement[] = [];\r\n        const deleteButtons: HTMLButtonElement[] = [];\r\n\r\n        for (const replayData of replayDataList) {\r\n            const { replayDataContainer, replayButton, deleteButton } = this.createReplayDataContainer(replayData);\r\n\r\n            container.prepend(replayDataContainer);\r\n\r\n            replayButtons.push(replayButton);\r\n            deleteButtons.push(deleteButton);\r\n        }\r\n\r\n        container.querySelectorAll(\"button\").forEach((button) => {\r\n            setHoverHighlight(button);\r\n        });\r\n\r\n        //座標の割り振り\r\n        qsAll(\"#savedReplay .replayButton\").forEach((button, i) => {\r\n            button.dataset.mapping = `[0,${i}]`;\r\n        });\r\n\r\n        qsAll(\"#savedReplay .replayDeleteButton\").forEach((button, i) => {\r\n            button.dataset.mapping = `[1,${i}]`;\r\n        });\r\n\r\n        qs(\"#savedReplay .back\").dataset.mapping = `[0,${replayDataList.length}]`;\r\n\r\n        return { deleteButtons, replayButtons };\r\n    }\r\n\r\n    private static createReplayDataContainer(replayData: ReplayData) {\r\n        const replayDataContainer = document.createElement(\"div\");\r\n\r\n        const now = new Date(replayData.date);\r\n        const replayButton = document.createElement(\"button\");\r\n        replayButton.classList.add(\"replayButton\");\r\n        replayButton.innerHTML = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()} ${now.getHours()}:${now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes()}:${\r\n            now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds()\r\n        }`;\r\n\r\n        const replayDataDescription = document.createElement(\"div\");\r\n        replayDataDescription.classList.add(\"replayDataDescription\");\r\n        replayDataDescription.innerHTML = this.createReplayDataDescription(replayData);\r\n\r\n        const deleteButton = document.createElement(\"button\");\r\n        deleteButton.classList.add(\"replayDeleteButton\");\r\n\r\n        replayDataContainer.appendChild(replayButton);\r\n        replayDataContainer.appendChild(replayDataDescription);\r\n        replayDataContainer.appendChild(deleteButton);\r\n\r\n        return { replayButton, deleteButton, replayDataContainer };\r\n    }\r\n\r\n    private static createReplayDataDescription(replayData: ReplayData) {\r\n        const solo = replayData.nextData.length == 1 ? \"ソロ\" : \"マルチ\";\r\n        const mode = this.stringifyMode(replayData.playSetting.mode);\r\n        const time = (replayData.finishTime / 1000).toFixed(2);\r\n\r\n        return `${solo} : ${mode}<br>時間: ${time}`;\r\n    }\r\n\r\n    private static stringifyMode(mode: number) {\r\n        switch (mode) {\r\n            case 1:\r\n                return \"サバイバル\";\r\n            case 2:\r\n                return \"十五列揃え\";\r\n            default:\r\n                return \"不明なモード\";\r\n        }\r\n    }\r\n\r\n    static createTempReplayButton(date: number) {\r\n        const now = new Date(date);\r\n\r\n        const replayButton = document.createElement(\"button\");\r\n        replayButton.classList.add(\"replayButton\");\r\n        replayButton.innerHTML = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()} ${now.getHours()}:${now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes()}:${\r\n            now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds()\r\n        }`;\r\n\r\n        const saveButton = document.createElement(\"button\");\r\n        saveButton.classList.add(\"replaySaveButton\");\r\n\r\n        //リプレイボタンの追加\r\n        const replayContainer = document.createElement(\"div\");\r\n        replayContainer.classList = \"replayButtonContainer\";\r\n        replayContainer.appendChild(replayButton);\r\n        replayContainer.appendChild(saveButton);\r\n        replayContainer.querySelectorAll(\"button\").forEach((button) => {\r\n            button.addEventListener(\"mouseover\", () => {\r\n                button.focus();\r\n            });\r\n            button.addEventListener(\"mouseleave\", () => {\r\n                if (document.activeElement == button) {\r\n                    (button as HTMLButtonElement).blur();\r\n                }\r\n            });\r\n        });\r\n\r\n        qs(\"#replay .options\").prepend(replayContainer);\r\n\r\n        let tempDataListLength = 0;\r\n\r\n        //座標の割り振り直し\r\n        qsAll(\"#replay .replayButton\").forEach((button, i) => {\r\n            button.dataset.mapping = `[0,${i}]`;\r\n            tempDataListLength++;\r\n        });\r\n\r\n        qsAll(\"#replay .replaySaveButton\").forEach((button, i) => {\r\n            button.dataset.mapping = `[1,${i}]`;\r\n        });\r\n\r\n        qs(\"#replay .back\").dataset.mapping = `[0,${tempDataListLength}]`;\r\n\r\n        return { replayButton, saveButton };\r\n    }\r\n}\r\n","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.5\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n} else if( typeof angular !== 'undefined' && angular != null ) {\n  angular.module('LZString', [])\n  .factory('LZString', function () {\n    return LZString;\n  });\n}\n","import { ReplayData } from \"./Replay\";\r\nimport LZString from \"lz-string\";\r\n\r\n// export type ReplayData = {\r\n//     inputData: AutoKeyboardInputData[][];\r\n//     nextData: BlockKind[][];\r\n//     playSetting: PlaySetting;\r\n//     finishTime: number;\r\n//     finishPlayers: number[];\r\n//     nuisanceBlockData: number[][];\r\n//     date: string;\r\n// };\r\n\r\nconst keyCodes = [\"ArrowLeft\", \"ArrowRight\", \"ArrowUp\", \"ArrowDown\", \"KeyC\", \"KeyV\", \"KeyB\", \"Space\", \"Enter\"];\r\nconst blockKinds = [\"L\", \"J\", \"p\", \"q\", \"U\", \"I\"];\r\nconst numbers = [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\"];\r\n\r\nexport function replayDataEncryption(data: ReplayData): string {\r\n    const inputData = data.inputData.map((playerInputData) =>\r\n        playerInputData\r\n            .map((input, i) => {\r\n                return (playerInputData[i].time - (i == 0 ? 0 : playerInputData[i - 1].time)).toString(5) + (keyCodes.indexOf(input.keyCode) + 5).toString(36);\r\n            })\r\n            .join(\"\")\r\n    );\r\n    const nextData = data.nextData.map((playerNextData) => playerNextData.map((kind) => blockKinds.indexOf(kind) + \"\").join(\"\"));\r\n    const nuisanceBlockData = data.nuisanceBlockData.map((playerNuisanceData) => playerNuisanceData.map((x) => numbers[x]).join(\"\"));\r\n    const data1 = [\r\n        inputData,\r\n        nextData,\r\n        [data.playSetting.playerNumber, data.playSetting.mode, data.playSetting.maxGameTime, data.playSetting.handy],\r\n        data.finishTime,\r\n        data.finishPlayers,\r\n        nuisanceBlockData,\r\n        data.date,\r\n    ];\r\n    const data2 = LZString.compressToUTF16(JSON.stringify(data1));\r\n    return data2;\r\n}\r\n\r\nexport function replayDataDecryption(encryptedData: string): ReplayData {\r\n    const objectData = JSON.parse(LZString.decompressFromUTF16(encryptedData));\r\n    const inputData = objectData[0]\r\n        .map((playerInputData: string) => {\r\n            return playerInputData.match(/[0-4]+[^0-4]*|[^0-4]+/g);\r\n        })\r\n        .map((playerInputData: string[]) => {\r\n            return playerInputData.map((_, i) => ({\r\n                time: sum(playerInputData.filter((_, j) => j <= i).map((filteredInputNumber) => Number.parseInt(filteredInputNumber.slice(0, -1), 5))),\r\n                keyCode: keyCodes[Number.parseInt(playerInputData[i].slice(-1), 36) - 5],\r\n                type: \"downup\",\r\n            }));\r\n        });\r\n    const nextData = objectData[1].map((playerNextData: string) => playerNextData.split(\"\").map((word) => blockKinds[parseInt(word)]));\r\n    const nuisanceBlockData = objectData[5].map((playerNuisanceData: string) => playerNuisanceData.split(\"\").map((word) => numbers.indexOf(word)));\r\n\r\n    return {\r\n        inputData: inputData,\r\n        nextData: nextData,\r\n        playSetting: {\r\n            playerNumber: objectData[2][0],\r\n            mode: objectData[2][1],\r\n            maxGameTime: objectData[2][2],\r\n            handy: objectData[2][3],\r\n        },\r\n        finishTime: objectData[3],\r\n        finishPlayers: objectData[4],\r\n        nuisanceBlockData: nuisanceBlockData,\r\n        date: objectData[6],\r\n    } as ReplayData;\r\n}\r\n\r\n// console.log(btoa(String.fromCharCode(...new Uint8Array(new Uint16Array([3333333, 3333344]).buffer))));\r\n// console.log(Array.from(new Uint16Array(Uint8Array.from(atob(btoa(String.fromCharCode(...new Uint8Array(new Uint16Array([66333, 33334]).buffer)))), (c) => c.charCodeAt(0)).buffer)));\r\n\r\nfunction numberEncryption(max: number, data: number[]): number {\r\n    let encryptedData = 0;\r\n    for (let i = data.length - 1; i >= 0; i--) {\r\n        encryptedData = encryptedData * max + data[i];\r\n    }\r\n    return encryptedData;\r\n}\r\n\r\nfunction numberDecryption(max: number, encryptedData: number, length: number): number[] {\r\n    let decryptedData = [];\r\n    for (let i = 0; i < length; i++) {\r\n        decryptedData.push(encryptedData % max);\r\n        encryptedData = Math.floor(encryptedData / max);\r\n    }\r\n    return decryptedData;\r\n}\r\n\r\nexport function sum(numbers: number[]) {\r\n    let result = 0;\r\n    numbers.forEach((number) => {\r\n        result += number;\r\n    });\r\n    return result;\r\n}\r\n","import { GameMode, OperateName } from \"../Game/GameMode\";\r\nimport { GamePlayer } from \"../Game/GamePlayer\";\r\nimport { ReplayData } from \"./Replay\";\r\n\r\nimport { qs } from \"../Utils\";\r\nimport { replayDataDecryption, replayDataEncryption } from \"./DataCompression\";\r\nimport { PlaySetting } from \"../BeforePlay\";\r\n\r\nexport class ReplayDataHandler {\r\n    static tempDataList: ReplayData[] = [];\r\n\r\n    static addTempData(data: ReplayData, max: number) {\r\n        this.tempDataList.push(data);\r\n\r\n        while (this.tempDataList.length > max) {\r\n            this.tempDataList.shift();\r\n            qs(\"#replay .replayButtonContainer:first-child\").remove();\r\n        }\r\n    }\r\n\r\n    static getDataSize() {\r\n        return new Blob([localStorage.getItem(\"Pentamond3-replayData\") ?? \"[]\"]).size;\r\n    }\r\n\r\n    static createReplayData(players: GamePlayer[], game: GameMode, playSetting: PlaySetting) {\r\n        const inputData = game.operateMemories.map((operateMemory) => operateMemory.map(({ time, operateName }) => ({ time: time, keyCode: this.convertOperateName(operateName), type: \"downup\" })));\r\n        const nextData = players.map((p) => p.operator.g$nextMemory);\r\n        const finishTime = Math.max(...players.map((player) => player.playInfo.playTime));\r\n        const finishPlayers = players.map((player, i) => (player.playInfo.playTime == finishTime ? i + 1 : -1)).filter((value) => value != -1);\r\n        const nuisanceBlockData = players.map((player) => player.nuisanceMondManager.g$spawnCoordinateMemory);\r\n\r\n        const replayData = structuredClone({\r\n            inputData,\r\n            nextData,\r\n            playSetting,\r\n            finishTime,\r\n            finishPlayers,\r\n            nuisanceBlockData,\r\n            date: Date.now(),\r\n        }) as ReplayData;\r\n\r\n        return replayData;\r\n    }\r\n\r\n    private static convertOperateName(operateName: OperateName) {\r\n        return operateName == \"put\"\r\n            ? \"ArrowUp\"\r\n            : operateName == \"move-left\"\r\n              ? \"ArrowLeft\"\r\n              : operateName == \"move-right\"\r\n                ? \"ArrowRight\"\r\n                : operateName == \"move-down\"\r\n                  ? \"ArrowDown\"\r\n                  : operateName == \"spin-left\"\r\n                    ? \"KeyC\"\r\n                    : operateName == \"spin-right\"\r\n                      ? \"KeyV\"\r\n                      : operateName == \"unput\"\r\n                        ? \"KeyB\"\r\n                        : operateName == \"hold\"\r\n                          ? \"Space\"\r\n                          : operateName == \"removeLine\"\r\n                            ? \"Enter\"\r\n                            : \"\";\r\n    }\r\n\r\n    static removeSavedReplayData(data: ReplayData) {\r\n        const replayDataList = this.getReplayDataList();\r\n        const removedList = replayDataList.filter((value) => value.date != data.date);\r\n        const encodedList = removedList.map((d) => replayDataEncryption(d));\r\n        const json = JSON.stringify(encodedList);\r\n\r\n        localStorage.setItem(\"Pentamond3-replayData\", json);\r\n    }\r\n\r\n    static getReplayDataList(): ReplayData[] {\r\n        const json = localStorage.getItem(\"Pentamond3-replayData\");\r\n        const encodedList: string[] = json ? JSON.parse(json) : [];\r\n        const replayData = encodedList.map((encodedData) => replayDataDecryption(encodedData));\r\n\r\n        return replayData;\r\n    }\r\n\r\n    static saveReplayData(data: ReplayData, { onOverMax, onError }: { onOverMax: () => void; onError: () => void }): boolean {\r\n        const replayDataList = ReplayDataHandler.getReplayDataList();\r\n\r\n        // 同じデータを保存しない\r\n        if (replayDataList.map((data) => data.date).includes(data.date)) {\r\n            return false;\r\n        }\r\n\r\n        // 11件以上保存しない\r\n        if (replayDataList.length >= 10) {\r\n            onOverMax();\r\n            return false;\r\n        }\r\n\r\n        // 降順に並べる\r\n        replayDataList.push(data);\r\n        replayDataList.sort((a, b) => a.date - b.date);\r\n\r\n        // 11件以上になったら古いものから消していく\r\n        while (replayDataList.length >= 11) {\r\n            replayDataList.shift();\r\n        }\r\n\r\n        const encodedList = replayDataList.map((data) => replayDataEncryption(data));\r\n        // dataArray.forEach((dataString) => {\r\n        //     const data = replayDataDecryption(dataString);\r\n        //     const now = new Date(data.date);\r\n        //     const date = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()} ${now.getHours()}:${now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes()}:${\r\n        //         now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds()\r\n        //     }`;\r\n        //     const size = new Blob([dataString]).size;\r\n        //     console.log(`The size of ${date} is ${size}`);\r\n        // });\r\n\r\n        try {\r\n            localStorage.setItem(\"Pentamond3-replayData\", JSON.stringify(encodedList));\r\n        } catch (error) {\r\n            onError();\r\n            return false;\r\n        }\r\n\r\n        const dataSize = this.getDataSize();\r\n        console.log(`The sum of size of replayData is ${dataSize}byte`);\r\n        return true;\r\n    }\r\n}\r\n","import { GameProcessing } from \"../GameProcessing/GameProcessing\";\r\nimport { pageManager } from \"../PageManager\";\r\nimport { qsAll, qs, sleep } from \"../Utils\";\r\nimport { ReplayData, Replay } from \"./Replay\";\r\nimport { ReplayDataHandler } from \"./ReplayDataHandler\";\r\n\r\nexport class ReplayEventSetter {\r\n    static setTempReplayPageEvent(tempDataList: ReplayData[], { replayButton, saveButton }: { replayButton: HTMLButtonElement; saveButton: HTMLButtonElement }) {\r\n        replayButton.addEventListener(\"click\", () => {\r\n            const replayButtons = qsAll(\"#replay .replayButton\");\r\n            const index = replayButtons.findIndex((button) => button == replayButton);\r\n            // lastOperateTime = Date.now();\r\n            GameProcessing.startReplay(tempDataList.at(-index - 1)!);\r\n        });\r\n\r\n        saveButton.addEventListener(\"click\", () => {\r\n            const saveButtons = qsAll(\"#replay .replaySaveButton\");\r\n            const index = saveButtons.findIndex((button) => button == saveButton);\r\n\r\n            // lastOperateTime = Date.now();\r\n            if (Replay.save(tempDataList.at(-index - 1)!)) {\r\n                Replay.setupSavedReplayPage();\r\n                saveButton.classList.add(\"replaySavedButton\");\r\n            }\r\n        });\r\n    }\r\n\r\n    static setSavedReplayPageEvent(replayDataList: ReplayData[], { replayButtons, deleteButtons }: { replayButtons: HTMLButtonElement[]; deleteButtons: HTMLButtonElement[] }) {\r\n        replayButtons.forEach((replayButton, i) => {\r\n            replayButton.addEventListener(\"click\", () => {\r\n                // lastOperateTime = Date.now();\r\n                GameProcessing.startReplay(replayDataList[i]);\r\n            });\r\n        });\r\n\r\n        deleteButtons.forEach((deleteButton, i) => {\r\n            deleteButton.addEventListener(\"click\", () => {\r\n                this.onClickDeleteButton(replayDataList[i]);\r\n            });\r\n        });\r\n    }\r\n\r\n    private static async onClickDeleteButton(replayData: ReplayData) {\r\n        const approved = await this.checkApprove();\r\n        if (!approved) return;\r\n\r\n        // lastOperateTime = Date.now();\r\n        ReplayDataHandler.removeSavedReplayData(replayData);\r\n\r\n        pageManager.backPages(2, { eventIgnore: true });\r\n\r\n        Replay.setupSavedReplayPage();\r\n\r\n        const index = ReplayDataHandler.tempDataList.findIndex((data) => data.date == replayData.date);\r\n        qsAll(\".replaySaveButton\")[ReplayDataHandler.tempDataList.length - index - 1]?.classList.remove(\"replaySavedButton\");\r\n\r\n        pageManager.setPage(\"savedReplay\");\r\n    }\r\n\r\n    private static checkApprove() {\r\n        pageManager.setPage(\"replayDeleteAlert\");\r\n\r\n        const confirmButton = qs(\"#replayDeleteConfirmButton\") as HTMLButtonElement;\r\n        confirmButton.disabled = true;\r\n        confirmButton.style.opacity = \"0\";\r\n\r\n        const back = qs(\"#replayDeleteAlert .back\") as HTMLButtonElement;\r\n\r\n        // 承認は1.5秒経たないとできない\r\n        sleep(1500).then(() => {\r\n            confirmButton.disabled = false;\r\n            confirmButton.style.opacity = \"1\";\r\n        });\r\n\r\n        return new Promise<boolean>((resolve) => {\r\n            const ac = new AbortController();\r\n\r\n            confirmButton.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    resolve(true);\r\n                    ac.abort();\r\n                },\r\n                { signal: ac.signal }\r\n            );\r\n\r\n            back.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    resolve(false);\r\n                    ac.abort();\r\n                },\r\n                { signal: ac.signal }\r\n            );\r\n        });\r\n    }\r\n}\r\n","import { BlockKind } from \"../BlockOperate/Block\";\r\nimport { AutoKeyboardInputData } from \"../Interaction/AutoKeyboardManager\";\r\nimport * as Setting from \"../Settings\";\r\nimport { GamePlayer } from \"../Game/GamePlayer\";\r\nimport { GameMode } from \"../Game/GameMode\";\r\n\r\nimport { ReplayDom } from \"./ReplayDom\";\r\nimport { ReplayDataHandler } from \"./ReplayDataHandler\";\r\nimport { pageManager } from \"../PageManager\";\r\nimport { ReplayEventSetter } from \"./ReplayEventSetter\";\r\nimport { PlaySetting } from \"../BeforePlay\";\r\n\r\n//リプレイ\r\nexport type ReplayData = {\r\n    inputData: AutoKeyboardInputData[][];\r\n    nextData: BlockKind[][];\r\n    playSetting: PlaySetting;\r\n    finishTime: number;\r\n    finishPlayers: number[];\r\n    nuisanceBlockData: number[][];\r\n    date: number;\r\n};\r\n\r\n/**\r\n * replay関係のインターフェース\r\n * これ以外は触ってはいけない\r\n * 親から子へ命令を送る\r\n * 子が親または兄弟の情報を使うべきではない\r\n *\r\n * まだそれは為されていない\r\n *\r\n * model: DataHandler\r\n * view: Dom\r\n * controller: Replay, EventSetter\r\n */\r\nexport class Replay {\r\n    static getDataSize() {\r\n        return ReplayDataHandler.getDataSize();\r\n    }\r\n\r\n    static setupSavedReplayPage() {\r\n        const replayDataList = ReplayDataHandler.getReplayDataList();\r\n\r\n        // Dom\r\n        const buttons = ReplayDom.setupSavedReplayPage(replayDataList);\r\n\r\n        // Event\r\n        ReplayEventSetter.setSavedReplayPageEvent(replayDataList, buttons);\r\n    }\r\n\r\n    static addTempData({ players, game, playSetting }: { players: GamePlayer[]; game: GameMode; playSetting: PlaySetting }) {\r\n        const replayData = ReplayDataHandler.createReplayData(players, game, playSetting);\r\n\r\n        ReplayDataHandler.addTempData(replayData, Setting.maximumTemporaryReplaySavable);\r\n\r\n        const buttons = ReplayDom.createTempReplayButton(replayData.date);\r\n        ReplayEventSetter.setTempReplayPageEvent(ReplayDataHandler.tempDataList, buttons);\r\n    }\r\n\r\n    static save(replayData: ReplayData) {\r\n        return ReplayDataHandler.saveReplayData(replayData, {\r\n            onOverMax: () => {\r\n                pageManager.setPage(\"replaySaveAlert\");\r\n            },\r\n            onError: () => {\r\n                pageManager.setPage(\"replaySaveAlert2\");\r\n            },\r\n        });\r\n    }\r\n\r\n    static saveLastOne() {\r\n        return this.save(ReplayDataHandler.tempDataList.at(-1)!);\r\n    }\r\n}\r\n","/**\r\n * ブロックの種類\r\n */\r\nexport type BlockKind = \"L\" | \"J\" | \"p\" | \"q\" | \"U\" | \"I\" | \"g\";\r\n\r\nexport type BlockProperty = [BlockKind, boolean, boolean];\r\n\r\n/**\r\n * ブロックの表示している形の状態\r\n */\r\nexport type ShapeInfo = [boolean, boolean];\r\n\r\n/**\r\n * 仮想的な表示単位\r\n * 実際の描画処理はここではない\r\n */\r\nexport class Block {\r\n    /**\r\n     * この表示単位の表す色の種類\r\n     */\r\n    private kind: BlockKind = \"g\";\r\n    /**\r\n     * 上向き(上がとがっている、true)か下向きか\r\n     */\r\n    private direction: boolean = true;\r\n    /**\r\n     * 表示状態\r\n     */\r\n    private visible: boolean = false;\r\n\r\n    constructor() {}\r\n\r\n    /**\r\n     * 種類\r\n     */\r\n    get g$kind(): BlockKind {\r\n        return this.kind;\r\n    }\r\n\r\n    /**\r\n     * 上向き(true)か下向き(false)か\r\n     */\r\n    get g$direction(): boolean {\r\n        return this.direction;\r\n    }\r\n\r\n    /**\r\n     * 表示しているか\r\n     */\r\n    get g$visible(): boolean {\r\n        return this.visible;\r\n    }\r\n\r\n    /**\r\n     * 形の情報\r\n     */\r\n    get g$shapeInfo(): ShapeInfo {\r\n        return [this.direction || !this.visible, this.visible];\r\n    }\r\n\r\n    /**\r\n     * プロパティ\r\n     */\r\n    get g$property(): BlockProperty {\r\n        return [this.kind, this.direction, this.visible];\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param kind 種類\r\n     */\r\n    set s$kind(kind: BlockKind) {\r\n        console.assert(!this.visible, \"表示中に種類を変更しないでください\");\r\n        this.kind = kind;\r\n    }\r\n\r\n    /**\r\n     * 上向き(true)か下向き(false)かを設定する　表示中は変更できない\r\n     * @param direction 向き\r\n     */\r\n    set s$direction(direction: boolean) {\r\n        console.assert(!this.visible, \"表示中に方向を変更しないでください\");\r\n        this.direction = direction;\r\n    }\r\n\r\n    /**\r\n     *@param visible 表示状態\r\n     */\r\n    set s$visible(visible: boolean) {\r\n        this.visible = visible;\r\n    }\r\n\r\n    /**\r\n     * プロパティの一括設定\r\n     * @param kind 種類\r\n     * @param direction 上向き(true)か下向きか(false)\r\n     * @param visible 表示状態\r\n     */\r\n    set s$property([kind, direction, visible]: BlockProperty) {\r\n        this.kind = kind;\r\n        this.direction = direction;\r\n        this.visible = visible;\r\n    }\r\n}\r\n","// prettier-ignore\r\n//モンドの形を指定\r\nexport const placement =\r\n        \r\n        {\r\n            L : [\r\n                [[0, 0], [-1, 0], [-2, 0], [1, 0], [1, -1]],\r\n                [[0, 0], [1, 0], [2, 0], [0, -1], [-1, -1]],\r\n                [[0, 0], [1, 0], [1, -1], [0, 1], [1, 1]],\r\n                [[0, 0], [-1, 0], [-1, 1], [1, 0], [2, 0]],\r\n                [[0, 0], [-1, 0], [-2, 0], [0, 1], [1, 1]],\r\n                [[0, 0], [0, -1], [-1, -1], [-1, 0], [-1, 1]],\r\n            ],\r\n            J : [\r\n                [[0, 0], [-1, 0], [-1, -1], [1, 0], [2, 0]],\r\n                [[0, 0], [0, -1], [1, -1], [1, 0], [1, 1]],\r\n                [[0, 0], [0, 1], [-1, 1], [1, 0], [2, 0]],\r\n                [[0, 0], [-1, 0], [-2, 0], [1, 0], [1, 1]],\r\n                [[0, 0], [-1, 0], [-1, -1], [0, 1], [-1, 1]],\r\n                [[0, 0], [-1, -0], [-2, -0], [0, -1], [1, -1]],\r\n            ],\r\n            p : [\r\n                [[0, -1], [0, 0], [1, 0], [2, 0], [-1, 0]],\r\n                [[-1, 0], [0, 0], [0, 1], [1, 1], [1, 0]],\r\n                [[0, -1], [0, 0], [1, 0], [-1, 1], [-1, 0]],\r\n                [[1, 0], [0, 0], [-1, 0], [-2, 0], [0, 1]],\r\n                [[-1, 0], [0, 0], [1, 0], [-1, -1], [0, -1]],\r\n                [[0, 1], [0, 0], [-1, 0], [1, -1], [1, 0]],\r\n            ],\r\n            q : [ //q\r\n                [[0, -1], [0, 0], [1, 0], [-2, 0], [-1, 0]],\r\n                [[0, 1], [0, 0], [1, 0], [-1, -1], [-1, 0]],\r\n                [[-1, 0], [0, 0], [1, 0], [1, -1], [0, -1]],\r\n                [[-1, 0], [0, 0], [1, 0], [2, 0], [0, 1]],\r\n                [[0, -1], [0, 0], [-1, 0], [1, 1], [1, 0]],\r\n                [[-1, 0], [0, 0], [1, 0], [-1, 1], [0, 1]],\r\n            ],\r\n            U : [ //U\r\n                [[0, 0], [1, 0], [1, -1], [-1, 0], [-1, -1]],\r\n                [[0, 0], [1, 0], [2, 0], [0, -1], [1, -1]],\r\n                [[0, 0], [1, 0], [2, 0], [0, 1], [1, 1]],\r\n                [[0, 0], [1, 0], [1, 1], [-1, 0], [-1, 1]],\r\n                [[0, 0], [-1, 0], [-2, 0], [0, 1], [-1, 1]],\r\n                [[0, 0], [-1, 0], [-2, 0], [0, -1], [-1, -1]],\r\n            ],\r\n            I : [ //I\r\n                [[0, 0], [1, 0], [2, 0], [-1, 0], [-2, 0]],\r\n                [[0, 0], [1, 0], [1, 1], [0, -1], [-1, -1]],\r\n                [[0, 0], [1, 0], [1, -1], [0, 1], [-1, 1]],\r\n                [[0, 0], [1, 0], [2, 0], [-1, 0], [-2, 0]],\r\n                [[0, 0], [0, 1], [1, 1], [-1, 0], [-1, -1]],\r\n                [[0, 0], [0, -1], [1, -1], [-1, 0], [-1, 1]],\r\n            ],\r\n            g : [ //g\r\n                [[0, 0], [1, 0], [2, 0], [-1, 0], [-2, 0]],\r\n                [[0, 0], [1, 0], [1, 1], [0, -1], [-1, -1]],\r\n                [[0, 0], [1, 0], [1, -1], [0, 1], [-1, 1]],\r\n                [[0, 0], [1, 0], [2, 0], [-1, 0], [-2, 0]],\r\n                [[0, 0], [0, 1], [1, 1], [-1, 0], [-1, -1]],\r\n                [[0, 0], [0, -1], [1, -1], [-1, 0], [-1, 1]],\r\n            ]\r\n        };\r\n\r\n// prettier-ignore\r\n//回転に伴う軸の補正 壁際などでの感覚的な回転を可能にする\r\n//[種類][回転方向][回転前の回転状態][xかyか]\r\nexport const spinCorrection =\r\n        \r\n        {\r\n            L : [\r\n                [ //右回転\r\n                    [[0, 0], [-1, 0]], //0 > 1\r\n                    [[0, 0], [0, -1]], //1 > 2\r\n                    [[0, 0], [-1, 0], [1, 0], [-1, -1], [0, -1], [1, -1]], //2 > 3\r\n                    [[0, 0], [1, 0], [-1, 0], [0, -1], [1, -1]], //3 > 4\r\n                    [[0, 0], [1, 0]], //4 > 5\r\n                    [[0, 0], [-1, 0], [1, 0], [-1, -1], [0, -1]], //5 > 0\r\n               ],[ //左回転\r\n                    [[0, 0], [0, -1]], //0 > 5\r\n                    [[0, 0], [1, 0], [1, -1], [2, -1]], //1 > 0\r\n                    [[0, 0], [1, 0], [-1, 0], [1, -1]], //2 > 1\r\n                    [[0, 0], [-1, 0], [0, -1]], //3 > 2\r\n                    [[0, 0], [-1, 0], [0, -1], [-1, -1]], //4 > 3\r\n                    [[0, 0], [1, 0], [-1, 0], [-1, -1], [1, -1], [-2, -1], [0, -2]], //5 > 4\r\n                ]\r\n            ],\r\n            J : [ \r\n                [ //右回転\r\n                    [[0, 0], [0, -1]], //0 > 1\r\n                    [[0, 0], [-1, 0], [1, 0], [1, -1], [-1, -1], [2, -1], [0, -2]], //1 > 2\r\n                    [[0, 0], [1, 0], [0, -1], [1, -1]], //2 > 3\r\n                    [[0, 0], [1, 0], [0, -1]], //3 > 4\r\n                    [[0, 0], [-1, 0], [1, 0], [-1, -1]], //4 > 5\r\n                    [[0, 0], [-1, 0], [-1, -1], [-2, -1]], //5 > 0\r\n               ],[ //左回転\r\n                    [[0, 0], [1, 0]], //0 > 5\r\n                    [[0, 0], [1, 0], [-1, 0], [1, -1], [0, -1]], //1 > 0\r\n                    [[0, 0], [-1, 0]], //2 > 1\r\n                    [[0, 0], [-1, 0], [1, 0], [0, -1], [-1, -1]], //3 > 2\r\n                    [[0, 0], [1, 0], [-1, 0], [1, -1], [0, -1], [-1, -1]], //4 > 3\r\n                    [[0, 0], [0, -1]], //5 > 4\r\n                ]\r\n            ],\r\n            p : [\r\n                [ //右回転\r\n                    [[0, 0], [0, -1]], //0 > 1\r\n                    [[0, 0], [1, 0], [0, -1]], //1 > 2\r\n                    [[0, 0], [1, 0], [0, -1], [1, -1]], //2 > 3\r\n                    [[0, 0], [-1, 0]], //3 > 4\r\n                    [[0, 0], [0, -1]], //4 > 5\r\n                    [[0, 0], [-1, 0], [1, 0], [0, -1]], //5 > 0\r\n               ],[ //左回転\r\n                    [[0, 0], [0, -1]], //0 > 5\r\n                    [[0, 0], [-1, 0], [1, 0], [0, -1]], //1 > 0\r\n                    [[0, 0], [0, -1]], //2 > 1\r\n                    [[0, 0], [0, -1]], //3 > 2\r\n                    [[0, 0], [1, 0], [0, -1], [1, -1], [2, -1], [1, -2]], //4 > 3\r\n                    [[0, 0], [1, 0], [-1, 0], [0, -1]], //5 > 4\r\n                ]\r\n            ],\r\n            q : [\r\n                [ //右回転\r\n                    [[0, 0], [0, -1]], //0 > 1\r\n                    [[0, 0], [-1, 0], [1, 0], [0, -1]], //1 > 2\r\n                    [[0, 0], [-1, 0], [0, -1], [-1, -1], [-2, -1], [-1, -2]], //2 > 3\r\n                    [[0, 0], [0, -1]], //3 > 4\r\n                    [[0, 0], [0, -1]], //4 > 5\r\n                    [[0, 0], [1, 0], [-1, 0], [0, -1]], //5 > 0\r\n               ],[ //左回転\r\n                    [[0, 0], [0, -1]], //0 > 5\r\n                    [[0, 0], [1, 0], [-1, 0], [0, -1]], //1 > 0\r\n                    [[0, 0], [0, -1]], //2 > 1\r\n                    [[0, 0], [1, 0]], //3 > 2\r\n                    [[0, 0], [-1, 0], [0, -1], [-1, -1]], //4 > 3\r\n                    [[0, 0], [-1, 0], [0, -1]], //5 > 4\r\n                ]\r\n            ],\r\n            U : [\r\n                [ //右回転\r\n                    [[0, 0], [-1, 0]], //0 > 1\r\n                    [[0, 0], [0, -1]], //1 > 2\r\n                    [[0, 0], [1, 0], [0, -1]], //2 > 3\r\n                    [[0, 0], [1, 0], [0, -1], [1, -1]], //3 > 4\r\n                    [[0, 0], [0, 1]], //4 > 5\r\n                    [[0, 0], [-1, 0]], //5 > 0\r\n               ],[ //左回転\r\n                    [[0, 0], [1, 0]], //0 > 5\r\n                    [[0, 0], [1, 0]], //1 > 0\r\n                    [[0, 0], [0, 1]], //2 > 1\r\n                    [[0, 0], [-1, 0], [0, -1], [-1 ,-1]], //3 > 2\r\n                    [[0, 0], [-1, 0], [0, -1]], //4 > 3\r\n                    [[0, 0], [0, -1]], //5 > 4\r\n                ]\r\n            ],\r\n            I : [\r\n                [ //右回転\r\n                    [[0, 0], [0, -1]], //0 > 1\r\n                    [[0, 0], [0, -1], [1, -1], [2, -1]], //1 > 2\r\n                    [[0, 0], [-1, 0], [1, 0], [0, -1], [-1, -1], [1, -1]], //2 > 3\r\n                    [[0, 0], [0, -1]], //3 > 4\r\n                    [[0, 0], [1, 0], [0, -1]], //4 > 5\r\n                    [[0, 0], [-1, 0], [1, 0], [-2, 0], [-3, 0], [-2, -1], [0, -1], [1, -1]], //5 > 0\r\n               ],[ //左回転\r\n                    [[0, 0], [0, -1]], //0 > 5\r\n                    [[0, 0], [1, 0], [-1, 0], [2, 0], [3, 0], [2, -1], [0, -1], [-1, -1]], //1 > 0\r\n                    [[0, 0], [-1, 0], [0, -1]], //2 > 1\r\n                    [[0, 0], [0, -1]], //3 > 2\r\n                    [[0, 0], [1, 0], [-1, 0], [0, -1], [1, -1], [-1, -1]], //4 > 3\r\n                    [[0, 0], [0, -1], [-1, -1], [-2, -1]], //5 > 4\r\n                ]\r\n            ],\r\n            g : [\r\n                [ //右回転\r\n                    [[0, 0], [0, -1]], //0 > 1\r\n                    [[0, 0], [0, -1], [1, -1], [2, -1]], //1 > 2\r\n                    [[0, 0], [-1, 0], [1, 0], [0, -1], [-1, -1], [1, -1]], //2 > 3\r\n                    [[0, 0], [0, -1]], //3 > 4\r\n                    [[0, 0], [1, 0], [0, -1]], //4 > 5\r\n                    [[0, 0], [-1, 0], [1, 0], [-2, 0], [-3, 0], [-2, -1], [0, -1], [1, -1]], //5 > 0\r\n               ],[ //左回転\r\n                    [[0, 0], [0, -1]], //0 > 5\r\n                    [[0, 0], [1, 0], [-1, 0], [2, 0], [3, 0], [2, -1], [0, -1], [-1, -1]], //1 > 0\r\n                    [[0, 0], [-1, 0], [0, -1]], //2 > 1\r\n                    [[0, 0], [0, -1]], //3 > 2\r\n                    [[0, 0], [1, 0], [-1, 0], [0, -1], [1, -1], [-1, -1]], //4 > 3\r\n                    [[0, 0], [0, -1], [-1, -1], [-2, -1]], //5 > 4\r\n                ]\r\n            ]\r\n        };\r\n\r\nexport const moveCorrection = {\r\n    right: [[1, 0]],\r\n    left: [[-1, 0]],\r\n    down: [\r\n        [0, 1],\r\n        [-1, 1],\r\n        [1, 1],\r\n    ],\r\n};\r\n","import { ShapeInfo } from \"./BlockOperate/Block\";\r\n\r\nexport type TrickInfo = {\r\n    name: string;\r\n    shape: ShapeInfo[];\r\n    time: number;\r\n    attack: number;\r\n};\r\n\r\nexport const trickInfos: TrickInfo[] = [\r\n    {\r\n        name: \"一列揃え(上)\",\r\n        time: 10,\r\n        attack: 10,\r\n        shape: [\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"一列揃え(上)\",\r\n        time: 10,\r\n        attack: 10,\r\n        shape: [\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n        ],\r\n    },\r\n    ...地割れ(),\r\n    {\r\n        name: \"地殻変動(上)\",\r\n        time: 16,\r\n        attack: 8,\r\n        shape: [\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, false],\r\n            [true, false],\r\n            [true, false],\r\n            [true, false],\r\n            [true, false],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"地殻変動(下)\",\r\n        time: 16,\r\n        attack: 8,\r\n        shape: [\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [true, false],\r\n            [true, false],\r\n            [true, false],\r\n            [true, false],\r\n            [true, false],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"トゲトゲ(上)\",\r\n        time: 30,\r\n        attack: 20,\r\n        shape: [\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"トゲトゲ(下)\",\r\n        time: 30,\r\n        attack: 20,\r\n        shape: [\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [false, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"牙(上)\",\r\n        time: 50,\r\n        attack: 40,\r\n        shape: [\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"牙(下)\",\r\n        time: 50,\r\n        attack: 40,\r\n        shape: [\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n            [true, false],\r\n            [true, true],\r\n            [true, false],\r\n            [false, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"三つ子山\",\r\n        time: 15,\r\n        attack: 10,\r\n        shape: [\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n        ],\r\n    },\r\n    {\r\n        name: \"五人囃子\",\r\n        time: 30,\r\n        attack: 15,\r\n        shape: [\r\n            [false, true],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [false, true],\r\n            [true, true],\r\n            [true, false],\r\n            [true, true],\r\n            [false, true],\r\n        ],\r\n    },\r\n];\r\n\r\nfunction 地割れ(): TrickInfo[] {\r\n    const list: TrickInfo[] = [];\r\n\r\n    for (let h = 1; h < 16; h++) {\r\n        const l: (\"up\" | \"down\" | \"none\")[] = [];\r\n\r\n        for (let i = 0; i < h; i++) {\r\n            l.push(i % 2 === 0 ? \"up\" : \"down\");\r\n        }\r\n\r\n        l.push(\"none\");\r\n\r\n        for (let i = 1; i < 17 - h; i++) {\r\n            l.push((i + h + 1) % 2 === 0 ? \"up\" : \"down\");\r\n        }\r\n\r\n        list.push({\r\n            name: \"地割れ(上)\",\r\n            time: 8,\r\n            attack: 9,\r\n            shape: l.map(transpile),\r\n        });\r\n    }\r\n\r\n    for (let h = 1; h < 16; h++) {\r\n        const l: (\"up\" | \"down\" | \"none\")[] = [];\r\n\r\n        for (let i = 0; i < h; i++) {\r\n            l.push(i % 2 === 1 ? \"up\" : \"down\");\r\n        }\r\n\r\n        l.push(\"none\");\r\n\r\n        for (let i = 1; i < 17 - h; i++) {\r\n            l.push((i + h + 1) % 2 === 1 ? \"up\" : \"down\");\r\n        }\r\n\r\n        list.push({\r\n            name: \"地割れ(下)\",\r\n            time: 8,\r\n            attack: 9,\r\n            shape: l.map(transpile),\r\n        });\r\n    }\r\n\r\n    return list;\r\n}\r\n\r\nfunction transpile(shape: \"up\" | \"down\" | \"none\"): ShapeInfo {\r\n    switch (shape) {\r\n        case \"up\":\r\n            return [true, true];\r\n        case \"down\":\r\n            return [false, true];\r\n        case \"none\":\r\n            return [true, false];\r\n    }\r\n}\r\n","import { Block } from \"./Block\";\r\nimport { spinCorrection, moveCorrection } from \"./MondInfo\";\r\nimport { Monoiamond } from \"./Monoiamond\";\r\nimport { Pentiamond } from \"./Pentiamond\";\r\nimport * as Setting from \"../Settings\";\r\nimport { TrickInfo, trickInfos } from \"../Trick\";\r\n\r\nexport class BlockManager {\r\n    private blocks: Block[][];\r\n\r\n    constructor() {\r\n        this.blocks = new Array<Block[]>(Setting.playWidth);\r\n        for (let x = 0; x < Setting.playWidth; x++) {\r\n            this.blocks[x] = new Array<Block>(Setting.playHeight);\r\n            for (let y = 0; y < Setting.playHeight; y++) {\r\n                this.blocks[x][y] = new Block();\r\n            }\r\n        }\r\n    }\r\n\r\n    get g$blockProperties() {\r\n        return this.blocks.map((blockX) => blockX.map((block) => block.g$property));\r\n    }\r\n\r\n    getBlockProperty(x: number, y: number) {\r\n        return this.blocks[x][y].g$property;\r\n    }\r\n\r\n    /**\r\n     * @param mond 指定するmonoiamond\r\n     * @returns 仮想盤面に表示できるか\r\n     */\r\n    canDisplayMonoiamond(mond: Monoiamond): boolean {\r\n        if (!mond.isOnPlayCanvas()) {\r\n            return false;\r\n        }\r\n        return [-1, 0, 1].every((i) => {\r\n            return !this.existDisturbMondWith(mond, i as -1 | 0 | 1);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @param mond 指定するmonoiamond\r\n     * @param relativeX 相対的なx座標\r\n     * @returns 仮想盤面上の指定した座標に表示に邪魔なmonoiamondが存在するか\r\n     */\r\n    existDisturbMondWith(mond: Monoiamond, relativeX: -1 | 0 | 1): boolean {\r\n        if (mond.g$x + relativeX < 0 || Setting.playWidth <= mond.g$x + relativeX) {\r\n            return false;\r\n        }\r\n        if (relativeX == 0) {\r\n            return this.blocks[mond.g$x][mond.g$y].g$visible;\r\n        }\r\n        return this.blocks[mond.g$x + relativeX][mond.g$y].g$visible && this.blocks[mond.g$x + relativeX][mond.g$y].g$direction == mond.g$direction;\r\n    }\r\n\r\n    /**\r\n     * monoiamondを表示できるなら表示する\r\n     * @param mond 指定するmonoiamond\r\n     */\r\n    displayMonoiamond(mond: Monoiamond): void {\r\n        if (!this.canDisplayMonoiamond(mond)) {\r\n            return;\r\n        }\r\n        this.blocks[mond.g$x][mond.g$y].s$property = [mond.g$kind, mond.g$direction, true];\r\n        mond.s$visible = true;\r\n    }\r\n\r\n    remove(x: number, y: number) {\r\n        this.blocks[x][y].s$visible = false;\r\n    }\r\n\r\n    /**\r\n     * monoiamondを削除する\r\n     * @param mond 指定するmonoiamond\r\n     */\r\n    removeMonoiamond(mond: Monoiamond): void {\r\n        if (!mond.g$visible) {\r\n            return;\r\n        }\r\n        this.remove(mond.g$x, mond.g$y);\r\n        mond.s$visible = false;\r\n    }\r\n\r\n    /**\r\n     * @param mond 指定するpentiamond\r\n     * @returns 仮想盤面に表示できるか\r\n     */\r\n    canDisplayPentiamond(mond: Pentiamond): boolean {\r\n        return mond.g$monoiamonds.every((monoiamond) => {\r\n            return this.canDisplayMonoiamond(monoiamond);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * pentiamondを表示できるなら表示する\r\n     * @param mond 指定するpentiamond\r\n     */\r\n    displayPentiamond(mond: Pentiamond): void {\r\n        if (!this.canDisplayPentiamond(mond)) {\r\n            return;\r\n        }\r\n        mond.g$monoiamonds.forEach((monoiamond) => {\r\n            this.displayMonoiamond(monoiamond);\r\n        });\r\n        mond.s$visible = true;\r\n    }\r\n\r\n    /**\r\n     * pentiamondを削除する\r\n     * @param mond 指定するpentiamond\r\n     */\r\n    removePentiamond(mond: Pentiamond): void {\r\n        if (!mond.g$visible) {\r\n            return;\r\n        }\r\n        mond.g$monoiamonds.forEach((monoiamond) => {\r\n            this.removeMonoiamond(monoiamond);\r\n        });\r\n        mond.s$visible = false;\r\n    }\r\n\r\n    /**\r\n     * pentiamondを回転補正に則って回転させる\r\n     * @param mond 指定するpentiamond\r\n     * @param rotate 回転方向\r\n     * @returns 回転に成功したか\r\n     */\r\n    spin(mond: Pentiamond, rotate: \"right\" | \"left\"): boolean {\r\n        if (!mond.g$visible) {\r\n            return false;\r\n        }\r\n        this.removePentiamond(mond);\r\n        const displacement = spinCorrection[mond.g$kind][rotate == \"right\" ? 0 : 1][mond.g$direction];\r\n        const x = mond.g$x;\r\n        const y = mond.g$y;\r\n        mond.s$direction = mond.g$direction + (rotate == \"right\" ? 1 : -1);\r\n        for (let i = 0; i < displacement.length; i++) {\r\n            mond.s$position = [x + displacement[i][0], y + displacement[i][1]];\r\n            if (this.canDisplayPentiamond(mond)) {\r\n                this.displayPentiamond(mond);\r\n                return true;\r\n            }\r\n        }\r\n        mond.s$direction = mond.g$direction + (rotate == \"right\" ? -1 : 1);\r\n        mond.s$position = [x, y];\r\n        this.displayPentiamond(mond);\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * pentiamondを移動補正に則って移動させる\r\n     * @param mond 指定するpentiamond\r\n     * @param moveDirection 移動方向\r\n     * @returns 移動に成功したか\r\n     */\r\n    move(mond: Pentiamond, moveDirection: \"right\" | \"left\" | \"down\"): boolean {\r\n        if (!mond.g$visible) {\r\n            return false;\r\n        }\r\n        this.removePentiamond(mond);\r\n        const [x, y] = mond.g$position;\r\n        const displacement = moveCorrection[moveDirection];\r\n        for (let i = 0; i < displacement.length; i++) {\r\n            mond.s$position = [x + displacement[i][0], y + displacement[i][1]];\r\n            if (this.canDisplayPentiamond(mond)) {\r\n                this.displayPentiamond(mond);\r\n                return true;\r\n            }\r\n        }\r\n        mond.s$position = [x, y];\r\n        this.displayPentiamond(mond);\r\n        return false;\r\n    }\r\n\r\n    canFall(mond: Pentiamond) {\r\n        if (!mond.g$visible) {\r\n            return false;\r\n        }\r\n        const y = mond.g$y;\r\n        this.removePentiamond(mond);\r\n        mond.s$y = y + 1;\r\n        const result = this.canDisplayPentiamond(mond);\r\n        mond.s$y = y;\r\n        this.displayPentiamond(mond);\r\n        return result;\r\n    }\r\n\r\n    fall(mond: Pentiamond): boolean {\r\n        if (this.canFall(mond)) {\r\n            this.removePentiamond(mond);\r\n            mond.s$y = mond.g$y + 1;\r\n            this.displayPentiamond(mond);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    isEmpty(): boolean {\r\n        return this.blocks.every((blockX) => {\r\n            return blockX.every((block) => {\r\n                return !block.g$visible;\r\n            });\r\n        });\r\n    }\r\n\r\n    removeLine(): TrickInfo | null {\r\n        const lineShape = this.blocks\r\n            .map((blockX) => blockX[Setting.playHeight - 1].g$shapeInfo)\r\n            .flat()\r\n            .join();\r\n\r\n        const result = trickInfos.find((trickInfo) => {\r\n            return trickInfo.shape.flat().join() == lineShape;\r\n        });\r\n\r\n        for (let x = 0; x < Setting.playWidth; x++) {\r\n            for (let y = Setting.playHeight - 2; y >= 0; y--) {\r\n                this.blocks[x][y + 1].s$property = [this.blocks[x][y].g$kind, ...this.blocks[x][y].g$shapeInfo];\r\n            }\r\n            this.blocks[x][0].s$property = [\"g\", true, false];\r\n        }\r\n        return result ?? null;\r\n    }\r\n}\r\n","import { BlockKind } from \"./Block\";\r\nimport { mixArray } from \"../Utils\";\r\n\r\nexport class NextManager {\r\n    private next: BlockKind[] = [\"L\", \"J\", \"p\", \"q\", \"U\", \"I\"];\r\n    private next2: BlockKind[];\r\n    private holdKind: BlockKind | null = null;\r\n    private currentKind: BlockKind | null = null;\r\n    private prevKind: BlockKind | null = null;\r\n    private count: number = 0;\r\n    private nextMemory: BlockKind[] = [];\r\n\r\n    constructor() {\r\n        this.next2 = window.structuredClone(this.next);\r\n        mixArray(this.next);\r\n        mixArray(this.next2);\r\n        this.nextMemory = window.structuredClone(this.next);\r\n    }\r\n\r\n    get g$holdKind(): BlockKind | null {\r\n        return this.holdKind;\r\n    }\r\n\r\n    get g$currentKind(): BlockKind | null {\r\n        return this.currentKind;\r\n    }\r\n\r\n    get g$next(): BlockKind[] {\r\n        return window.structuredClone(this.next);\r\n    }\r\n\r\n    get g$prevKind(): BlockKind | null {\r\n        return this.prevKind;\r\n    }\r\n\r\n    get g$count(): number {\r\n        return this.count;\r\n    }\r\n\r\n    get g$nextMemory(): BlockKind[] {\r\n        return window.structuredClone(this.nextMemory);\r\n    }\r\n\r\n    set s$next(next: BlockKind[]) {\r\n        this.next = window.structuredClone(next);\r\n        this.next2 = [];\r\n    }\r\n\r\n    forgetPrev() {\r\n        this.prevKind = null;\r\n    }\r\n\r\n    private popNext() {\r\n        if (this.next.length == this.next2.length) {\r\n            this.next.push(this.next2[this.count % this.next2.length]);\r\n            this.nextMemory.push(this.next[this.next2.length]!);\r\n        }\r\n        this.currentKind = this.next.shift()!;\r\n        this.count++;\r\n        if (this.count % this.next2.length == 0) {\r\n            mixArray(this.next2);\r\n        }\r\n    }\r\n\r\n    proceed() {\r\n        this.prevKind = this.currentKind;\r\n        this.popNext();\r\n    }\r\n\r\n    hold() {\r\n        if (!this.currentKind) {\r\n            return;\r\n        }\r\n        if (!this.holdKind) {\r\n            this.holdKind = this.currentKind;\r\n            this.popNext();\r\n        } else {\r\n            [this.holdKind, this.currentKind] = [this.currentKind, this.holdKind];\r\n        }\r\n    }\r\n\r\n    back() {\r\n        if (!this.prevKind) {\r\n            return;\r\n        }\r\n        this.count--;\r\n        this.next.unshift(this.currentKind!);\r\n        this.currentKind = this.prevKind;\r\n        this.prevKind = null;\r\n    }\r\n}\r\n","import { BlockKind } from \"./Block\";\r\nimport * as Setting from \"../Settings\";\r\n\r\n/**\r\n * monoiamondの状態\r\n */\r\nexport type MondState = [number, number, BlockKind, boolean];\r\n\r\n/**\r\n * 仮想的な盤面上における一つの三角(monoiamond)を表す\r\n */\r\nexport class Monoiamond {\r\n    private x: number;\r\n    private y: number;\r\n    private kind: BlockKind = \"g\";\r\n    private direction: boolean = true;\r\n    private visible: boolean = false;\r\n\r\n    constructor(x: number = Setting.initialX, y: number = Setting.initialY, kind: BlockKind = \"g\", direction: boolean = true) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.kind = kind;\r\n        this.direction = direction;\r\n    }\r\n\r\n    /**\r\n     * x座標\r\n     */\r\n    get g$x(): number {\r\n        return this.x;\r\n    }\r\n\r\n    /**\r\n     * y座標\r\n     */\r\n    get g$y(): number {\r\n        return this.y;\r\n    }\r\n\r\n    /**\r\n     * 種類\r\n     */\r\n    get g$kind(): BlockKind {\r\n        return this.kind;\r\n    }\r\n\r\n    /**\r\n     * 上向き(true)か下向き(false)か\r\n     */\r\n    get g$direction(): boolean {\r\n        return this.direction;\r\n    }\r\n\r\n    /**\r\n     * 表示状態\r\n     */\r\n    get g$visible(): boolean {\r\n        return this.visible;\r\n    }\r\n\r\n    /**\r\n     * コピー\r\n     */\r\n    get g$copy(): Monoiamond {\r\n        const copy = new Monoiamond(this.x, this.y, this.kind, this.direction);\r\n        copy.s$visible = this.visible;\r\n        return copy;\r\n    }\r\n\r\n    get g$state(): MondState {\r\n        return [this.x, this.y, this.kind, this.direction];\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param x x座標\r\n     */\r\n    set s$x(x: number) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に座標を変更しないでください\");\r\n        }\r\n        this.x = x;\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param y y座標\r\n     */\r\n    set s$y(y: number) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に座標を変更しないでください\");\r\n        }\r\n        this.y = y;\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param kind 種類\r\n     */\r\n    set s$kind(kind: BlockKind) {\r\n        console.assert(!this.visible, \"表示中に種類を変更しないでください\");\r\n        this.kind = kind;\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param direction 上向き(true)か下向き(false)か\r\n     */\r\n    set s$direction(direction: boolean) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に方向を変更しないでください\");\r\n        }\r\n        this.direction = direction;\r\n    }\r\n\r\n    /**\r\n     * @param visible 表示状態\r\n     */\r\n    set s$visible(visible: boolean) {\r\n        this.visible = visible;\r\n    }\r\n\r\n    /**\r\n     * @returns 座標がプレイ領域内か\r\n     */\r\n    isOnPlayCanvas(): boolean {\r\n        if (this.x < 0 || Setting.playWidth <= this.x || this.y < 0 || Setting.playHeight <= this.y) {\r\n            return false;\r\n        }\r\n        if (!Number.isSafeInteger(this.x) || !Number.isSafeInteger(this.y)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n","import { BlockKind } from \"./Block\";\r\nimport { placement } from \"./MondInfo\";\r\nimport { MondState, Monoiamond } from \"./Monoiamond\";\r\nimport * as Setting from \"../Settings\";\r\n\r\n/**\r\n * 仮想的な盤面上におけるMonoiamondを5つ合わせたモンド(Pentiamond)を表す\r\n */\r\nexport class Pentiamond {\r\n    private x: number;\r\n    private y: number;\r\n    private kind: BlockKind;\r\n    private direction: number = 0;\r\n    private visible: boolean = false;\r\n    private monoiamonds: Monoiamond[];\r\n\r\n    constructor(x: number = Setting.initialX, y: number = Setting.initialY, kind: BlockKind = \"g\", direction: number = 0) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.kind = kind;\r\n        this.direction = direction;\r\n        this.monoiamonds = Array.from({ length: 5 }, () => new Monoiamond());\r\n        this.reload();\r\n    }\r\n\r\n    /**\r\n     * x座標\r\n     */\r\n    get g$x(): number {\r\n        return this.x;\r\n    }\r\n\r\n    /**\r\n     * y座標\r\n     */\r\n    get g$y(): number {\r\n        return this.y;\r\n    }\r\n\r\n    /**\r\n     * [x座標, y座標]\r\n     */\r\n    get g$position(): [number, number] {\r\n        return [this.x, this.y];\r\n    }\r\n\r\n    /**\r\n     * 種類\r\n     */\r\n    get g$kind(): BlockKind {\r\n        return this.kind;\r\n    }\r\n\r\n    /**\r\n     * 向き(0~5)\r\n     */\r\n    get g$direction(): number {\r\n        return this.direction;\r\n    }\r\n\r\n    /**\r\n     * 表示状態\r\n     */\r\n    get g$visible(): boolean {\r\n        return this.visible;\r\n    }\r\n\r\n    /**\r\n     * 構成するmonoiamondの配列\r\n     */\r\n    get g$monoiamonds(): Monoiamond[] {\r\n        return this.monoiamonds.map((monoiamond) => monoiamond.g$copy);\r\n    }\r\n\r\n    /**\r\n     * コピー\r\n     */\r\n    get g$copy(): Pentiamond {\r\n        const copy = new Pentiamond(this.x, this.y, this.kind, this.direction);\r\n        copy.s$visible = this.visible;\r\n        return copy;\r\n    }\r\n\r\n    /**\r\n     * 状態\r\n     */\r\n    get g$states(): MondState[] {\r\n        return this.monoiamonds.map((monoiamond) => monoiamond.g$state);\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param x x座標\r\n     */\r\n    set s$x(x: number) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に座標を変更しないでください\");\r\n        }\r\n        this.x = x;\r\n        this.reload();\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param y y座標\r\n     */\r\n    set s$y(y: number) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に座標を変更しないでください\");\r\n        }\r\n        this.y = y;\r\n        this.reload();\r\n    }\r\n\r\n    /**\r\n     * 座標を一括で設定する　表示中は変更できない\r\n     * @param x x座標\r\n     * @param y y座標\r\n     */\r\n    set s$position([x, y]: [number, number]) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に座標を変更しないでください\");\r\n        }\r\n        this.x = x;\r\n        this.y = y;\r\n        this.reload();\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param kind 種類\r\n     */\r\n    set s$kind(kind: BlockKind) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に種類を変更しないでください\");\r\n        }\r\n        this.kind = kind;\r\n        this.reload();\r\n    }\r\n\r\n    /**\r\n     * 表示中は変更できない\r\n     * @param direction mod6して0~5の値として解釈する\r\n     */\r\n    set s$direction(direction: number) {\r\n        if (this.visible) {\r\n            throw new Error(\"表示中に方向を変更しないでください\");\r\n        }\r\n        this.direction = ((direction % 6) + 6) % 6;\r\n        this.reload();\r\n    }\r\n\r\n    /**\r\n     * @param visible 表示状態\r\n     */\r\n    set s$visible(visible: boolean) {\r\n        this.visible = visible;\r\n        this.monoiamonds.forEach((m) => {\r\n            m.s$visible = visible;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @param index 番号\r\n     * @returns 指定した番号のmonoiamondのx座標\r\n     */\r\n    getPlacementX(index: number): number {\r\n        return this.x + placement[this.kind][this.direction][index][0];\r\n    }\r\n\r\n    /**\r\n     * @param index 番号\r\n     * @returns 指定した番号のmonoiamondのy座標\r\n     */\r\n    getPlacementY(index: number): number {\r\n        return this.y + placement[this.kind][this.direction][index][1];\r\n    }\r\n\r\n    /**\r\n     * 現在のプロパティを各monoiamondにまで反映させる\r\n     */\r\n    private reload(): void {\r\n        if (this.visible) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this.monoiamonds.length; i++) {\r\n            this.monoiamonds[i].s$x = this.getPlacementX(i);\r\n            this.monoiamonds[i].s$y = this.getPlacementY(i);\r\n            this.monoiamonds[i].s$kind = this.kind;\r\n            this.monoiamonds[i].s$direction = (i + this.direction) % 2 == 0 ? true : false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns プレイ領域内に収まっているか\r\n     */\r\n    isOnPlayCanvas(): boolean {\r\n        for (let i = 0; i < this.monoiamonds.length; i++) {\r\n            if (!this.monoiamonds[i].isOnPlayCanvas()) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n","import { BlockManager } from \"./BlockManager\";\r\nimport { GraphicData } from \"../CanvasManager\";\r\nimport { EventId, EventManager, MyEventListener } from \"../EventManager\";\r\nimport { MondState } from \"./Monoiamond\";\r\nimport { NextManager } from \"./NextManager\";\r\nimport { Pentiamond } from \"./Pentiamond\";\r\nimport * as Setting from \"../Settings\";\r\nimport { TrickInfo } from \"../Trick\";\r\nimport { BlockKind } from \"./Block\";\r\n\r\nexport class MondOperator implements MyEventListener {\r\n    blockManager: BlockManager = new BlockManager();\r\n    private hand: Pentiamond = new Pentiamond();\r\n    private prevPosition: [number, number] | null = null;\r\n    private prevDirection: number | null = null;\r\n    private next: NextManager = new NextManager();\r\n    private pausing: boolean = true;\r\n    private lastTrick: TrickInfo | null = null;\r\n\r\n    readonly eventClassNames: string[] = [\"move\", \"move-left\", \"move-right\", \"move-down\", \"spin\", \"spin-left\", \"spin-right\", \"put\", \"unput\", \"removeLine\", \"hold\"];\r\n    eventIds: EventId[] = [];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        const eventId = EventManager.addEvent({ classNames: classNames.filter((className) => this.eventClassNames.includes(className)), handler });\r\n        this.eventIds.push(eventId);\r\n        return eventId;\r\n    }\r\n\r\n    constructor() {}\r\n\r\n    get g$graphicData(): GraphicData {\r\n        return {\r\n            blockProperties: this.blockManager.g$blockProperties,\r\n            ghostMondState: this.g$ghostState,\r\n            next: this.next.g$next,\r\n            hold: this.next.g$holdKind,\r\n        };\r\n    }\r\n\r\n    get g$blockManager(): BlockManager {\r\n        return this.blockManager;\r\n    }\r\n\r\n    get g$nextMemory(): BlockKind[] {\r\n        return window.structuredClone(this.next.g$nextMemory);\r\n    }\r\n\r\n    set s$next(next: BlockKind[]) {\r\n        if (!this.next.g$currentKind) {\r\n            this.next.s$next = next;\r\n        }\r\n    }\r\n\r\n    private get g$ghostState(): MondState[] {\r\n        if (!this.hand.g$visible) {\r\n            return [];\r\n        }\r\n        this.blockManager.removePentiamond(this.hand);\r\n        const ghostMond = this.hand.g$copy;\r\n        ghostMond.s$visible = false;\r\n        this.blockManager.displayPentiamond(ghostMond);\r\n        while (this.blockManager.fall(ghostMond));\r\n        this.blockManager.removePentiamond(ghostMond);\r\n        this.blockManager.displayPentiamond(this.hand);\r\n        return ghostMond.g$states;\r\n    }\r\n\r\n    get g$lastTrick(): TrickInfo | null {\r\n        return this.lastTrick;\r\n    }\r\n\r\n    start() {\r\n        if (!this.next.g$currentKind) {\r\n            this.proceed();\r\n        }\r\n        this.pausing = false;\r\n        this.blockManager.displayPentiamond(this.hand);\r\n    }\r\n\r\n    stop() {\r\n        this.pausing = true;\r\n        this.blockManager.removePentiamond(this.hand);\r\n    }\r\n\r\n    private proceed() {\r\n        this.next.proceed();\r\n        this.initializeHand();\r\n        this.blockManager.displayPentiamond(this.hand);\r\n    }\r\n\r\n    private initializeHand() {\r\n        this.hand = new Pentiamond(Setting.initialX, Setting.initialY, this.next.g$currentKind!);\r\n    }\r\n\r\n    move(moveDirection: \"right\" | \"left\" | \"down\"): void {\r\n        if (!this.isOperable()) {\r\n            return;\r\n        }\r\n        if (this.blockManager.move(this.hand, moveDirection)) {\r\n            EventManager.executeListeningEvents(\"move\", this.eventIds);\r\n            EventManager.executeListeningEvents(\"move-\" + moveDirection, this.eventIds);\r\n        }\r\n    }\r\n\r\n    spin(rotate: \"right\" | \"left\"): void {\r\n        if (!this.isOperable()) {\r\n            return;\r\n        }\r\n        if (this.blockManager.spin(this.hand, rotate)) {\r\n            EventManager.executeListeningEvents(\"spin\", this.eventIds);\r\n            EventManager.executeListeningEvents(\"spin-\" + rotate, this.eventIds);\r\n        }\r\n    }\r\n\r\n    hold() {\r\n        if (!this.isOperable()) {\r\n            return;\r\n        }\r\n        this.blockManager.removePentiamond(this.hand);\r\n        this.next.hold();\r\n        this.initializeHand();\r\n        this.blockManager.displayPentiamond(this.hand);\r\n        EventManager.executeListeningEvents(\"hold\", this.eventIds);\r\n    }\r\n\r\n    put() {\r\n        if (!this.isOperable()) {\r\n            return;\r\n        }\r\n        while (this.blockManager.fall(this.hand));\r\n        this.prevPosition = this.hand.g$position;\r\n        this.prevDirection = this.hand.g$direction;\r\n        this.proceed();\r\n        EventManager.executeListeningEvents(\"put\", this.eventIds);\r\n    }\r\n\r\n    unput() {\r\n        if (this.pausing || !this.prevPosition) {\r\n            return;\r\n        }\r\n        this.blockManager.removePentiamond(this.hand);\r\n        this.next.back();\r\n        this.initializeHand();\r\n        this.hand.s$position = this.prevPosition;\r\n        this.hand.s$direction = this.prevDirection!;\r\n        this.hand.s$visible = true;\r\n        this.blockManager.removePentiamond(this.hand);\r\n        this.hand.s$position = [Setting.initialX, Setting.initialY];\r\n        this.hand.s$direction = 0;\r\n        this.blockManager.displayPentiamond(this.hand);\r\n        this.forgetPrev();\r\n        EventManager.executeListeningEvents(\"unput\", this.eventIds);\r\n    }\r\n\r\n    removeLine() {\r\n        if (this.pausing) {\r\n            return;\r\n        }\r\n        this.blockManager.removePentiamond(this.hand);\r\n        this.forgetPrev();\r\n        this.lastTrick = this.blockManager.removeLine();\r\n        this.hand.s$position = [Setting.initialX, Setting.initialY];\r\n        this.hand.s$direction = 0;\r\n        this.blockManager.displayPentiamond(this.hand);\r\n        EventManager.executeListeningEvents(\"removeLine\", this.eventIds);\r\n    }\r\n\r\n    forgetPrev() {\r\n        this.prevPosition = null;\r\n        this.prevDirection = null;\r\n        this.next.forgetPrev();\r\n    }\r\n\r\n    isOperable() {\r\n        return this.hand.g$visible && !this.pausing;\r\n    }\r\n\r\n    isPausing() {\r\n        return this.pausing;\r\n    }\r\n}\r\n","import { BlockManager } from \"../BlockOperate/BlockManager\";\r\nimport { EventId, EventManager, MyEventListener } from \"../EventManager\";\r\nimport { LoopManager } from \"../LoopManager\";\r\nimport { Monoiamond } from \"../BlockOperate/Monoiamond\";\r\nimport * as Setting from \"../Settings\";\r\nimport { gameEvents } from \"./GameMode\";\r\n\r\n/**\r\n * じゃまモンドに関連する処理を行う\r\n */\r\nexport class NuisanceMondManager implements MyEventListener {\r\n    //実際にnuisanceBlockを表示するblockManager\r\n    private blockManager: BlockManager;\r\n    //現在盤面上にあるnuisanceBlockを持つ配列\r\n    private nuisanceMonds: Monoiamond[] = [];\r\n    //前回のdamageによるpenalty\r\n    //どのブロックも破壊しないまま地面に着いたnuisanceBlockの数\r\n    private penalty: number = 0;\r\n    //damage処理中ならtrue\r\n    private damaging: boolean = false;\r\n    //progressを繰り返し実行する用のinterval\r\n    private loop: LoopManager = new LoopManager();\r\n    //damage用に生成するnuisanceBlockの個数\r\n    private task = 0;\r\n    //一回のdamage中のnuisanceBlockの生成の進行度合い\r\n    private taskCount = 0;\r\n    //nuisanceBlockを三回に一回にする用のcount\r\n    private progressCount = 0;\r\n    private spawnCoordinates: number[] = [];\r\n    private spawnCoordinateMemory: number[] = [];\r\n\r\n    /**\r\n     * @param startDamage ダメージ処理開始\r\n     * @param destroyMond モンド破壊\r\n     * @param damageBoard 盤面へのダメージ\r\n     * @param finishDamage ダメージ処理終了\r\n     */\r\n    eventClassNames: string[] = [\"startDamage\", \"progress\", \"destroyMond\", \"damageBoard\", \"finishDamage\"];\r\n    eventIds: EventId[] = [];\r\n    addEvent(classNames: string[], handler: Function): EventId {\r\n        const eventId = EventManager.addEvent({ classNames: classNames.filter((className) => this.eventClassNames.includes(className)), handler });\r\n        this.eventIds.push(eventId);\r\n        return eventId;\r\n    }\r\n\r\n    constructor(blockManager: BlockManager) {\r\n        this.blockManager = blockManager;\r\n        gameEvents.push(\r\n            this.loop.addEvent([\"loop\"], () => {\r\n                this.damageProcess();\r\n            })\r\n        );\r\n    }\r\n\r\n    //damage処理中でないときは前回のdamageによるpenaltyを返す\r\n    //damage処理中のときは-1を返す\r\n    get g$penalty(): number {\r\n        if (this.damaging) {\r\n            return -1;\r\n        }\r\n        return this.penalty;\r\n    }\r\n\r\n    get g$spawnCoordinateMemory(): number[] {\r\n        return this.spawnCoordinateMemory;\r\n    }\r\n\r\n    set s$spawnCoordinates(spawnCoordinates: number[]) {\r\n        this.spawnCoordinates = spawnCoordinates;\r\n    }\r\n\r\n    //damageProgressを呼び出す頻度を取得する\r\n    private get g$progressFrequency(): number {\r\n        const frequency = Math.floor(Setting.damageTime / (Setting.damageGrace * (this.task - 1) + Setting.playHeight));\r\n        if (frequency < 5) {\r\n            return 5;\r\n        } else {\r\n            return frequency;\r\n        }\r\n    }\r\n\r\n    //指定した座標でNuisanceBlockを生成する\r\n    private createNuisanceBlock(x: number, y: number) {\r\n        const nuisanceMond = new Monoiamond(x, y, \"g\", false);\r\n        if (this.blockManager.canDisplayMonoiamond(nuisanceMond)) {\r\n            this.blockManager.displayMonoiamond(nuisanceMond);\r\n            this.nuisanceMonds.push(nuisanceMond);\r\n        } else if (!this.blockManager.getBlockProperty(x, y)[1]) {\r\n            this.blockManager.remove(x, y);\r\n        } else if (0 < x) {\r\n            this.blockManager.remove(x - 1, y);\r\n        } else if (x < Setting.playWidth - 1) {\r\n            this.blockManager.remove(x + 1, y);\r\n        } else {\r\n            this.blockManager.remove(x, y);\r\n        }\r\n        this.spawnCoordinateMemory.push(x);\r\n    }\r\n\r\n    //taskの分だけNuisanceBlockによるdamage処理を行う\r\n    damage(task: number) {\r\n        //すでにdamage処理中のとき、taskを増やす\r\n        if (this.damaging && task > 0) {\r\n            this.task += task;\r\n            this.loop.reset();\r\n            this.loop.s$loopFrequency = this.g$progressFrequency;\r\n            return;\r\n        }\r\n\r\n        this.damaging = true;\r\n        this.penalty = 0;\r\n        this.task = task;\r\n        this.progressCount = 0;\r\n        this.loop.reset();\r\n        this.loop.s$loopFrequency = this.g$progressFrequency;\r\n        EventManager.executeListeningEvents(\"startDamage\", this.eventIds);\r\n    }\r\n\r\n    //NuisanceBlockを進行させて、すでにあるブロックとぶつかった場合は対消滅する\r\n    private progress() {\r\n        let damageBoard = false;\r\n        for (const nuisanceMond of this.nuisanceMonds) {\r\n            damageBoard = false;\r\n\r\n            const visible = (dx: number, dy: number) => {\r\n                return this.blockManager.getBlockProperty(nuisanceMond.g$x + dx, nuisanceMond.g$y + dy)[2];\r\n            };\r\n\r\n            const direction = (dx: number, dy: number) => {\r\n                return this.blockManager.getBlockProperty(nuisanceMond.g$x + dx, nuisanceMond.g$y + dy)[1];\r\n            };\r\n            const remove = (dx: number, dy: number) => {\r\n                if (dx != 0 || dy != 0) {\r\n                    this.blockManager.remove(nuisanceMond.g$x + dx, nuisanceMond.g$y + dy);\r\n                }\r\n                this.blockManager.removeMonoiamond(nuisanceMond);\r\n            };\r\n\r\n            const isGrounded = () => {\r\n                return nuisanceMond.g$y == Setting.playHeight - 1;\r\n            };\r\n\r\n            //左端でも右端でもないとき\r\n            if (0 < nuisanceMond.g$x && nuisanceMond.g$x < Setting.playWidth - 1) {\r\n                //左隣が存在するとき\r\n                if (visible(-1, 0)) {\r\n                    remove(-1, 0);\r\n                    //右隣が存在するとき\r\n                } else if (visible(1, 0)) {\r\n                    remove(1, 0);\r\n                    //一番下に着いたとき\r\n                    //このときは対消滅するブロックがないため、代わりにpenaltyを受ける\r\n                } else if (isGrounded()) {\r\n                    damageBoard = true;\r\n                    remove(0, 0);\r\n                    //真下が下向きで存在するとき\r\n                } else if (visible(0, 1) && !direction(0, 1)) {\r\n                    remove(0, 1);\r\n                    //左下が下向きで存在するとき\r\n                } else if (visible(-1, 1) && !direction(-1, 1)) {\r\n                    remove(-1, 1);\r\n                    //右下が下向きで存在するとき\r\n                } else if (visible(1, 1) && !direction(1, 1)) {\r\n                    remove(1, 1);\r\n                    //真下が上向きで存在するとき\r\n                } else if (visible(0, 1)) {\r\n                    remove(0, 1);\r\n                }\r\n                //左端ではないとき\r\n            } else if (0 < nuisanceMond.g$x) {\r\n                //左隣が存在するとき\r\n                if (visible(-1, 0)) {\r\n                    remove(-1, 0);\r\n                    //一番下に着いたとき\r\n                    //このときは対消滅するブロックがないため、代わりにpenaltyを受ける\r\n                } else if (isGrounded()) {\r\n                    damageBoard = true;\r\n                    remove(0, 0);\r\n                    //真下が下向きで存在するとき\r\n                } else if (visible(0, 1) && !direction(0, 1)) {\r\n                    remove(0, 1);\r\n                    //左下が下向きで存在するとき\r\n                } else if (visible(-1, 1) && !direction(-1, 1)) {\r\n                    remove(-1, 1);\r\n                    //真下が上向きで存在するとき\r\n                } else if (visible(0, 1)) {\r\n                    remove(0, 1);\r\n                }\r\n                //右端ではないとき\r\n            } else if (nuisanceMond.g$x < Setting.playWidth - 1) {\r\n                //右隣が存在するとき\r\n                if (visible(1, 0)) {\r\n                    remove(1, 0);\r\n                    //一番下に着いたとき\r\n                    //このときは対消滅するブロックがないため、代わりにpenaltyを受ける\r\n                } else if (isGrounded()) {\r\n                    damageBoard = true;\r\n                    remove(0, 0);\r\n                    //真下が下向きで存在するとき\r\n                } else if (visible(0, 1) && !direction(0, 1)) {\r\n                    remove(0, 1);\r\n                    //右下が下向きで存在するとき\r\n                } else if (visible(1, 1) && !direction(1, 1)) {\r\n                    remove(1, 1);\r\n                    //真下が上向きで存在するとき\r\n                } else if (visible(0, 1)) {\r\n                    remove(0, 1);\r\n                }\r\n                //右端かつ左端のとき\r\n            } else {\r\n                //一番下に着いたとき\r\n                if (isGrounded()) {\r\n                    damageBoard = true;\r\n                    remove(0, 0);\r\n                    //真下が存在するとき\r\n                } else if (visible(0, 1)) {\r\n                    remove(0, 1);\r\n                }\r\n            }\r\n\r\n            //上記の条件に一つも引っかからなかったとき\r\n            if (nuisanceMond.g$visible) {\r\n                this.blockManager.removeMonoiamond(nuisanceMond);\r\n                nuisanceMond.s$y = nuisanceMond.g$y + 1;\r\n                this.blockManager.displayMonoiamond(nuisanceMond);\r\n            } else {\r\n                if (damageBoard) {\r\n                    EventManager.executeListeningEvents(\"damageBoard\", this.eventIds);\r\n                    this.penalty++;\r\n                } else {\r\n                    EventManager.executeListeningEvents(\"destroyMond\", this.eventIds);\r\n                }\r\n            }\r\n        }\r\n\r\n        //対消滅したnuisanceBlockをリストから削除する\r\n        this.nuisanceMonds = this.nuisanceMonds.filter((nuisanceMond) => nuisanceMond.g$visible);\r\n        EventManager.executeListeningEvents(\"progress\", this.eventIds);\r\n    }\r\n\r\n    //progressFrequencyの頻度でNuisanceBlockを進行させつつ、三回に一回の割合で、taskの分だけNuisanceBlockを生成する\r\n    private damageProcess() {\r\n        if (this.progressCount == 0) {\r\n            //指定されたtaskの量の生成が完了していないとき\r\n            if (this.taskCount < this.task) {\r\n                this.progress();\r\n                const x = this.spawnCoordinates.length ? this.spawnCoordinates.shift()! : Math.floor(Math.random() * Setting.playWidth);\r\n                this.createNuisanceBlock(x, 0);\r\n                this.progressCount++;\r\n                this.taskCount++;\r\n                //すでにtaskの量の生成を完了していて、盤面に残っているnuisanceBlockが存在しないとき\r\n            } else if (this.nuisanceMonds.length == 0) {\r\n                this.finishDamage();\r\n                //すでにtaskの量の生成を完了しているが盤面にnuisanceBlockが残っているとき\r\n            } else {\r\n                this.progress();\r\n            }\r\n        } else {\r\n            //盤面に残っているnuisanceBlockが存在しないとき\r\n            if (this.nuisanceMonds.length == 0) {\r\n                this.progressCount = 0;\r\n                //盤面にnuisanceBlockが残っているとき\r\n            } else {\r\n                this.progress();\r\n                this.progressCount++;\r\n            }\r\n\r\n            if (this.progressCount == Setting.damageGrace) {\r\n                this.progressCount = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    //damage処理を終了させる\r\n    private finishDamage() {\r\n        this.loop.reset();\r\n        this.task = 0;\r\n        this.progressCount = 0;\r\n        this.taskCount = 0;\r\n        EventManager.executeListeningEvents(\"finishDamage\", this.eventIds);\r\n        this.damaging = false;\r\n    }\r\n\r\n    //damage処理を中止する\r\n    cancelDamage(): void {\r\n        this.loop.reset();\r\n        for (const nuisanceMond of this.nuisanceMonds) {\r\n            this.blockManager.removeMonoiamond(nuisanceMond);\r\n        }\r\n        this.task = 0;\r\n        this.progressCount = 0;\r\n        this.taskCount = 0;\r\n        this.damaging = false;\r\n    }\r\n\r\n    /**\r\n     * damage処理を一時中断する\r\n     */\r\n    stop(): void {\r\n        if (!this.damaging) {\r\n            return;\r\n        }\r\n        this.loop.stop();\r\n    }\r\n\r\n    /**\r\n     * 一時中断していたdamage処理を再開する\r\n     */\r\n    start(): void {\r\n        if (!this.damaging) {\r\n            return;\r\n        }\r\n        this.loop.start();\r\n    }\r\n}\r\n","import { BlockKind, BlockProperty } from \"./BlockOperate/Block\";\r\nimport { MondState } from \"./BlockOperate/Monoiamond\";\r\nimport { Pentiamond } from \"./BlockOperate/Pentiamond\";\r\nimport * as Setting from \"./Settings\";\r\nimport { arrayPlus } from \"./Utils\";\r\n\r\nexport type GraphicData = {\r\n    blockProperties: BlockProperty[][] | null;\r\n    ghostMondState: MondState[];\r\n    next: BlockKind[];\r\n    hold: BlockKind | null;\r\n};\r\n\r\nexport class CanvasManager {\r\n    private playCanvas: HTMLCanvasElement = document.createElement(\"canvas\");\r\n    private pct: CanvasRenderingContext2D;\r\n    private nextCanvas: HTMLCanvasElement = document.createElement(\"canvas\");\r\n    private nct: CanvasRenderingContext2D;\r\n    private data: GraphicData = {\r\n        blockProperties: null,\r\n        ghostMondState: [],\r\n        next: [],\r\n        hold: null,\r\n    };\r\n    guideBorder: boolean = false;\r\n    guideBorderHeight: number = 15;\r\n    constructor() {\r\n        this.playCanvas.classList.add(\"playCanvas\");\r\n        this.pct = this.playCanvas.getContext(\"2d\")!;\r\n        this.playCanvas.height = Setting.blockHeight * (Setting.height + Setting.displayMargin);\r\n        this.playCanvas.width = Setting.blockWidth * Setting.width;\r\n        this.playCanvas.style.aspectRatio = this.playCanvas.width / this.playCanvas.height + \"\";\r\n        this.nextCanvas.classList.add(\"nextCanvas\");\r\n        this.nct = this.nextCanvas.getContext(\"2d\")!;\r\n        this.nextCanvas.height = Setting.blockHeight * Setting.next.height * (Setting.next.scale.hold + Setting.next.scale.normal * Setting.next.length) + Setting.next.gap;\r\n        this.nextCanvas.width = Setting.blockWidth * Setting.next.width * Math.max(Setting.next.scale.hold, Setting.next.scale.normal);\r\n        this.nextCanvas.style.aspectRatio = this.nextCanvas.width / this.nextCanvas.height + \"\";\r\n    }\r\n\r\n    get g$playCanvas() {\r\n        return this.playCanvas;\r\n    }\r\n\r\n    get g$nextCanvas() {\r\n        return this.nextCanvas;\r\n    }\r\n\r\n    readData(data: GraphicData) {\r\n        this.data = data;\r\n    }\r\n\r\n    paint() {\r\n        this.paintPlayCanvas();\r\n        this.paintNextCanvas();\r\n    }\r\n\r\n    paintPlayCanvas() {\r\n        this.pct.clearRect(0, 0, this.playCanvas.width, this.playCanvas.height);\r\n        this.paintBackground();\r\n        if (this.guideBorder) {\r\n            this.paintGuideBorder();\r\n        }\r\n        this.paintGrid();\r\n        this.paintGhost();\r\n        this.paintBlocks();\r\n    }\r\n\r\n    private paintGhost() {\r\n        if (this.data.ghostMondState.length == 0) {\r\n            return;\r\n        }\r\n        this.data.ghostMondState.forEach((state) => {\r\n            this.paintBlock(state[0], state[1], [state[2], state[3], true], true);\r\n        });\r\n    }\r\n\r\n    private paintBlocks() {\r\n        if (!this.data.blockProperties) {\r\n            return;\r\n        }\r\n        for (let x = 0; x < Setting.playWidth; x++) {\r\n            for (let y = 0; y < Setting.playHeight; y++) {\r\n                this.paintBlock(x, y, this.data.blockProperties[x][y]);\r\n            }\r\n        }\r\n    }\r\n\r\n    private paintBlock(x: number, y: number, property: BlockProperty, isGhost = false) {\r\n        if (!property[2]) {\r\n            return;\r\n        }\r\n\r\n        if (isGhost) {\r\n            this.pct.strokeStyle = Setting.mondGrid.ghost.color;\r\n            this.pct.fillStyle = Setting.blockColor.ghost[property[0]];\r\n            this.pct.lineWidth = Setting.mondGrid.ghost.width;\r\n        } else {\r\n            this.pct.strokeStyle = Setting.mondGrid.normal.color;\r\n            this.pct.fillStyle = Setting.blockColor.normal[property[0]];\r\n            this.pct.lineWidth = Setting.mondGrid.normal.width;\r\n        }\r\n        this.pct.lineJoin = \"bevel\";\r\n        this.pct.lineCap = \"round\";\r\n        const position = this.getGraphicPosition(x, y);\r\n        const p1 = arrayPlus([0, property[1] ? Setting.blockHeight : 0], position);\r\n        const p2 = arrayPlus([Setting.blockWidth / 2, property[1] ? 0 : Setting.blockHeight], position);\r\n        const p3 = arrayPlus([Setting.blockWidth, property[1] ? Setting.blockHeight : 0], position);\r\n        this.pct.beginPath();\r\n        this.pct.moveTo(p1[0], p1[1]);\r\n        this.pct.lineTo(p2[0], p2[1]);\r\n        this.pct.lineTo(p3[0], p3[1]);\r\n        this.pct.closePath();\r\n        this.pct.fill();\r\n        this.pct.stroke();\r\n    }\r\n\r\n    private paintBackground() {\r\n        this.pct.fillStyle = Setting.backgroundColor;\r\n        this.pct.fillRect(0, 0, this.playCanvas.width, this.playCanvas.height);\r\n    }\r\n\r\n    private paintGuideBorder() {\r\n        this.pct.fillStyle = Setting.guideBorderColor;\r\n        this.pct.fillRect(0, Setting.blockHeight * (Setting.height + Setting.displayMargin - this.guideBorderHeight), this.playCanvas.width, Setting.blockHeight);\r\n    }\r\n\r\n    private paintGrid() {\r\n        this.pct.strokeStyle = Setting.canvasGrid.color;\r\n        this.pct.lineWidth = Setting.canvasGrid.width;\r\n        for (let x = 0; x <= Setting.width; x++) {\r\n            this.pct.beginPath();\r\n            this.pct.moveTo(x * Setting.blockWidth, 0);\r\n            this.pct.lineTo(x * Setting.blockWidth, this.playCanvas.height);\r\n            this.pct.stroke();\r\n        }\r\n    }\r\n\r\n    private getGraphicPosition(x: number, y: number) {\r\n        return [Setting.blockWidth * (x / 2), this.playCanvas.height - Setting.blockHeight * (Setting.playHeight - y)];\r\n    }\r\n\r\n    private getNextGraphicPosition(x: number, y: number, isHold: boolean = false) {\r\n        return [\r\n            Setting.blockWidth * (x / 2) * (isHold ? Setting.next.scale.hold : Setting.next.scale.normal),\r\n            isHold\r\n                ? Setting.blockHeight * Setting.next.scale.hold * y\r\n                : Setting.blockHeight * Setting.next.scale.hold * Setting.next.height + Setting.next.gap + Setting.blockHeight * Setting.next.scale.normal * (y - Setting.next.height),\r\n        ];\r\n    }\r\n\r\n    paintNextCanvas() {\r\n        this.nct.clearRect(0, 0, this.nextCanvas.width, this.nextCanvas.height);\r\n        this.paintNextBackground();\r\n        this.paintNext();\r\n    }\r\n\r\n    private paintNextBackground() {\r\n        this.nct.fillStyle = Setting.backgroundColor;\r\n        this.nct.fillRect(0, 0, Setting.blockWidth * Setting.next.width * Setting.next.scale.hold, Setting.blockHeight * Setting.next.height * Setting.next.scale.hold + Setting.next.gap / 4);\r\n        this.nct.fillRect(\r\n            0,\r\n            Setting.blockHeight * Setting.next.height * Setting.next.scale.hold + (Setting.next.gap * 3) / 4,\r\n            Setting.blockWidth * Setting.next.width * Setting.next.scale.normal,\r\n            Setting.blockHeight * Setting.next.height * Setting.next.length + Setting.next.gap / 4\r\n        );\r\n        this.nct.fillStyle = Setting.next.splitColor;\r\n        this.nct.fillRect(0, Setting.blockHeight * Setting.next.height * Setting.next.scale.hold + Setting.next.gap / 4, this.nextCanvas.width, Setting.next.gap / 2);\r\n    }\r\n\r\n    private paintNext() {\r\n        const correction = Setting.next.height / 2 - Math.floor(Setting.next.height / 2);\r\n        if (this.data.hold) {\r\n            const hold = new Pentiamond(Setting.next.width - 1, Math.floor((Setting.next.height - 1) / 2), this.data.hold);\r\n            const holdStates = hold.g$states;\r\n            holdStates.forEach((state) => {\r\n                this.paintNextBlock(state[0], state[1] + correction, [state[2], state[3], true], true);\r\n            });\r\n        }\r\n        for (let i = 0; i < Math.min(Setting.next.length, this.data.next.length); i++) {\r\n            const next = new Pentiamond(Setting.next.width - 1, Math.floor(Setting.next.height / 2) + Setting.next.height * (i + 1), this.data.next[i]);\r\n            const nextStates = next.g$states;\r\n            nextStates.forEach((state) => {\r\n                this.paintNextBlock(state[0], state[1] + correction, [state[2], state[3], true]);\r\n            });\r\n        }\r\n    }\r\n\r\n    private paintNextBlock(x: number, y: number, property: BlockProperty, isHold: boolean = false) {\r\n        if (!property[2]) {\r\n            return;\r\n        }\r\n        this.nct.strokeStyle = Setting.mondGrid.normal.color;\r\n        this.nct.fillStyle = Setting.blockColor.normal[property[0]];\r\n        this.nct.lineWidth = Setting.mondGrid.normal.width;\r\n        this.nct.lineJoin = \"bevel\";\r\n        this.nct.lineCap = \"round\";\r\n        const scale = isHold ? Setting.next.scale.hold : Setting.next.scale.normal;\r\n        const position = this.getNextGraphicPosition(x, y, isHold);\r\n        const p1 = arrayPlus([0, property[1] ? Setting.blockHeight * scale : 0], position);\r\n        const p2 = arrayPlus([(Setting.blockWidth * scale) / 2, property[1] ? 0 : Setting.blockHeight * scale], position);\r\n        const p3 = arrayPlus([Setting.blockWidth * scale, property[1] ? Setting.blockHeight * scale : 0], position);\r\n        this.nct.beginPath();\r\n        this.nct.moveTo(p1[0], p1[1]);\r\n        this.nct.lineTo(p2[0], p2[1]);\r\n        this.nct.lineTo(p3[0], p3[1]);\r\n        this.nct.closePath();\r\n        this.nct.fill();\r\n        this.nct.stroke();\r\n    }\r\n}\r\n","import { inputManager } from \"../Interaction/InputManager\";\r\nimport { qsAll } from \"../Utils\";\r\n\r\ntype InformationLabel = {\r\n    name: string;\r\n    label: HTMLDivElement;\r\n    content: string;\r\n    visible: boolean;\r\n};\r\n\r\nexport class InformationLabelManager {\r\n    private labels = {\r\n        gameTime: {\r\n            name: \"Time\",\r\n            label: document.createElement(\"div\"),\r\n            content: \"\",\r\n            visible: false,\r\n        },\r\n        playTime: {\r\n            name: \"Time\",\r\n            label: document.createElement(\"div\"),\r\n            content: \"\",\r\n            visible: false,\r\n        },\r\n        line: {\r\n            name: \"Line\",\r\n            label: document.createElement(\"div\"),\r\n            content: \"\",\r\n            visible: false,\r\n        },\r\n        lastTrick: {\r\n            name: \"Trick\",\r\n            label: document.createElement(\"div\"),\r\n            content: \"\",\r\n            visible: false,\r\n        },\r\n        chain: {\r\n            name: \"Chain\",\r\n            label: document.createElement(\"div\"),\r\n            content: \"\",\r\n            visible: false,\r\n        },\r\n        score: {\r\n            name: \"Score\",\r\n            label: document.createElement(\"div\"),\r\n            content: \"\",\r\n            visible: false,\r\n        },\r\n    };\r\n\r\n    private base: HTMLDivElement = document.createElement(\"div\");\r\n    constructor(\r\n        {\r\n            gameTime,\r\n            playTime,\r\n            line = false,\r\n            lastTrick,\r\n            chain,\r\n            score,\r\n        }: {\r\n            gameTime: boolean;\r\n            playTime: boolean;\r\n            line: boolean;\r\n            lastTrick: boolean;\r\n            chain: boolean;\r\n            score: boolean;\r\n        } = {\r\n            gameTime: false,\r\n            playTime: false,\r\n            line: false,\r\n            lastTrick: false,\r\n            chain: false,\r\n            score: false,\r\n        }\r\n    ) {\r\n        this.s$visible = { gameTime, playTime, line, lastTrick, chain, score };\r\n        Object.values(this.labels).forEach((element) => {\r\n            element.label.classList.add(\"informationLabel\");\r\n            this.base.appendChild(element.label);\r\n            if (element.name == \"Trick\") {\r\n                if (inputManager.g$registeredInputNumber == 1) {\r\n                    element.label.style.fontSize = \"3vh\";\r\n                } else {\r\n                    element.label.style.fontSize = `calc((100vh * 14 / 9 / ${inputManager.g$registeredInputNumber}) /33)`;\r\n                }\r\n            } else if (element.name == \"Score\") {\r\n                if (inputManager.g$registeredInputNumber == 1) {\r\n                    element.label.style.fontSize = \"4vh\";\r\n                } else {\r\n                    element.label.style.fontSize = `calc((100vh * 14 / 9 / ${inputManager.g$registeredInputNumber}) /28)`;\r\n                }\r\n            } else {\r\n                if (inputManager.g$registeredInputNumber == 1) {\r\n                    element.label.style.fontSize = \"6vh\";\r\n                } else {\r\n                    element.label.style.fontSize = `calc((100vh * 14 / 9 / ${inputManager.g$registeredInputNumber}) /17)`;\r\n                }\r\n            }\r\n        });\r\n        if (inputManager.g$registeredInputNumber == 1) {\r\n            this.labels.playTime.label.style.fontSize = \"4vh\";\r\n        } else {\r\n            this.labels.playTime.label.style.fontSize = `calc((100vh * 14 / 9 / ${inputManager.g$registeredInputNumber}) /28)`;\r\n        }\r\n\r\n        this.base.classList.add(\"informationLabelBase\");\r\n        // this.labels.lastTrick.label.style.fontSize = \"3vh\";\r\n    }\r\n    get g$element() {\r\n        return this.base;\r\n    }\r\n\r\n    set s$visible({ gameTime, playTime, line, lastTrick, chain, score }: { gameTime: boolean; playTime: boolean; line: boolean; lastTrick: boolean; chain: boolean; score: boolean }) {\r\n        [this.labels.gameTime.visible, this.labels.playTime.visible, this.labels.line.visible, this.labels.lastTrick.visible, this.labels.chain.visible, this.labels.score.visible] = [\r\n            gameTime,\r\n            playTime,\r\n            line,\r\n            lastTrick,\r\n            chain,\r\n            score,\r\n        ];\r\n        this.labels.gameTime.label.style.display = gameTime ? \"\" : \"none\";\r\n        this.labels.playTime.label.style.display = playTime ? \"\" : \"none\";\r\n        this.labels.line.label.style.display = line ? \"\" : \"none\";\r\n        this.labels.lastTrick.label.style.display = lastTrick ? \"\" : \"none\";\r\n        this.labels.chain.label.style.display = chain ? \"\" : \"none\";\r\n        this.labels.score.label.style.display = score ? \"\" : \"none\";\r\n    }\r\n\r\n    updateContents({ gameTime, playTime, line, lastTrick, chain, score }: { gameTime?: string; playTime?: string; line?: string; lastTrick?: string; chain?: string; score?: string }) {\r\n        if (gameTime != undefined && this.labels.gameTime.visible && this.labels.gameTime.content != gameTime) {\r\n            this.labels.gameTime.content = gameTime;\r\n            this.labels.gameTime.label.innerHTML = `<div class=\"informationLabelHeader\">${this.labels.gameTime.name}</div>` + gameTime;\r\n        }\r\n        if (playTime != undefined && this.labels.playTime.visible && this.labels.playTime.content != playTime) {\r\n            this.labels.playTime.content = playTime;\r\n            this.labels.playTime.label.innerHTML = `<div class=\"informationLabelHeader\">${this.labels.playTime.name}</div>` + playTime;\r\n        }\r\n        if (line != undefined && this.labels.line.visible && this.labels.line.content != line) {\r\n            this.labels.line.content = line;\r\n            this.labels.line.label.innerHTML = `<div class=\"informationLabelHeader\">${this.labels.line.name}</div>` + line;\r\n        }\r\n        if (lastTrick != undefined && this.labels.lastTrick.visible && this.labels.lastTrick.content != lastTrick) {\r\n            this.labels.lastTrick.content = lastTrick;\r\n            this.labels.lastTrick.label.innerHTML = `<div class=\"informationLabelHeader\">${this.labels.lastTrick.name}</div>` + lastTrick;\r\n        }\r\n        if (chain != undefined && this.labels.chain.visible && this.labels.chain.content != chain) {\r\n            this.labels.chain.content = chain;\r\n            this.labels.chain.label.innerHTML = `<div class=\"informationLabelHeader\">${this.labels.chain.name}</div>` + chain;\r\n        }\r\n        if (score != undefined && this.labels.score.visible && this.labels.score.content != score) {\r\n            this.labels.score.content = score;\r\n            this.labels.score.label.innerHTML = `<div class=\"informationLabelHeader\">${this.labels.score.name}</div>` + score;\r\n        }\r\n        qsAll(\".informationLabelHeader\").forEach((element) => {\r\n            if (inputManager.g$registeredInputNumber == 1) {\r\n                element.style.fontSize = \"4vh\";\r\n            } else {\r\n                element.style.fontSize = `calc((100vh * 14 / 9 / ${inputManager.g$registeredInputNumber}) /22)`;\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { LoopManager } from \"../LoopManager\";\r\nimport { MondOperator } from \"../BlockOperate/MondOperator\";\r\nimport { NuisanceMondManager } from \"./NuisanceMondManager\";\r\nimport { Input } from \"../Interaction/Input\";\r\nimport { CanvasManager } from \"../CanvasManager\";\r\nimport { InformationLabelManager } from \"./InformationLabelManager\";\r\nimport { TrickInfo } from \"../Trick\";\r\nimport * as Setting from \"../Settings\";\r\nimport { gameEvents } from \"./GameMode\";\r\nimport { GraphicSetting } from \"../GraphicSetting\";\r\n\r\nexport class GamePlayer {\r\n    operator: MondOperator = new MondOperator();\r\n    loop: LoopManager = new LoopManager();\r\n    nuisanceMondManager: NuisanceMondManager;\r\n    canvas: CanvasManager = new CanvasManager();\r\n    label: InformationLabelManager = new InformationLabelManager();\r\n    input: Input;\r\n    playField: HTMLDivElement = document.createElement(\"div\");\r\n    playInfo = {\r\n        maxGameTime: 300,\r\n        gameTime: 300,\r\n        playTime: 0,\r\n        line: 0,\r\n        lastTrick: null as TrickInfo | null,\r\n        trickCount: 0,\r\n        chain: 0,\r\n        maxChain: 0,\r\n        score: 0,\r\n        penalty: 0,\r\n        penaltyTask: 0,\r\n        recovery: 0,\r\n        surplus: 0,\r\n        put: 0,\r\n        hold: 0,\r\n        unput: 0,\r\n        remove: 0,\r\n        handy: 1,\r\n    };\r\n    state = {\r\n        hasFinished: false,\r\n        damaging: false,\r\n    };\r\n    damageInfo = {\r\n        damageTask: 0,\r\n        temporaryDamageTask: 0,\r\n        attackTask: 0,\r\n        lastDamageTime: 0,\r\n        totalDamage: 0,\r\n        totalAttack: 0,\r\n    };\r\n    animations = {\r\n        put: this.playField.animate(\r\n            [\r\n                {\r\n                    transform: \"translate(0, 0.3vh)\",\r\n                },\r\n                {\r\n                    transform: \"\",\r\n                },\r\n            ],\r\n            {\r\n                duration: 100,\r\n                direction: \"normal\",\r\n                iterations: 1,\r\n                easing: \"ease-out\",\r\n            }\r\n        ),\r\n        removeLineWithTrick: this.playField.animate(\r\n            [\r\n                {\r\n                    rotate: \"0deg\",\r\n                },\r\n                {\r\n                    rotate: \"-0.5deg\",\r\n                },\r\n                {\r\n                    rotate: \"0.5deg\",\r\n                    scale: 1.02,\r\n                },\r\n                {\r\n                    rotate: \"0deg\",\r\n                },\r\n            ],\r\n            {\r\n                duration: 100,\r\n                direction: \"normal\",\r\n                iterations: 1,\r\n            }\r\n        ),\r\n        removeLineWithoutTrick: this.playField.animate(\r\n            [\r\n                {\r\n                    rotate: \"0deg\",\r\n                },\r\n                {\r\n                    rotate: \"-0.5deg\",\r\n                },\r\n                {\r\n                    rotate: \"0.5deg\",\r\n                },\r\n                {\r\n                    rotate: \"0deg\",\r\n                },\r\n            ],\r\n            {\r\n                duration: 70,\r\n                direction: \"normal\",\r\n                iterations: 1,\r\n            }\r\n        ),\r\n\r\n        caution: this.playField.animate(\r\n            [\r\n                {\r\n                    backgroundColor: \"\",\r\n                },\r\n                {\r\n                    backgroundColor: \"#eeee99\",\r\n                },\r\n                {\r\n                    backgroundColor: \"#eeee99\",\r\n                },\r\n                {\r\n                    backgroundColor: \"\",\r\n                },\r\n            ],\r\n            {\r\n                duration: 1000,\r\n                direction: \"normal\",\r\n                iterations: Infinity,\r\n            }\r\n        ),\r\n        warning: this.playField.animate(\r\n            [\r\n                {\r\n                    backgroundColor: \"\",\r\n                },\r\n                {\r\n                    backgroundColor: \"#ee9999\",\r\n                },\r\n                {\r\n                    backgroundColor: \"#ee9999\",\r\n                },\r\n                {\r\n                    backgroundColor: \"\",\r\n                },\r\n            ],\r\n            {\r\n                duration: 1000,\r\n                direction: \"normal\",\r\n                iterations: Infinity,\r\n            }\r\n        ),\r\n        damageBoard: this.playField.animate(\r\n            [\r\n                {\r\n                    transform: \"translate(0, 1.4vh)\",\r\n                },\r\n                {\r\n                    transform: \"\",\r\n                },\r\n            ],\r\n            {\r\n                duration: 10,\r\n                direction: \"normal\",\r\n                iterations: 1,\r\n            }\r\n        ),\r\n        timeWarning: this.playField.animate(\r\n            [\r\n                {\r\n                    transform: \"\",\r\n                    rotate: \"0deg\",\r\n                },\r\n                {\r\n                    transform: \"translate(-0.08vh, 0)\",\r\n                    rotate: \"-0.2deg\",\r\n                },\r\n                {\r\n                    transform: \"translate(0.08vh, 0)\",\r\n                    rotate: \"0.2deg\",\r\n                },\r\n                {\r\n                    rotate: \"0deg\",\r\n                },\r\n            ],\r\n            {\r\n                duration: 200,\r\n                direction: \"normal\",\r\n                iterations: Infinity,\r\n            }\r\n        ),\r\n        finish: this.playField.animate(\r\n            [\r\n                {\r\n                    opacity: 1,\r\n                    rotate: \"0deg\",\r\n                    scale: 1,\r\n                },\r\n                {\r\n                    opacity: 0,\r\n                    rotate: \"720deg\",\r\n                    scale: 0,\r\n                },\r\n            ],\r\n            {\r\n                duration: 1000,\r\n                direction: \"normal\",\r\n                fill: \"forwards\",\r\n                iterations: 1,\r\n            }\r\n        ),\r\n    };\r\n    runningAnimations: Animation[] = [];\r\n\r\n    constructor(input: Input) {\r\n        this.nuisanceMondManager = new NuisanceMondManager(this.operator.blockManager);\r\n\r\n        gameEvents.push(\r\n            this.nuisanceMondManager.addEvent([\"finishDamage\"], () => {\r\n                this.state.damaging = false;\r\n                this.damageInfo.damageTask = 0;\r\n                this.operator.forgetPrev();\r\n                this.animations.caution.cancel();\r\n                this.animations.warning.cancel();\r\n                this.proceedTemporaryDamageTask();\r\n                if (this.loop.g$isLooping) {\r\n                    this.operator.start();\r\n                }\r\n                this.updateCanvas();\r\n            }),\r\n            this.nuisanceMondManager.addEvent([\"damageBoard\"], () => {\r\n                this.playInfo.penalty += 1;\r\n                this.animations.damageBoard.play();\r\n            }),\r\n            this.nuisanceMondManager.addEvent([\"progress\"], () => {\r\n                this.canvas.readData(this.operator.g$graphicData);\r\n                this.canvas.paintPlayCanvas();\r\n            }),\r\n            this.operator.addEvent([\"put\"], () => {\r\n                if (GraphicSetting.putShake) {\r\n                    this.animations.put.play();\r\n                }\r\n            })\r\n        );\r\n        this.input = input;\r\n        this.playField.classList.add(\"playField\");\r\n        this.playField.appendChild(this.canvas.g$playCanvas);\r\n        this.playField.appendChild(this.canvas.g$nextCanvas);\r\n        this.playField.appendChild(this.label.g$element);\r\n        this.canvas.paint();\r\n        Object.values(this.animations).forEach((animation) => {\r\n            animation.cancel();\r\n        });\r\n    }\r\n\r\n    get g$element(): HTMLDivElement {\r\n        return this.playField;\r\n    }\r\n\r\n    get g$playTimeString() {\r\n        return (this.loop.g$elapsedTime / 1000).toFixed(2);\r\n    }\r\n\r\n    start() {\r\n        if (this.state.hasFinished) {\r\n            return;\r\n        }\r\n        this.loop.start();\r\n        if (!this.state.damaging) {\r\n            this.operator.start();\r\n        }\r\n        this.nuisanceMondManager.start();\r\n        this.updateCanvas();\r\n        this.runningAnimations.forEach((animation) => {\r\n            animation.play();\r\n        });\r\n        if (this.input.g$type == \"autoKeyboard\") {\r\n            this.input.g$manager.start();\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        this.loop.stop();\r\n        this.operator.stop();\r\n        this.nuisanceMondManager.stop();\r\n        this.runningAnimations = Object.values(this.animations).filter((animation) => {\r\n            animation.playState == \"running\";\r\n        });\r\n        this.runningAnimations.forEach((animation) => {\r\n            animation.pause();\r\n        });\r\n        if (this.input.g$type == \"autoKeyboard\") {\r\n            this.input.g$manager.stop();\r\n        }\r\n    }\r\n\r\n    finish() {\r\n        this.stop();\r\n        this.updateGameTime();\r\n        this.state.hasFinished = true;\r\n        this.animations.timeWarning.cancel();\r\n    }\r\n\r\n    addDamageTask(damageTask: number) {\r\n        if (this.state.hasFinished || damageTask == 0) {\r\n            return;\r\n        }\r\n        if (this.damageInfo.damageTask != 0 && !this.state.damaging) {\r\n            this.damageInfo.damageTask += damageTask;\r\n            return;\r\n        }\r\n        if (this.state.damaging) {\r\n            this.damageInfo.temporaryDamageTask += damageTask;\r\n            return;\r\n        }\r\n        this.damageInfo.lastDamageTime = this.loop.g$elapsedTime;\r\n        this.damageInfo.damageTask += damageTask;\r\n        this.animations.caution.play();\r\n    }\r\n\r\n    private proceedTemporaryDamageTask() {\r\n        if (this.state.damaging || this.state.hasFinished) {\r\n            return;\r\n        }\r\n        if (this.damageInfo.temporaryDamageTask > 0) {\r\n            this.damageInfo.damageTask += this.damageInfo.temporaryDamageTask;\r\n            this.damageInfo.temporaryDamageTask = 0;\r\n            this.damageInfo.lastDamageTime = this.loop.g$elapsedTime;\r\n            this.animations.caution.play();\r\n        }\r\n    }\r\n\r\n    damage() {\r\n        if (this.state.damaging || this.damageInfo.damageTask == 0 || this.state.hasFinished) {\r\n            return;\r\n        }\r\n        this.state.damaging = true;\r\n        this.operator.stop();\r\n        this.nuisanceMondManager.damage(this.damageInfo.damageTask);\r\n        this.nuisanceMondManager.start();\r\n    }\r\n\r\n    updateGameTime() {\r\n        if (this.state.hasFinished) {\r\n            return;\r\n        }\r\n        this.playInfo.gameTime = Math.max(\r\n            Math.ceil(this.playInfo.maxGameTime - this.loop.g$elapsedTime / Setting.gameTimeRate) - this.playInfo.penalty + this.playInfo.recovery - this.playInfo.surplus,\r\n            0\r\n        );\r\n        if (this.playInfo.gameTime > this.playInfo.maxGameTime) {\r\n            this.playInfo.surplus += this.playInfo.gameTime - this.playInfo.maxGameTime;\r\n            this.playInfo.gameTime = this.playInfo.maxGameTime;\r\n        }\r\n    }\r\n\r\n    updateCanvas() {\r\n        this.canvas.readData(this.operator.g$graphicData);\r\n        this.canvas.paint();\r\n    }\r\n}\r\n","import { sleep } from \"../Utils\";\r\n\r\nimport { GameMode } from \"../Game/GameMode\";\r\nimport { GamePlayer } from \"../Game/GamePlayer\";\r\nimport { Input } from \"../Interaction/Input\";\r\nimport { PlaySetting } from \"../BeforePlay\";\r\nimport { ReplayData } from \"../Replay/Replay\";\r\n\r\n/**\r\n * ゲームのセッティングから片付けまでやって捨てられるクラス\r\n */\r\nexport class DisposableGame {\r\n    readonly players: GamePlayer[];\r\n    readonly game: GameMode;\r\n\r\n    readonly playSetting: PlaySetting;\r\n    readonly replayData?: ReplayData;\r\n\r\n    onFinished = () => {};\r\n\r\n    constructor(gameModeList: (typeof GameMode)[], inputs: Input[], inputCount: number, { playSetting, replayData }: { playSetting?: PlaySetting; replayData?: ReplayData }) {\r\n        if (replayData) {\r\n            this.replayData = replayData;\r\n            this.playSetting = replayData.playSetting;\r\n        } else if (playSetting) {\r\n            this.playSetting = structuredClone(playSetting);\r\n        } else {\r\n            throw new Error(\"引数不足\");\r\n        }\r\n\r\n        //登録されているinputをもとにplayersを作成する\r\n        this.players = DisposableGame.createPlayers(this.playSetting.maxGameTime, inputs, inputCount, { replayData: this.replayData });\r\n\r\n        // ゲームを作成\r\n        const CurrentMode = gameModeList[this.playSetting.mode - 1];\r\n        // @ts-ignore\r\n        this.game = new CurrentMode(this.players);\r\n        this.game.addEvent([\"gameFinish\"], async () => {\r\n            await this.onGameFinish();\r\n        });\r\n    }\r\n\r\n    appendPlayersTo(container: HTMLElement) {\r\n        this.players.forEach((player) => {\r\n            container.appendChild(player.g$element);\r\n        });\r\n    }\r\n\r\n    isReplay() {\r\n        return !!this.replayData;\r\n    }\r\n\r\n    async start() {\r\n        this.game.start();\r\n    }\r\n\r\n    private async onGameFinish() {\r\n        if (this.isReplay()) {\r\n            this.onFinishReplay();\r\n        }\r\n\r\n        await sleep(1000);\r\n        this.game.remove();\r\n        this.onFinished();\r\n    }\r\n\r\n    private onFinishReplay() {\r\n        const data = this.replayData;\r\n\r\n        if (!data) throw new Error(\"この関数はリプレイ時のみ実行されるはず\");\r\n\r\n        // Timeを上書き\r\n        data.finishPlayers.forEach((index) => {\r\n            const player = this.players![index - 1];\r\n            player.playInfo.playTime = data.finishTime;\r\n            player.label.updateContents({ playTime: (data.finishTime / 1000).toFixed(2) });\r\n        });\r\n    }\r\n\r\n    private static createPlayers(maxGameTime: number, inputs: Input[], inputCount: number, { replayData }: { replayData?: ReplayData }) {\r\n        const players = inputs.map((input) => new GamePlayer(input));\r\n\r\n        players.forEach((player, i) => {\r\n            if (inputCount == 1) {\r\n                player.g$element.style.flex = \"none\";\r\n                player.g$element.style.height = \"100%\";\r\n                player.g$element.style.width = \"\";\r\n            } else {\r\n                player.g$element.style.flex = \"\";\r\n                player.g$element.style.height = \"\";\r\n                player.g$element.style.width = `0px`;\r\n            }\r\n\r\n            player.playInfo.maxGameTime = maxGameTime;\r\n            player.playInfo.gameTime = maxGameTime;\r\n\r\n            //リプレイ情報の読み込み\r\n            if (replayData) {\r\n                player.operator.s$next = replayData.nextData[i];\r\n                player.nuisanceMondManager.s$spawnCoordinates = replayData.nuisanceBlockData[i];\r\n            }\r\n        });\r\n\r\n        return players;\r\n    }\r\n}\r\n","import { GamePlayer } from \"../Game/GamePlayer\";\r\nimport { PlaySetting } from \"../BeforePlay\";\r\nimport { qsAll, qs } from \"../Utils\";\r\nimport { Replay } from \"../Replay/Replay\";\r\n\r\n/**\r\n * ResultPageに関する、状態を持たない関数群\r\n */\r\nexport class ResultPageHandler {\r\n    private static readonly parser = new DOMParser();\r\n\r\n    static setSaveButton() {\r\n        const saveButton = qs(\"#result .saveReplayButton\");\r\n        saveButton.innerText = \"リプレイを保存する\";\r\n        saveButton.onclick = () => {\r\n            saveButton.innerText = \"保存中……\";\r\n\r\n            const succeed = Replay.saveLastOne();\r\n            if (succeed) {\r\n                Replay.setupSavedReplayPage();\r\n                saveButton.innerText = \"保存しました\";\r\n                saveButton.onclick = () => {};\r\n            } else {\r\n                saveButton.innerText = \"リプレイを保存する\";\r\n            }\r\n        };\r\n    }\r\n\r\n    static OverWriteTime(finishTime: number) {\r\n        qsAll(\".resultLabel\").forEach((resultLabel) => {\r\n            if (resultLabel.innerText.includes(\"Time\")) {\r\n                resultLabel.innerText = `Time : ${(finishTime / 1000).toFixed(2)}`;\r\n            }\r\n        });\r\n    }\r\n\r\n    //詳細結果の中身を作成する\r\n    static updateDetailedResultPage({ players, playSetting }: { players: GamePlayer[]; playSetting: PlaySetting }) {\r\n        // 前の結果を消す\r\n        qsAll(\"#detailedResult .subPage\").forEach((subPage) => {\r\n            subPage.remove();\r\n        });\r\n\r\n        const subPageController = qs(\"#detailedResult .subPageController\");\r\n\r\n        const resultTitlePage = this.createResultTitlePage(players, playSetting);\r\n        subPageController.before(resultTitlePage);\r\n\r\n        players.forEach((player, index) => {\r\n            const page = this.createPlayerResultPage(playSetting, player, index);\r\n            subPageController.before(page);\r\n        });\r\n    }\r\n\r\n    private static createResultTitlePage(players: GamePlayer[], playSetting: PlaySetting) {\r\n        const html = `\r\n            <div class=\"subPage\">\r\n                <div class=\"text\">\r\n                    Player人数 : ${players.length}<br />\r\n                    モード : ${playSetting.mode == 1 ? \"サバイバル\" : \"十五列揃え\"}<br />\r\n                    ${players.length != 1 ? `勝者 : ${qs(\".resultLabel\").innerHTML}<br />` : \"\"}\r\n                </div>\r\n            </div>    \r\n        `;\r\n\r\n        return this.parser.parseFromString(html, \"text/html\").body.firstElementChild!;\r\n    }\r\n\r\n    private static createPlayerResultPage(playSetting: PlaySetting, p: GamePlayer, i: number) {\r\n        const html = `\r\n            <div class=\"subPage\">\r\n                <div class=\"text\">\r\n                    Player : ${i + 1}<br />\r\n                    ${[1].includes(playSetting.mode) ? `開始Time : ${p.playInfo.maxGameTime}<br />` : \"\"}\r\n                    ${[1].includes(playSetting.mode) ? `残りTime : ${p.playInfo.gameTime}<br />` : \"\"}\r\n                    プレイ時間 : ${(p.playInfo.playTime / 1000).toFixed(2)}<br />\r\n                    役の回数 : ${p.playInfo.trickCount}<br />\r\n                    一列揃え : ${p.playInfo.line}<br />\r\n                    最大Chain : ${p.playInfo.maxChain}<br />\r\n                    Score : ${p.playInfo.score}<br />\r\n                </div>\r\n                <div class=\"text\">\r\n                    ペナルティ : ${p.playInfo.penalty}<br />\r\n                    回復 : ${p.playInfo.recovery}<br />\r\n                    余剰回復 : ${p.playInfo.surplus}<br />\r\n                    設置 : ${p.playInfo.put}<br />\r\n                    ホールド : ${p.playInfo.hold}<br />\r\n                    一手戻し : ${p.playInfo.unput}<br />\r\n                    消去 : ${p.playInfo.remove}<br />\r\n                </div>\r\n                <div class=\"text\">\r\n                    合計ダメージ : ${p.damageInfo.totalDamage}<br />\r\n                    合計攻撃 : ${p.damageInfo.totalAttack}<br />\r\n                    ハンデ : ×${p.playInfo.handy}<br />\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        return this.parser.parseFromString(html, \"text/html\").body.firstElementChild!;\r\n    }\r\n}\r\n","import { qs } from \"../Utils\";\r\n\r\nexport function countDown(countString: string[]) {\r\n    let r = () => {};\r\n\r\n    const handler = () => {\r\n        const startEffectLabel = document.createElement(\"div\");\r\n        startEffectLabel.classList.add(\"startEffectLabel\");\r\n        startEffectLabel.innerHTML = countString.shift() ?? \"\";\r\n\r\n        if (countString.length == 0) {\r\n            startEffectLabel.id = \"startLabel\";\r\n        } else if (startEffectLabel.innerHTML != \"\") {\r\n        }\r\n\r\n        qs(\"#startEffectBase\").appendChild(startEffectLabel);\r\n\r\n        startEffectLabel.onanimationend = () => {\r\n            startEffectLabel.remove();\r\n\r\n            if (countString.length) {\r\n                handler();\r\n            } else {\r\n                r();\r\n            }\r\n        };\r\n    };\r\n\r\n    handler();\r\n\r\n    return new Promise<void>((resolve) => {\r\n        r = resolve;\r\n    });\r\n}\r\n","import { Mode1 } from \"../Game/Modes/Mode1\";\r\nimport { Mode2 } from \"../Game/Modes/Mode2\";\r\nimport { Input } from \"../Interaction/Input\";\r\nimport { inputManager } from \"../Interaction/InputManager\";\r\nimport { pageManager } from \"../PageManager\";\r\nimport { playBackground } from \"../PlayBackground\";\r\nimport { PlaySetting } from \"../BeforePlay\";\r\nimport { Replay, ReplayData } from \"../Replay/Replay\";\r\nimport { DisposableGame } from \"./DisposableGame\";\r\nimport { ResultPageHandler } from \"./ResultPageHandler\";\r\nimport { countDown } from \"./countDown\";\r\nimport { qs } from \"../Utils\";\r\n\r\n//ゲーム開始\r\nexport class GameProcessing {\r\n    private static readonly ModeClassList = [Mode1, Mode2];\r\n\r\n    static currentGame: DisposableGame | null = null;\r\n\r\n    static resume() {\r\n        if (!this.currentGame) throw new Error(\"プレイ中ではない\");\r\n        this.currentGame.game.start();\r\n    }\r\n\r\n    static isReplaying(): this is GameProcessing & { currentGame: DisposableGame & { replayData: ReplayData } } {\r\n        if (!this.currentGame) throw new Error(\"プレイ中ではない\");\r\n        return this.currentGame.isReplay();\r\n    }\r\n\r\n    static restartReplay() {\r\n        if (!this.isReplaying()) throw new Error(\"リプレイ中ではない\");\r\n        this.startReplay(this.currentGame.replayData);\r\n    }\r\n\r\n    static async startNormal(playSetting: PlaySetting) {\r\n        this.beforeStart();\r\n\r\n        this.currentGame = new DisposableGame(\r\n            this.ModeClassList,\r\n            inputManager.g$registeredInputs,\r\n            inputManager.g$maxInputNumber,\r\n\r\n            { playSetting }\r\n        );\r\n\r\n        this.currentGame.onFinished = () => {\r\n            this.onFinishNormal();\r\n        };\r\n\r\n        // 画面にappend\r\n        this.currentGame.appendPlayersTo(qs(\"#play\"));\r\n\r\n        await this.countDownAndStart();\r\n    }\r\n\r\n    static async startReplay(replayData: ReplayData) {\r\n        this.beforeStart();\r\n\r\n        this.setupReplayInputs(replayData);\r\n\r\n        this.currentGame = new DisposableGame(\r\n            this.ModeClassList,\r\n            inputManager.g$registeredInputs,\r\n            inputManager.g$maxInputNumber,\r\n\r\n            { replayData }\r\n        );\r\n\r\n        this.currentGame.onFinished = () => {\r\n            this.onFinishReplay();\r\n        };\r\n\r\n        this.currentGame.appendPlayersTo(qs(\"#play\"));\r\n\r\n        await this.countDownAndStart();\r\n\r\n        this.startAutoPlay();\r\n    }\r\n\r\n    private static setupReplayInputs(replayData: ReplayData) {\r\n        inputManager.removeVirtualInputs();\r\n        inputManager.resetRegister();\r\n        inputManager.s$maxInputNumber = replayData.playSetting.playerNumber;\r\n\r\n        const playerNumber = replayData.playSetting.playerNumber;\r\n        for (let i = 0; i < playerNumber; i++) {\r\n            const input = new Input(\"autoKeyboard\");\r\n\r\n            if (!input.isAuto()) throw new Error(\"あ\");\r\n\r\n            input.g$manager.s$inputData = replayData.inputData[i];\r\n            inputManager.register(input);\r\n        }\r\n    }\r\n\r\n    private static startAutoPlay() {\r\n        inputManager.g$registeredInputs.forEach((input) => {\r\n            if (!input.isAuto()) throw new Error(\"あ\");\r\n\r\n            input.g$manager.playReset();\r\n            input.g$manager.playStart();\r\n        });\r\n    }\r\n\r\n    private static onFinishNormal() {\r\n        pageManager.setPage(\"result\");\r\n        inputManager.removeVirtualInputs();\r\n\r\n        Replay.addTempData(this.currentGame!);\r\n        ResultPageHandler.setSaveButton();\r\n        ResultPageHandler.updateDetailedResultPage(this.currentGame!);\r\n\r\n        this.currentGame = null;\r\n    }\r\n\r\n    private static onFinishReplay() {\r\n        pageManager.setPage(\"replayResult\");\r\n        inputManager.removeVirtualInputs();\r\n\r\n        ResultPageHandler.OverWriteTime(this.currentGame!.replayData!.finishTime);\r\n        ResultPageHandler.updateDetailedResultPage(this.currentGame!);\r\n\r\n        this.currentGame = null;\r\n    }\r\n\r\n    private static async countDownAndStart() {\r\n        //開始演出\r\n        await countDown([\"\", \"3\", \"2\", \"1\", \"START!\"]);\r\n\r\n        this.currentGame!.start();\r\n\r\n        pageManager.backPages(1);\r\n    }\r\n\r\n    private static beforeStart() {\r\n        // 背景をリセット\r\n        playBackground.reset();\r\n\r\n        // ページ移動\r\n        pageManager.setPage(\"play\", { eventIgnore: true });\r\n        pageManager.setPage(\"startEffect\");\r\n    }\r\n}\r\n","import { EventId, EventManager } from \"./EventManager\";\r\nimport { Input } from \"./Interaction/Input\";\r\nimport { inputManager } from \"./Interaction/InputManager\";\r\nimport { pageManager } from \"./PageManager\";\r\nimport { sleep, qs, qsAll, getMinElement, removeMousePointerTemporary, qsAddEvent } from \"./Utils\";\r\nimport * as Setting from \"./Settings\";\r\nimport { GameProcessing } from \"./GameProcessing/GameProcessing\";\r\n\r\n//画面のinputによる操作\r\nconst pageOperateEvents: EventId[] = [];\r\nconst listeningInputs: Input[] = [];\r\nlet focusFlag = false;\r\nlet lastOperateTime = 0;\r\nexport let ScreenInteractionSetting = {\r\n    operable: true,\r\n};\r\n\r\npageManager.addEvent([\"pageChanged\"], async () => {\r\n    const page = pageManager.g$currentPage;\r\n    if (!page) {\r\n        return;\r\n    }\r\n    const id = page.id;\r\n    if (document.activeElement instanceof HTMLElement) {\r\n        document.activeElement.blur();\r\n    }\r\n    //情報を更新する\r\n    EventManager.removeEvents(pageOperateEvents);\r\n    // console.log(\"remove:\" + id);\r\n    pageOperateEvents.length = 0;\r\n    listeningInputs.length = 0;\r\n    listeningInputs.concat(inputManager.g$inputs);\r\n    //ページのボタンを最初にfocusするか\r\n    if (focusFlag) {\r\n        qs(`#${id} [data-mapping]`)?.focus();\r\n        focusFlag = false;\r\n    }\r\n    //早すぎるページ遷移の禁止\r\n    await sleep(300);\r\n    //イベントの追加\r\n    inputManager.g$inputs.forEach((input) => {\r\n        addPageOperateEvent(id, input);\r\n    });\r\n});\r\n\r\nfunction addPageOperateEvent(id: string, input: Input) {\r\n    if (listeningInputs.includes(input)) {\r\n        return;\r\n    }\r\n    const manager = input.g$manager;\r\n\r\n    //pageStartの処理\r\n    if (id == \"pageStart\") {\r\n        const eventId = manager.addEvent([\"onKeydown\", \"onButtondown\", \"onStickActive\"], () => {\r\n            focusFlag = false;\r\n            qs(\"#pageStart\").click();\r\n            operateWithInput();\r\n        });\r\n        pageOperateEvents.push(eventId);\r\n        return;\r\n    }\r\n\r\n    const eventId = manager.addEvent([\"onKeydown\", \"onButtondown\", \"onStickActive\"], () => {\r\n        //前回の操作から間が空いていないならreturn\r\n        if (Date.now() - lastOperateTime <= Setting.debounceOperateTime || !ScreenInteractionSetting.operable) {\r\n            return;\r\n        }\r\n\r\n        const options = qsAll(`#${id} [data-mapping]`);\r\n        const optionInfos = options.map((option) => ({\r\n            element: option as HTMLElement,\r\n            coordinate: JSON.parse(option.dataset.mapping!) as [number, number],\r\n        }));\r\n\r\n        const latestKey = manager.g$latestPressingKey;\r\n        if ([\"KeyX\", \"Escape\", \"Backspace\", \"button:0\"].includes(latestKey)) {\r\n            focusFlag = true;\r\n            qs(`#${id} .back`)?.click();\r\n            operateWithInput();\r\n            return;\r\n        }\r\n\r\n        // 何を行っている?\r\n        if (id == \"play\") {\r\n            const isPushPauseButton = [\"KeyP\", ...Setting.gamepadConfigPresets[0].pause].includes(latestKey);\r\n            if (isPushPauseButton) {\r\n                focusFlag = true;\r\n                operateWithInput();\r\n\r\n                const currentGame = GameProcessing.currentGame;\r\n\r\n                if (!currentGame) throw new Error(\"ゲームが始められていないのにポーズされた。\");\r\n\r\n                // currentGameの中身はできるだけprivateにしたいのでここら辺何とかしたい\r\n                if (GameProcessing.isReplaying() && currentGame.players[0].loop.g$isLooping) {\r\n                    currentGame.game.stop();\r\n                    pageManager.setPage(\"replayPause\");\r\n                }\r\n            }\r\n        }\r\n\r\n        const selectElement = optionInfos.find(({ element: option }) => option == document.activeElement);\r\n        if (!selectElement) {\r\n            if (options.length) {\r\n                options[0].focus();\r\n            }\r\n            return;\r\n        }\r\n        const getMoveElement = ([dx, dy]: [number | null, number | null]) => {\r\n            let [sx, sy] = selectElement.coordinate;\r\n            let move = getMinElement(\r\n                optionInfos\r\n                    .filter(({ coordinate: [x, y] }) => x == sx + (dx ?? x - sx) && y == sy + (dy ?? y - sy))\r\n                    .map(({ element: option, coordinate: [x, y] }) => ({ element: option, value: Math.hypot(x - sx, y - sy) }))\r\n            );\r\n            if (!move) {\r\n                move = getMinElement(\r\n                    optionInfos\r\n                        .filter(({ coordinate: [x, y] }) => x == (dx ? x : sx) && y == (dy ? y : sy))\r\n                        .map(({ element: option, coordinate: [x, y] }) => ({ element: option, value: (dx ? 0 : Math.sign(dy ?? 0) * y) + (dy ? 0 : Math.sign(dx ?? 0) * x) }))\r\n                );\r\n            }\r\n            if (!move) {\r\n                move = selectElement.element;\r\n            }\r\n            return move as HTMLElement;\r\n        };\r\n        if ([\"ArrowUp\", \"KeyW\", \"button:12\", \"stick:-1\"].includes(latestKey)) {\r\n            const element = getMoveElement([null, -1]);\r\n            element.focus();\r\n            operateWithInput();\r\n        }\r\n        if ([\"ArrowDown\", \"KeyS\", \"button:13\", \"stick:+1\"].includes(latestKey)) {\r\n            getMoveElement([null, 1]).focus();\r\n            operateWithInput();\r\n        }\r\n        if ([\"ArrowLeft\", \"KeyA\", \"button:14\", \"stick:-0\"].includes(latestKey)) {\r\n            const element = getMoveElement([-1, null]);\r\n            if (element.classList.contains(\"rangeContainer\")) {\r\n                const input = element.querySelector<HTMLInputElement>(\"input\")!;\r\n                input.stepDown();\r\n                input.dispatchEvent(new Event(\"input\"));\r\n            }\r\n            element.focus();\r\n            operateWithInput();\r\n        }\r\n        if ([\"ArrowRight\", \"KeyD\", \"button:15\", \"stick:+0\"].includes(latestKey)) {\r\n            const element = getMoveElement([1, null]);\r\n            if (element.classList.contains(\"rangeContainer\")) {\r\n                const input = element.querySelector<HTMLInputElement>(\"input\")!;\r\n                input.stepUp();\r\n                input.dispatchEvent(new Event(\"input\"));\r\n            }\r\n            element.focus();\r\n            operateWithInput();\r\n        }\r\n        if ([\"Tab\"].includes(latestKey)) {\r\n            getMoveElement([1, 1]).focus();\r\n            operateWithInput();\r\n        }\r\n        if ([\"Enter\", \"Space\", \"KeyZ\", \"button:1\"].includes(latestKey)) {\r\n            if (document.activeElement instanceof HTMLElement) {\r\n                focusFlag = true;\r\n                document.activeElement.click();\r\n                operateWithInput();\r\n            }\r\n        }\r\n    });\r\n\r\n    pageOperateEvents.push(eventId);\r\n}\r\n\r\nfunction operateWithInput() {\r\n    lastOperateTime = Date.now();\r\n    removeMousePointerTemporary();\r\n}\r\n\r\ninputManager.addEvent([\"inputAdded\"], () => {\r\n    addPageOperateEvent(pageManager.g$currentPageId ?? \"pageStart\", inputManager.g$inputs.at(-1)!);\r\n});\r\n\r\n//マウス操作との整合\r\nqsAll(\"[data-mapping]\")\r\n    .filter((e) => e instanceof HTMLElement)\r\n    .forEach((button) => {\r\n        setHoverHighlight(button);\r\n    });\r\n\r\nexport function setHoverHighlight(button: HTMLElement) {\r\n    button.addEventListener(\"mouseover\", () => {\r\n        button.focus();\r\n    });\r\n\r\n    button.addEventListener(\"mouseleave\", () => {\r\n        if (document.activeElement == button) {\r\n            button.blur();\r\n        }\r\n    });\r\n}\r\n\r\nqsAddEvent(\"[data-mapping]\", \"click\", () => {\r\n    lastOperateTime = Date.now();\r\n});\r\n\r\n//input要素を触った後にそれを含む要素にfocusさせる\r\nqsAll(\".rangeContainer[data-mapping]\").forEach((container) => {\r\n    container.querySelectorAll(\"input\").forEach((element) => {\r\n        element.addEventListener(\"click\", () => {\r\n            container.focus();\r\n        });\r\n    });\r\n});\r\n","import { pageManager } from \"./PageManager\";\r\nimport { qs, sleep, qsAddEvent } from \"./Utils\";\r\n\r\nexport class DeleteDataHandler {\r\n    static setEvents() {\r\n        pageManager.addEvent([\"setPage-dataSetting\"], () => {\r\n            const dataSize = this.getAllDataSize();\r\n            qs(\"#dataInformation\").innerHTML = `全データの容量：${dataSize} B`;\r\n        });\r\n\r\n        pageManager.addEvent([\"setPage-allDataDeleteAlert\"], async () => {\r\n            const confirmButton = qs(\"#allDataDeleteConfirmButton\") as HTMLButtonElement;\r\n            confirmButton.disabled = true;\r\n            confirmButton.style.opacity = \"0\";\r\n\r\n            await sleep(1500);\r\n\r\n            confirmButton.disabled = false;\r\n            confirmButton.style.opacity = \"1\";\r\n        });\r\n\r\n        qsAddEvent(\"#allDataDeleteConfirmButton\", \"click\", async () => {\r\n            this.removeAllData();\r\n            pageManager.backPages(2, { eventIgnore: true });\r\n            pageManager.setPage(\"dataSetting\");\r\n        });\r\n    }\r\n\r\n    private static getAllDataSize() {\r\n        return new Blob([\r\n            localStorage.getItem(\"Pentamond3-replayData\") ?? \"\",\r\n            localStorage.getItem(\"Pentamond3-graphicSetting\") ?? \"\",\r\n            //\r\n        ]).size;\r\n    }\r\n\r\n    private static removeAllData() {\r\n        localStorage.removeItem(\"Pentamond3-replayData\");\r\n        localStorage.removeItem(\"Pentamond3-graphicSetting\");\r\n    }\r\n}\r\n","import { pageManager } from \"../PageManager\";\r\nimport { qsAddEvent } from \"../Utils\";\r\nimport { GameProcessing } from \"./GameProcessing\";\r\nimport { inputManager } from \"../Interaction/InputManager\";\r\nimport { BeforePlay } from \"../BeforePlay\";\r\n\r\nexport class GameStartEventSetter {\r\n    static setEvents() {\r\n        this.normal();\r\n        this.replay();\r\n    }\r\n\r\n    private static normal() {\r\n        qsAddEvent(\".playStart\", \"click\", () => {\r\n            pageManager.backLatestPage(\"playPrepare\", { eventIgnore: true });\r\n            GameProcessing.startNormal(BeforePlay.playSetting);\r\n        });\r\n\r\n        qsAddEvent(\"#resumeButton\", \"click\", () => {\r\n            GameProcessing.resume();\r\n        });\r\n    }\r\n\r\n    private static replay() {\r\n        // replayを終了する\r\n        qsAddEvent(\"#replayPause button:not(#replayResumeButton)\", \"click\", () => {\r\n            inputManager.removeVirtualInputs();\r\n        });\r\n\r\n        qsAddEvent(\"#replayResumeButton\", \"click\", () => {\r\n            GameProcessing.resume();\r\n        });\r\n\r\n        // replayPauseとreplayResultの「もう一度」\r\n        qsAddEvent(\".replayStart\", \"click\", () => {\r\n            pageManager.backLatestPage(\"replay\", { eventIgnore: true });\r\n            GameProcessing.restartReplay();\r\n        });\r\n    }\r\n}\r\n","import { pageManager } from \"./PageManager\";\r\nimport { Sound } from \"./Sound\";\r\nimport { qs, qsAddEvent, qsAll, sleep } from \"./Utils\";\r\nimport { inputManager } from \"./Interaction/InputManager\";\r\nimport \"./ScreenInteraction\";\r\nimport { Replay } from \"./Replay/Replay\";\r\nimport { GraphicSetting } from \"./GraphicSetting\";\r\nimport { soundsInit } from \"./SoundProcessing\";\r\nimport { BeforePlay } from \"./BeforePlay\";\r\nimport { DeleteDataHandler } from \"./DeleteDataHandler\";\r\nimport { GameStartEventSetter } from \"./GameProcessing/GameStarter\";\r\n\r\n//不正なページ遷移の防止\r\nsetupInputBehavior();\r\nfunction setupInputBehavior() {\r\n    document.addEventListener(\"keydown\", (e) => {\r\n        if ([\"Tab\", \"Space\", \"Enter\", \"ArrowUp\", \"ArrowDown\", \"ArrowLeft\", \"ArrowRight\"].includes(e.code)) {\r\n            e.preventDefault();\r\n        }\r\n    });\r\n\r\n    qsAll(\"button\").forEach((button) => {\r\n        button.tabIndex = -1;\r\n    });\r\n\r\n    qsAll(\"input\").forEach((button) => {\r\n        button.tabIndex = -1;\r\n    });\r\n\r\n    qsAll(\"div[data-mapping]\").forEach((button) => {\r\n        button.tabIndex = 0;\r\n    });\r\n}\r\n\r\n//クリックによる開始\r\nqsAddEvent(\"#pageStart\", \"click\", () => {\r\n    pageManager.setPage(\"title\");\r\n    // se[0].play();\r\n});\r\n\r\n//起動時処理\r\nexport let se: Sound[] = [];\r\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\r\n    pageManager.init();\r\n    inputManager.s$maxInputNumber = 1;\r\n\r\n    GameStartEventSetter.setEvents();\r\n\r\n    //コントローラー登録\r\n    BeforePlay.setEvents();\r\n\r\n    soundsInit();\r\n\r\n    // グラフィック設定\r\n    GraphicSetting.init();\r\n\r\n    // データ消去イベントの設定\r\n    DeleteDataHandler.setEvents();\r\n\r\n    // リプレイのイベントの設定と、リプレイページの設定\r\n    Replay.setupSavedReplayPage();\r\n    console.log(`The sum of size of replayData is ${Replay.getDataSize()}byte`);\r\n});\r\n\r\nexport const debug = false;\r\n\r\n// localStorage.removeItem(\"Pentamond3-replayData\");\r\n\r\n// let count = 0;\r\n// const loop = new LoopManager();\r\n// const loop2 = new LoopManager();\r\n// loop.s$loopFrequency = 1000;\r\n// loop.addEvent([\"loop\"], () => {\r\n//     console.log(count);\r\n//     count = 0;\r\n// });\r\n// loop2.addEvent([\"loop\"], () => {\r\n//     count++;\r\n// });\r\n// loop.start();\r\n// loop2.start();\r\n\r\n// let a = performance.now();\r\n// const A = (currentTime: number) => {\r\n//     console.log((1000 / (currentTime - a)).toFixed(0));\r\n//     a = currentTime;\r\n//     requestAnimationFrame(A);\r\n// };\r\n// requestAnimationFrame(A);\r\n"],"names":["EventManager","id","handler","classNames","ids","eventId","eventIds","className","PageManager","initialPageId","element","back","pageId","layer","prevElements","nextElements","prev","length","prevIndex","next","nextIndex","pageIds","options","nextPages","page","preliminaryCurrentPage","preliminaryMaxLayer","nextPage","nextDisplayingPages","currentLayer","nextLayer","number","valid","invalidPanel","index","memory","subPages","subPageLabel","subPage","i","pageManager","sleep","ms","resolve","mixArray","array","mixCount","a","b","j","k","qsAll","selector","qs","qsAddEvent","eventName","arrayPlus","n","getMinElement","minValue","result","value","removeMousePointerTemporary","TimeManager","startImmediately","goal","LoopManager","frequency","loopCount","AutoKeyboardManager$1","inputData","keydownEvent","keyCode","keyupEvent","keys","time","keyCodes","arePressing","existsPressingKey","GamepadInput","axisThreshold","loop","gamepad","gp","btn","isPressed","wasPressed","isActive","wasActive","GamepadManager","e","KeyboardManager","Input","type","AutoKeyboardManager","InputManager","input","maxInputNumber","inputManager","width","height","hiddenHeight","playWidth","playHeight","displayMargin","blockHeight","blockWidth","initialX","initialY","backgroundColor","blockColor","canvasGrid","mondGrid","guideBorderColor","damageTime","damageWaitingTime","damageGrace","gameTimeRate","warningGameTime","penalty","gamepadConfigPresets","debounceOperateTime","maximumTemporaryReplaySavable","gameEvents","GameMode","players","operateNames","p","operateName","player","Vector","values","validValues","x","v","c","size","radian","equal","vectors","validVectors","minDistance","distance","maxDistance","canvas","ctx","Triangle","point","vertex","colorAnimation","triangles","playBackgroundLoop","tri","playBackground","GraphicSetting","data","json","word","BGM","src","loopStart","loopEnd","sourceVolume","audioData","second","volume","buffer","reversedBuffer","channel","originalData","reversedData","Time","contextTime","currentTime","elapsedContextTime","loopDuration","FlagManager","flag","flags","flagManager","Sound","arrayBuffer","audioBuffer","audio","se","bgm","soundsInit","ScreenInteractionSetting","BeforePlay","backDepth","available","registerInputs","typeIcon","Setting.gamepadConfigPresets","Mode1","_","playingPlayers","max","resultLabel","operate","updateLabel","lastOperateTime","moveKeys","latestKey","pressTime","Setting.input","Setting.warningGameTime","Setting.damageWaitingTime","Setting.penalty","lastTrick","Mode2","ReplayDom","replayDataList","container","replayButtons","deleteButtons","replayData","replayDataContainer","replayButton","deleteButton","button","setHoverHighlight","now","replayDataDescription","solo","mode","date","saveButton","replayContainer","tempDataListLength","LZString","f","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","res","compressed","uncompressed","buf","TotalLen","current_value","bitsPerChar","getCharFromInt","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","ii","resetValue","getNextValue","dictionary","enlargeIn","dictSize","numBits","entry","w","bits","resb","maxpower","power","module","blockKinds","numbers","replayDataEncryption","playerInputData","nextData","playerNextData","kind","nuisanceBlockData","playerNuisanceData","data1","replayDataDecryption","encryptedData","objectData","sum","filteredInputNumber","ReplayDataHandler","game","playSetting","operateMemory","finishTime","finishPlayers","encodedList","d","encodedData","onOverMax","onError","dataSize","ReplayEventSetter","tempDataList","GameProcessing","Replay","confirmButton","ac","buttons","Setting.maximumTemporaryReplaySavable","Block","direction","visible","placement","spinCorrection","moveCorrection","trickInfos","地割れ","list","h","l","transpile","shape","BlockManager","Setting.playWidth","Setting.playHeight","y","blockX","block","mond","relativeX","monoiamond","rotate","displacement","moveDirection","lineShape","trickInfo","NextManager","Monoiamond","Setting.initialX","Setting.initialY","copy","Pentiamond","m","MondOperator","ghostMond","NuisanceMondManager","blockManager","spawnCoordinates","Setting.damageTime","Setting.damageGrace","nuisanceMond","task","damageBoard","dx","dy","remove","isGrounded","CanvasManager","Setting.blockHeight","Setting.height","Setting.displayMargin","Setting.blockWidth","Setting.width","Setting.next","state","property","isGhost","Setting.mondGrid","Setting.blockColor","position","p1","p2","p3","Setting.backgroundColor","Setting.guideBorderColor","Setting.canvasGrid","isHold","correction","scale","InformationLabelManager","gameTime","playTime","line","chain","score","GamePlayer","animation","damageTask","Setting.gameTimeRate","DisposableGame","gameModeList","inputs","inputCount","CurrentMode","maxGameTime","ResultPageHandler","subPageController","resultTitlePage","html","countDown","countString","r","startEffectLabel","playerNumber","pageOperateEvents","listeningInputs","focusFlag","addPageOperateEvent","manager","operateWithInput","Setting.debounceOperateTime","optionInfos","option","currentGame","selectElement","getMoveElement","sx","sy","move","DeleteDataHandler","GameStartEventSetter","setupInputBehavior"],"mappings":"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","x_google_ignoreList":[24]}